{
  "title": "RabbitMQ Overview (OpenMetrics Version)",
  "description": "## RabbitMQ Integration\n\nThis dashboard provides an overview of your RabbitMQ (Prometheus plugin) environment. It monitors node status, provides information on message statuses, and gives you insight into various other observability measures of your RMQ setup. \n\n*Note:* If you are using the Management plugin version of RabbitMQ, use the alternate dashboard.\n\nFor more information, refer to:\n* [RabbitMQ Integration Doc](https://docs.datadoghq.com/integrations/rabbitmq/?tab=host)\n* [RabbitMQ Blog by Datadog](https://www.datadoghq.com/blog/monitoring-rabbitmq-performance-with-datadog/)",
  "widgets": [
    {
      "id": 539814910975430,
      "definition": {
        "title": "New group",
        "banner_img": "/static/images/logos/rabbitmq_small.svg",
        "show_title": false,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 6507010436924774,
            "definition": {
              "type": "note",
              "content": "**RabbitMQ**\n\nThis dashboard provides an overview of your RabbitMQ (Prometheus Plugin) environment. It monitors node status, provides information on message statuses, and gives you insight into various other observability measures of your RMQ setup.\n\n*Note:* If you are using the Management plugin version of RabbitMQ, please use the alternate dashboard.",
              "background_color": "white",
              "font_size": "14",
              "text_align": "left",
              "vertical_align": "top",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 3, "height": 3 }
          },
          {
            "id": 7472223195597488,
            "definition": {
              "type": "note",
              "content": "**Useful Links**\n\n* [Integration Docs](https://docs.datadoghq.com/integrations/rabbitmq/?tab=host)\n* [RabbitMQ Blog by Datadog](https://www.datadoghq.com/blog/monitoring-rabbitmq-performance-with-datadog/)\n* [RabbitMQ Documentation](https://www.rabbitmq.com/documentation.html)\n* [Data Streams Monitoring](https://docs.datadoghq.com/data_streams/setup/technologies/rabbitmq/?referrer=rabbitmq_openmetrics)",
              "background_color": "white",
              "font_size": "16",
              "text_align": "left",
              "vertical_align": "top",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 3, "y": 0, "width": 3, "height": 3 }
          }
        ]
      },
      "layout": { "x": 0, "y": 0, "width": 6, "height": 6 }
    },
    {
      "id": 16881410520542,
      "definition": {
        "title": "Overview",
        "background_color": "vivid_orange",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 7225439286749620,
            "definition": {
              "type": "note",
              "content": "This section provides you with an overview of your system activity.  The monitor summary alerts you of nodes that are running out of disk space or seeing heightened rates of unacknowledged messages.",
              "background_color": "orange",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "center",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 6, "height": 1 }
          },
          {
            "id": 6769103719704604,
            "definition": {
              "title": "RMQ Monitor Summary",
              "type": "manage_status",
              "display_format": "countsAndList",
              "color_preference": "text",
              "hide_zero_counts": true,
              "show_status": true,
              "last_triggered_format": "relative",
              "query": "rabbitmq - omv2",
              "sort": "status,asc",
              "count": 50,
              "start": 0,
              "summary_type": "monitors",
              "show_priority": false,
              "show_last_triggered": false
            },
            "layout": { "x": 0, "y": 1, "width": 6, "height": 3 }
          },
          {
            "id": 7480415605728566,
            "definition": {
              "title": "OpenMetrics Status",
              "title_size": "16",
              "title_align": "left",
              "time": { "live_span": "1d" },
              "type": "check_status",
              "check": "rabbitmq.openmetrics.health",
              "grouping": "cluster",
              "group_by": [],
              "tags": []
            },
            "layout": { "x": 0, "y": 4, "width": 6, "height": 1 }
          }
        ]
      },
      "layout": { "x": 6, "y": 0, "width": 6, "height": 6 }
    },
    {
      "id": 2463793046394002,
      "definition": {
        "title": "Node Status",
        "background_color": "vivid_orange",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 4274214467814750,
            "definition": {
              "type": "note",
              "content": "This section is useful in monitoring your system on a regular basis. Understanding active consumers, channels, node space and process/port rates allows you to gain a thorough understanding on the health and capacity of each RabbitMQ instance. Assign the *node_name* variable to see the status of specific nodes.",
              "background_color": "orange",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "top",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 12, "height": 1 }
          },
          {
            "id": 2355726191916836,
            "definition": {
              "title": "Queue Pipeline per Node",
              "title_size": "16",
              "title_align": "left",
              "time": { "type": "live", "unit": "month", "value": 1 },
              "requests": [
                {
                  "response_format": "scalar",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.queues.created.count{$node_name} by {rabbitmq_node}.as_count()",
                      "aggregator": "sum"
                    },
                    {
                      "name": "query2",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.queues.deleted.count{$node_name} by {rabbitmq_node}.as_count()",
                      "aggregator": "sum"
                    },
                    {
                      "name": "query3",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.queues.declared.count{$node_name} by {rabbitmq_node}.as_count()",
                      "aggregator": "sum"
                    },
                    {
                      "name": "query4",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.queues{$node_name} by {rabbitmq_node}",
                      "aggregator": "sum"
                    }
                  ],
                  "style": { "palette": "datadog16" },
                  "formulas": [
                    { "formula": "query1 + query2 + query3 + query4" }
                  ]
                }
              ],
              "type": "sunburst",
              "legend": { "type": "automatic" }
            },
            "layout": { "x": 0, "y": 1, "width": 4, "height": 4 }
          },
          {
            "id": 4718874940062770,
            "definition": {
              "title": "% Usage of Node Memory",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "query1 / query2 * 100",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      }
                    }
                  ],
                  "queries": [
                    {
                      "query": "avg:rabbitmq.process.resident_memory_bytes{$node_name} by {rabbitmq_node}",
                      "data_source": "metrics",
                      "name": "query1"
                    },
                    {
                      "query": "avg:rabbitmq.resident_memory_limit_bytes{$node_name} by {rabbitmq_node}",
                      "data_source": "metrics",
                      "name": "query2"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 4, "y": 1, "width": 4, "height": 2 }
          },
          {
            "id": 1985971358025204,
            "definition": {
              "title": "Consumers",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "query": "avg:rabbitmq.global.consumers{$node_name} by {rabbitmq_node}",
                      "data_source": "metrics",
                      "name": "query1"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 8, "y": 1, "width": 4, "height": 2 }
          },
          {
            "id": 8557693890285346,
            "definition": {
              "title": "Difference of Opened vs Closed Connections",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "horizontal",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [{ "formula": "query1 - query2" }],
                  "queries": [
                    {
                      "query": "avg:rabbitmq.connections.opened.count{$node_name} by {rabbitmq_node}.as_count()",
                      "data_source": "metrics",
                      "name": "query1"
                    },
                    {
                      "query": "avg:rabbitmq.connections.closed.count{$node_name} by {rabbitmq_node}.as_count()",
                      "data_source": "metrics",
                      "name": "query2"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 4, "y": 3, "width": 4, "height": 2 }
          },
          {
            "id": 6698344132861859,
            "definition": {
              "type": "note",
              "content": "[Connection leak](https://www.rabbitmq.com/docs/connections#connection-leaks) is a condition under which an application repeatedly opens connections without closing them, or at least closing only some of them, eventually exhausting the node of file handles.",
              "background_color": "yellow",
              "font_size": "14",
              "text_align": "left",
              "vertical_align": "center",
              "show_tick": true,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 8, "y": 3, "width": 4, "height": 2 }
          },
          {
            "id": 3152712759902115,
            "definition": {
              "title": "Available Disk Space",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.disk_space.available_bytes{$node_name} by {rabbitmq_node}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 0, "y": 5, "width": 4, "height": 2 }
          },
          {
            "id": 221038392704424,
            "definition": {
              "title": "% Usage of Erlang Processes",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "100 * (query1 / query2)",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      }
                    }
                  ],
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.erlang.vm.process_count{$node_name} by {rabbitmq_node}"
                    },
                    {
                      "name": "query2",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.erlang.vm.process_limit{$node_name} by {rabbitmq_node}"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 4, "y": 5, "width": 4, "height": 2 }
          },
          {
            "id": 6931724594109592,
            "definition": {
              "title": "% Usage of Ports",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "100 * (query1 / query2)",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      }
                    }
                  ],
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.erlang.vm.port_count{$node_name} by {rabbitmq_node}"
                    },
                    {
                      "name": "query2",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.erlang.vm.port_limit{$node_name} by {rabbitmq_node}"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 8, "y": 5, "width": 4, "height": 2 }
          },
          {
            "id": 4732168815117324,
            "definition": {
              "title": "Open Channels",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "query": "avg:rabbitmq.channels{$node_name}",
                      "data_source": "metrics",
                      "name": "query1",
                      "aggregator": "avg"
                    }
                  ],
                  "response_format": "scalar"
                }
              ],
              "autoscale": true,
              "precision": 2,
              "timeseries_background": { "type": "area" }
            },
            "layout": { "x": 0, "y": 7, "width": 2, "height": 2 }
          },
          {
            "id": 790776713418000,
            "definition": {
              "title": "% Usage of TCP Sockets",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "query2 / query1 * 100",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      }
                    }
                  ],
                  "queries": [
                    {
                      "query": "avg:rabbitmq.process.open_tcp_sockets{$node_name} by {rabbitmq_node}",
                      "data_source": "metrics",
                      "name": "query2"
                    },
                    {
                      "query": "avg:rabbitmq.process.max_tcp_sockets{$node_name} by {rabbitmq_node}",
                      "data_source": "metrics",
                      "name": "query1"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 2, "y": 7, "width": 5, "height": 2 }
          },
          {
            "id": 7940762869190319,
            "definition": {
              "title": "% Usage of File Descriptors",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    {
                      "formula": "query2 / query1 * 100",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      }
                    }
                  ],
                  "queries": [
                    {
                      "query": "avg:rabbitmq.process.open_fds{$node_name} by {rabbitmq_node}",
                      "data_source": "metrics",
                      "name": "query2"
                    },
                    {
                      "query": "avg:rabbitmq.process.max_fds{$node_name} by {rabbitmq_node}",
                      "data_source": "metrics",
                      "name": "query1"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 7, "y": 7, "width": 5, "height": 2 }
          }
        ]
      },
      "layout": { "x": 0, "y": 6, "width": 12, "height": 10 }
    },
    {
      "id": 6211186481704640,
      "definition": {
        "title": "Messages Pipelines",
        "background_color": "vivid_orange",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 7327292918773178,
            "definition": {
              "type": "note",
              "content": "This section shows messages at different stages of their journey. These message pipelines are filtered by the channel and queue levels in the timeseries graphs, and broken down to the node and connection levels in the pie charts. ",
              "background_color": "orange",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "top",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 12, "height": 1 }
          },
          {
            "id": 5917152195322416,
            "definition": {
              "title": "Messages Pipeline - Queue",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "horizontal",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    { "alias": "Ready", "formula": "query1" },
                    { "alias": "Paged Out", "formula": "query2" },
                    { "alias": "Persistent", "formula": "query3" },
                    { "alias": "Published", "formula": "query4" },
                    { "alias": "Unack'ed", "formula": "query5" }
                  ],
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.queue.messages.ready{$queue}"
                    },
                    {
                      "name": "query2",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.queue.messages.paged_out{$queue}"
                    },
                    {
                      "name": "query3",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.queue.messages.persistent{$queue}"
                    },
                    {
                      "name": "query4",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.queue.messages.published.count{$queue}.as_count()"
                    },
                    {
                      "name": "query5",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.queue.messages.unacked{$queue}"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 0, "y": 1, "width": 8, "height": 3 }
          },
          {
            "id": 8756701159297916,
            "definition": {
              "title": "Messages per queue and node",
              "title_size": "16",
              "title_align": "left",
              "requests": [
                {
                  "response_format": "scalar",
                  "queries": [
                    {
                      "query": "sum:rabbitmq.queue.messages{*} by {rabbitmq_queue,rabbitmq_node}",
                      "data_source": "metrics",
                      "name": "query1",
                      "aggregator": "sum"
                    }
                  ],
                  "style": { "palette": "datadog16" },
                  "formulas": [{ "formula": "query1" }],
                  "sort": {
                    "order_by": [
                      { "type": "formula", "index": 0, "order": "desc" }
                    ]
                  }
                }
              ],
              "type": "sunburst",
              "legend": { "type": "automatic" }
            },
            "layout": { "x": 8, "y": 1, "width": 4, "height": 3 }
          },
          {
            "id": 7633664958974524,
            "definition": {
              "title": "Messages Pipeline - Channel",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "horizontal",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    { "alias": "Ack'ed", "formula": "query1" },
                    { "alias": "Delivered", "formula": "query2" },
                    { "alias": "Published", "formula": "query3" },
                    { "alias": "Unroutable Dropped", "formula": "query4" },
                    { "alias": "Unack'ed", "formula": "query5" }
                  ],
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.channel.messages.delivered.ack.count{*}.as_count()"
                    },
                    {
                      "name": "query2",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.channel.messages.delivered.count{*}.as_count()"
                    },
                    {
                      "name": "query3",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.channel.messages.published.count{*}.as_count()"
                    },
                    {
                      "name": "query4",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.channel.messages.unroutable.dropped.count{*}.as_count()"
                    },
                    {
                      "name": "query5",
                      "data_source": "metrics",
                      "query": "sum:rabbitmq.channel.messages.unacked{*}"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 0, "y": 4, "width": 8, "height": 3 }
          },
          {
            "id": 2111728965745842,
            "definition": {
              "title": "Packets in a Connection",
              "title_size": "16",
              "title_align": "left",
              "requests": [
                {
                  "response_format": "scalar",
                  "queries": [
                    {
                      "query": "sum:rabbitmq.connection.incoming_packets.count{$rabbitmq_conn_state}.as_count()",
                      "data_source": "metrics",
                      "name": "query1",
                      "aggregator": "sum"
                    },
                    {
                      "query": "sum:rabbitmq.connection.outgoing_packets.count{$rabbitmq_conn_state}.as_count()",
                      "data_source": "metrics",
                      "name": "query2",
                      "aggregator": "sum"
                    },
                    {
                      "query": "sum:rabbitmq.connection.pending_packets{$rabbitmq_conn_state}",
                      "data_source": "metrics",
                      "name": "query3",
                      "aggregator": "sum"
                    }
                  ],
                  "style": { "palette": "datadog16" },
                  "formulas": [{ "formula": "query1 + query2 + query3" }],
                  "sort": {
                    "count": 500,
                    "order_by": [
                      { "type": "formula", "index": 0, "order": "desc" }
                    ]
                  }
                }
              ],
              "type": "sunburst",
              "legend": { "type": "automatic" }
            },
            "layout": { "x": 8, "y": 4, "width": 4, "height": 3 }
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 16,
        "width": 12,
        "height": 8,
        "is_column_break": true
      }
    },
    {
      "id": 3073347552438911,
      "definition": {
        "title": "Queue Metrics",
        "background_color": "vivid_orange",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 2180368934927932,
            "definition": {
              "title": "Queue Depth",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.queue.messages{$queue} by {queue}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=topic:{{queue.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 0, "y": 0, "width": 12, "height": 3 }
          },
          {
            "id": 3866458434756012,
            "definition": {
              "title": "Ready Messages",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.queue.messages.ready{$queue} by {queue}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=topic:{{queue.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 0, "y": 3, "width": 6, "height": 3 }
          },
          {
            "id": 5006889940220036,
            "definition": {
              "title": "Published Messages",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.queue.messages.published.count{$queue} by {queue}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=topic:{{queue.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 6, "y": 3, "width": 6, "height": 3 }
          },
          {
            "id": 2762064279690506,
            "definition": {
              "title": "Delivered Messages",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.queue.messages.delivered.count{$queue} by {queue}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=topic:{{queue.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 0, "y": 6, "width": 6, "height": 3 }
          },
          {
            "id": 1448944630429106,
            "definition": {
              "title": "Redelivered Messages",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.queue.messages.redelivered.count{$queue} by {queue}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=topic:{{queue.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 6, "y": 6, "width": 6, "height": 3 }
          },
          {
            "id": 3818993480161297,
            "definition": {
              "title": "Acknowledged Messages",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.queue.messages.acked.count{$queue} by {queue}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=topic:{{queue.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 0, "y": 9, "width": 6, "height": 3 }
          },
          {
            "id": 5233118320222026,
            "definition": {
              "title": "Unacknowledged Messages",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.queue.messages.unacked{$queue} by {queue}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=topic:{{queue.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 6, "y": 9, "width": 6, "height": 3 }
          },
          {
            "id": 4997632797701993,
            "definition": {
              "title": "Consumers per Queue",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.queue.consumers{$queue} by {queue}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=topic:{{queue.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 0, "y": 12, "width": 6, "height": 3 }
          },
          {
            "id": 6367734673091866,
            "definition": {
              "title": "Queue Consumers' Ability to Take New Messages",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "name": "query1",
                      "data_source": "metrics",
                      "query": "avg:rabbitmq.queue.consumer_utilisation{$queue} by {queue}"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=topic:{{queue.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 6, "y": 12, "width": 6, "height": 3 }
          },
          {
            "id": 5680810966566357,
            "definition": {
              "type": "note",
              "content": "Get insights into your queues' producers and consumers by instrumenting them with Data Streams Monitoring. [Learn more](https://docs.datadoghq.com/data_streams/setup/technologies/rabbitmq/?referrer=rabbitmq_openmetrics)",
              "background_color": "purple",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "center",
              "show_tick": true,
              "tick_pos": "50%",
              "tick_edge": "bottom",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 15, "width": 12, "height": 1 }
          },
          {
            "id": 3489646968696908,
            "definition": {
              "title": "RabbitMQ Topology for $queue",
              "title_size": "16",
              "title_align": "left",
              "type": "topology_map",
              "requests": [
                {
                  "request_type": "topology",
                  "query": {
                    "filters": [],
                    "service": "",
                    "data_source": "data_streams",
                    "query_string": "traffic_type:rabbitmq $queue"
                  }
                }
              ]
            },
            "layout": { "x": 0, "y": 16, "width": 6, "height": 6 }
          },
          {
            "id": 5864725959970603,
            "definition": {
              "title": "Top 10 Max Time in Queue by env",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "max:data_streams.latency{type:rabbitmq AND pathway_type:edge AND direction:in AND (topic:$queue.value )} by {topic,env}"
                    }
                  ],
                  "formulas": [
                    {
                      "number_format": {},
                      "formula": "top(query1, 10, 'max', 'desc')"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=queue:{{topic.value}}&env={{env.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 6, "y": 16, "width": 6, "height": 6 }
          },
          {
            "id": 5210683934287696,
            "definition": {
              "title": "Incoming Messages by env, Producing Service",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "upstream_services_throughput",
                      "query": "count(v: v>=0):data_streams.latency{type:rabbitmq AND direction:in AND pathway_type:edge AND (topic:$queue.value )} by {start,env}.as_rate()"
                    }
                  ],
                  "formulas": [
                    {
                      "alias": "producer_throughput",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "message",
                          "per_unit_name": "second"
                        }
                      },
                      "formula": "default_zero(upstream_services_throughput)"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "area"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=start:{{start.value}}&env={{env.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 0, "y": 22, "width": 6, "height": 3 }
          },
          {
            "id": 5255514887441810,
            "definition": {
              "title": "Outgoing Messages by env, Consuming Service",
              "title_size": "16",
              "title_align": "left",
              "show_legend": false,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "downstream_services_throughput_by_queues",
                      "query": "count(v: v>=0):data_streams.latency{type:rabbitmq AND direction:in AND pathway_type:full AND (topic:$queue.value )} by {service,env}.as_rate().rollup(10)"
                    }
                  ],
                  "formulas": [
                    {
                      "alias": "consumer_throughput",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "message",
                          "per_unit_name": "second"
                        }
                      },
                      "formula": "default_zero(downstream_services_throughput_by_queues)"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "area"
                }
              ],
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=service:{{service.value}}&env={{env.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 6, "y": 22, "width": 6, "height": 3 }
          },
          {
            "id": 2382382132630298,
            "definition": {
              "title": "Top 10 p95 Message Size by env",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    { "formula": "top(query1, 10, 'mean', 'desc')" }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "p95:data_streams.payload_size{type:rabbitmq,topic:$queue.value} by {topic,env}"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "yaxis": {
                "scale": "linear",
                "include_zero": true,
                "min": "auto",
                "max": "auto"
              },
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=queue:{{topic.value}}&env={{env.value}}&referrer=rabbitmq_openmetrics"
                }
              ]
            },
            "layout": { "x": 0, "y": 25, "width": 6, "height": 2 }
          },
          {
            "id": 4910867072087173,
            "definition": {
              "title": "Distribution of Message Size",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "type": "distribution",
              "xaxis": {
                "scale": "linear",
                "min": "auto",
                "max": "auto",
                "include_zero": true
              },
              "yaxis": {
                "scale": "linear",
                "min": "auto",
                "max": "auto",
                "include_zero": true
              },
              "custom_links": [
                {
                  "label": "View in Data Streams Monitoring",
                  "link": "/data-streams/map?query=traffic_type:rabbitmq&referrer=rabbitmq_openmetrics"
                }
              ],
              "requests": [
                {
                  "request_type": "histogram",
                  "query": {
                    "data_source": "metrics",
                    "name": "query1",
                    "aggregator": "avg",
                    "query": "avg:data_streams.payload_size{type:rabbitmq,topic:*}"
                  }
                }
              ]
            },
            "layout": { "x": 6, "y": 25, "width": 6, "height": 2 }
          }
        ]
      },
      "layout": { "x": 0, "y": 24, "width": 12, "height": 28 }
    },
    {
      "id": 3412626217094282,
      "definition": {
        "title": "Logs",
        "background_color": "vivid_orange",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 218491216894336,
            "definition": {
              "type": "note",
              "content": "When investigating logs, you can refer to the timeseries data to see the ratio of a certain log status to other expected statuses. In situations where you notice an increase in the ratio of error logs, you can refer to the log stream set up to filter erroneous RabbitMQ logs for your perusal.",
              "background_color": "orange",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "top",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 12, "height": 1 }
          },
          {
            "id": 3257923575107055,
            "definition": {
              "title": "Count per Log Status",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "horizontal",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [{ "formula": "a" }],
                  "queries": [
                    {
                      "data_source": "logs",
                      "name": "a",
                      "search": { "query": "source:rabbitmq $node_name" },
                      "indexes": ["*"],
                      "compute": { "aggregation": "count" },
                      "group_by": [
                        {
                          "facet": "status",
                          "limit": 50,
                          "sort": { "aggregation": "count", "order": "desc" },
                          "should_exclude_missing": true
                        }
                      ],
                      "storage": "flex_tier"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "semantic",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": { "x": 0, "y": 1, "width": 6, "height": 4 }
          },
          {
            "id": 4110452737953996,
            "definition": {
              "title": "Error Logs for RabbitMQ",
              "title_size": "16",
              "title_align": "left",
              "requests": [
                {
                  "response_format": "event_list",
                  "columns": [
                    { "field": "status_line", "width": "auto" },
                    { "field": "timestamp", "width": "auto" },
                    { "field": "host", "width": "auto" },
                    { "field": "service", "width": "auto" },
                    { "field": "content", "width": "compact" }
                  ],
                  "query": {
                    "data_source": "logs_stream",
                    "query_string": "source:rabbitmq status:error",
                    "indexes": [],
                    "storage": "hot"
                  }
                }
              ],
              "type": "list_stream"
            },
            "layout": { "x": 6, "y": 1, "width": 6, "height": 4 }
          }
        ]
      },
      "layout": { "x": 0, "y": 52, "width": 12, "height": 6 }
    }
  ],
  "template_variables": [
    {
      "name": "node_name",
      "prefix": "rabbitmq_node",
      "available_values": [],
      "default": "*"
    },
    {
      "name": "queue",
      "prefix": "queue",
      "available_values": [],
      "default": "*"
    },
    {
      "name": "rabbitmq_conn_state",
      "prefix": "rabbitmq_conn_state",
      "available_values": [],
      "default": "*"
    }
  ],
  "layout_type": "ordered",
  "notify_list": [],
  "reflow_type": "fixed"
}
