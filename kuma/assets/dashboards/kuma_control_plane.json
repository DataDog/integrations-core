{
  "title": "Kuma Control Plane",
  "description": "## Kuma Service Mesh Control Plane\n\nThis dashboard provides comprehensive monitoring for your Kuma service mesh infrastructure. Track the health and performance of control plane components to ensure reliable service-to-service communication.\n\n Use the template variables to filter by control plane instance, mesh zone, or cluster.\n\n**Further reading:**\n- [Datadog Kuma Integration Documentation](https://docs.datadoghq.com/integrations/kuma/)\n- [Kuma Documentation](https://kuma.io/docs/latest/)\n- [Kuma Production Guide](https://kuma.io/docs/latest/production/)\n- [Kuma Metrics Reference](https://kuma.io/docs/latest/policies/traffic-metrics/)\n- [Performance Tuning Guide](https://kuma.io/docs/latest/production/upgrades-tuning/fine-tuning/)",
  "widgets": [
    {
      "id": 7893170514368284,
      "definition": {
        "title": "",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 5620421605366273,
            "definition": {
              "type": "image",
              "url": "/static/images/logos/kuma_large.svg",
              "url_dark_theme": "/static/images/logos/kuma_reversed_large.svg",
              "sizing": "contain",
              "margin": "md",
              "has_background": true,
              "has_border": true,
              "vertical_align": "center",
              "horizontal_align": "center"
            },
            "layout": { "x": 0, "y": 0, "width": 6, "height": 2 }
          },
          {
            "id": 2807283505732892,
            "definition": {
              "type": "note",
              "content": "## Kuma Service Mesh Control Plane\n\nThis dashboard provides comprehensive monitoring for your Kuma service mesh infrastructure. Track the health and performance of control plane components to ensure reliable service-to-service communication.\n\n Use the template variables to filter by control plane instance, mesh zone, or cluster.\n\n**Further reading:**\n- [Datadog Kuma Integration Documentation](https://docs.datadoghq.com/integrations/kuma/)\n- [Kuma Documentation](https://kuma.io/docs/latest/)\n- [Kuma Production Guide](https://kuma.io/docs/latest/production/)\n- [Kuma Metrics Reference](https://kuma.io/docs/latest/policies/traffic-metrics/)\n- [Performance Tuning Guide](https://kuma.io/docs/latest/production/upgrades-tuning/fine-tuning/)",
              "background_color": "white",
              "font_size": "14",
              "text_align": "left",
              "vertical_align": "top",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 2, "width": 6, "height": 6 }
          }
        ]
      },
      "layout": { "x": 0, "y": 0, "width": 6, "height": 10 }
    },
    {
      "id": 7855114521341362,
      "definition": {
        "title": "API Server",
        "background_color": "vivid_purple",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 3785836227166555,
            "definition": {
              "type": "note",
              "content": "The API Server exposes Kuma's REST API for configuration management. \n\n[API Reference Documentation](https://kuma.io/docs/latest/reference/http-api/)",
              "background_color": "purple",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "center",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 6, "height": 1 }
          },
          {
            "id": 314939649143054,
            "definition": {
              "title": "HTTP OK Responses",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.api_server.http_request_duration_seconds.count{$instance_id AND $zone AND code_class IN (1xx,2xx,3xx) AND $cluster_name} by {code}.as_count()"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "green",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": { "x": 0, "y": 1, "width": 3, "height": 2 }
          },
          {
            "id": 538705636441132,
            "definition": {
              "title": "HTTP Request Duration (Average)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.api_server.http_request_duration_seconds.sum{$zone,$instance_id,$cluster_name} by {handler}.as_count()"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "sum:kuma.api_server.http_request_duration_seconds.count{$zone,$instance_id,$cluster_name} by {handler}.as_count()"
                    }
                  ],
                  "formulas": [
                    {
                      "formula": "query1 / query2",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      }
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 3, "y": 1, "width": 3, "height": 2 }
          },
          {
            "id": 5599124281027502,
            "definition": {
              "title": "HTTP Error Percentage",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.api_server.http_request_duration_seconds.count{$instance_id AND $zone AND code_class IN (4xx,5xx) AND $cluster_name} by {code}.as_count()"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "sum:kuma.api_server.http_request_duration_seconds.count{$instance_id,$zone,$cluster_name}.as_count()"
                    }
                  ],
                  "formulas": [
                    {
                      "formula": "query1 * 100 / query2",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      }
                    }
                  ],
                  "style": {
                    "palette": "red",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ],
              "yaxis": { "include_zero": true, "min": "0", "max": "100" },
              "markers": [
                {
                  "label": " 5% ",
                  "value": "0 < y < 5",
                  "display_type": "ok dashed"
                },
                { "value": "5 < y < 100", "display_type": "warning dashed" }
              ]
            },
            "layout": { "x": 0, "y": 3, "width": 3, "height": 2 }
          },
          {
            "id": 7004689456425576,
            "definition": {
              "title": "HTTP Error Responses",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.api_server.http_request_duration_seconds.count{$instance_id AND $zone AND code_class IN (4xx,5xx) AND $cluster_name} by {code}.as_count()"
                    }
                  ],
                  "formulas": [{ "formula": "query1" }],
                  "style": {
                    "palette": "red",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": { "x": 3, "y": 3, "width": 3, "height": 2 }
          },
          {
            "id": 2146909446738880,
            "definition": {
              "title": "HTTP Response Codes",
              "title_size": "16",
              "title_align": "left",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.api_server.http_request_duration_seconds.count{$instance_id,$zone,$cluster_name} by {code}.as_count()",
                      "aggregator": "avg"
                    }
                  ],
                  "response_format": "scalar",
                  "style": { "palette": "classic" },
                  "formulas": [{ "formula": "query1" }],
                  "sort": {
                    "count": 500,
                    "order_by": [
                      { "type": "formula", "index": 0, "order": "desc" }
                    ]
                  }
                }
              ],
              "type": "sunburst",
              "hide_total": false,
              "legend": { "type": "automatic" }
            },
            "layout": { "x": 0, "y": 5, "width": 3, "height": 4 }
          },
          {
            "id": 3293109215571591,
            "definition": {
              "title": "HTTP Request Handlers (Slowest)",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.api_server.http_request_duration_seconds.sum{$zone,$instance_id,$cluster_name} by {handler}.as_count()",
                      "aggregator": "avg"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "sum:kuma.api_server.http_request_duration_seconds.count{$zone,$instance_id,$cluster_name} by {handler}.as_count()",
                      "aggregator": "avg"
                    }
                  ],
                  "response_format": "scalar",
                  "formulas": [
                    {
                      "formula": "query1 / query2",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      }
                    }
                  ],
                  "sort": {
                    "order_by": [
                      { "type": "formula", "index": 0, "order": "desc" }
                    ],
                    "count": 10
                  }
                }
              ],
              "style": {
                "display": { "type": "stacked", "legend": "automatic" },
                "palette": "dog_classic"
              }
            },
            "layout": { "x": 3, "y": 5, "width": 3, "height": 4 }
          }
        ]
      },
      "layout": { "x": 6, "y": 0, "width": 6, "height": 10 }
    },
    {
      "id": 70369271856783,
      "definition": {
        "title": "Store",
        "background_color": "vivid_purple",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 7474291901161303,
            "definition": {
              "type": "note",
              "content": "The Store component provides persistent storage for all Kuma resources including meshes, policies, and data plane configurations.",
              "background_color": "purple",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "center",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 12, "height": 1 }
          },
          {
            "id": 7258737497088913,
            "definition": {
              "title": "Store Latency",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.store.sum{$zone,$instance_id,$cluster_name} by {operation}.as_count()"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "sum:kuma.store.count{$zone,$instance_id,$cluster_name} by {operation}.as_count()"
                    }
                  ],
                  "formulas": [
                    {
                      "formula": "query1 / query2",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      }
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 0, "y": 1, "width": 3, "height": 2 }
          },
          {
            "id": 4488770992649380,
            "definition": {
              "title": "Store Operations",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.store.count{$instance_id,$zone,$cluster_name} by {resource_type,operation}.as_rate()"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": { "x": 3, "y": 1, "width": 3, "height": 4 }
          },
          {
            "id": 8266214355863501,
            "definition": {
              "title": "Top Store Operations",
              "title_size": "16",
              "title_align": "left",
              "type": "toplist",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.store.count{$instance_id,$zone,$cluster_name} by {resource_type,operation}.as_count()",
                      "aggregator": "sum"
                    }
                  ],
                  "response_format": "scalar",
                  "formulas": [{ "formula": "query1" }],
                  "sort": {
                    "count": 10,
                    "order_by": [
                      { "type": "formula", "index": 0, "order": "desc" }
                    ]
                  }
                }
              ],
              "style": {
                "display": { "type": "stacked", "legend": "automatic" }
              }
            },
            "layout": { "x": 6, "y": 1, "width": 6, "height": 4 }
          },
          {
            "id": 5156393943933849,
            "definition": {
              "title": "Store Cache Performance",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "sum:kuma.store_cache.count{$instance_id,$zone,result:miss,$cluster_name}.as_rate().rollup(avg, 15)"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.store_cache.count{$instance_id,$zone,$cluster_name}.as_rate().rollup(avg, 15)"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query3",
                      "query": "sum:kuma.store_cache.count{$instance_id,$zone,result:hit-wait,$cluster_name}.as_rate().rollup(avg, 15)"
                    }
                  ],
                  "formulas": [
                    {
                      "alias": "miss",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      },
                      "formula": "query2 / query1 * 100"
                    },
                    {
                      "alias": "hit-wait",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      },
                      "formula": "query3 / query1 * 100"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "yaxis": { "include_zero": true, "min": "0", "max": "100" },
              "markers": [
                { "value": "0 < y < 20", "display_type": "ok dashed" },
                { "value": "20 < y < 100", "display_type": "warning dashed" }
              ]
            },
            "layout": { "x": 0, "y": 3, "width": 3, "height": 2 }
          }
        ]
      },
      "layout": { "x": 0, "y": 10, "width": 12, "height": 6 }
    },
    {
      "id": 511652203180117,
      "definition": {
        "title": "Kuma Overview",
        "background_color": "vivid_purple",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 7014562644700263,
            "definition": {
              "type": "note",
              "content": "Monitor the overall health and scale of your Kuma deployment. This section tracks key infrastructure metrics including the number of meshes, zones, control planes, and data plane proxies. Use these metrics to understand your service mesh topology and identify potential capacity issues.",
              "background_color": "purple",
              "font_size": "14",
              "text_align": "left",
              "vertical_align": "center",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 6, "height": 1 }
          },
          {
            "id": 7036472294759965,
            "definition": {
              "title": "Meshes",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "aggregator": "last",
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.resources_count{$zone,$instance_id,resource_type:mesh,$cluster_name}"
                    }
                  ],
                  "response_format": "scalar",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 0,
                      "palette": "white_on_green"
                    }
                  ]
                }
              ],
              "autoscale": true,
              "precision": 0,
              "timeseries_background": {
                "yaxis": { "include_zero": true },
                "type": "area"
              }
            },
            "layout": { "x": 0, "y": 1, "width": 3, "height": 1 }
          },
          {
            "id": 6296165553849505,
            "definition": {
              "title": "Control Planes",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "formulas": [{ "formula": "count_nonzero(query1)" }],
                  "queries": [
                    {
                      "aggregator": "last",
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.cp_info{$zone,$instance_id,$cluster_name}"
                    }
                  ],
                  "response_format": "scalar",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 0,
                      "palette": "white_on_green"
                    }
                  ]
                }
              ],
              "autoscale": true,
              "precision": 0,
              "timeseries_background": {
                "yaxis": { "include_zero": true },
                "type": "area"
              }
            },
            "layout": { "x": 3, "y": 1, "width": 3, "height": 1 }
          },
          {
            "id": 1961361683236054,
            "definition": {
              "title": "Zones",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "aggregator": "last",
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.resources_count{$zone,$instance_id,resource_type:zone,$cluster_name}"
                    }
                  ],
                  "response_format": "scalar",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 0,
                      "palette": "white_on_green"
                    }
                  ]
                }
              ],
              "autoscale": true,
              "precision": 0,
              "timeseries_background": {
                "yaxis": { "include_zero": true },
                "type": "area"
              }
            },
            "layout": { "x": 0, "y": 2, "width": 3, "height": 1 }
          },
          {
            "id": 6954919323449161,
            "definition": {
              "title": "Dataplanes",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "aggregator": "last",
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.resources_count{$zone,$instance_id,resource_type:dataplane,$cluster_name}"
                    }
                  ],
                  "response_format": "scalar",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 0,
                      "palette": "white_on_green"
                    }
                  ]
                }
              ],
              "autoscale": true,
              "precision": 0,
              "timeseries_background": {
                "yaxis": { "include_zero": true },
                "type": "area"
              }
            },
            "layout": { "x": 3, "y": 2, "width": 3, "height": 1 }
          },
          {
            "id": 4573596145869244,
            "definition": {
              "title": "Control Plane Instances",
              "title_size": "16",
              "title_align": "left",
              "type": "query_table",
              "requests": [
                {
                  "queries": [
                    {
                      "aggregator": "last",
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:kuma.cp_info{$zone,$instance_id,$cluster_name} by {zone,cluster_name,instance_id,kube_service,kuma_version}"
                    }
                  ],
                  "response_format": "scalar",
                  "sort": {
                    "count": 500,
                    "order_by": [
                      { "type": "formula", "index": 0, "order": "desc" }
                    ]
                  },
                  "formulas": [
                    {
                      "cell_display_mode": "number",
                      "alias": "Control Plane",
                      "formula": "query1"
                    }
                  ]
                }
              ],
              "has_search_bar": "auto"
            },
            "layout": { "x": 0, "y": 3, "width": 6, "height": 2 }
          },
          {
            "id": 3277487101734384,
            "definition": {
              "title": "Resources",
              "title_size": "16",
              "title_align": "left",
              "requests": [
                {
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:kuma.resources_count{$zone,$instance_id,$cluster_name} by {resource_type}",
                      "aggregator": "avg"
                    }
                  ],
                  "response_format": "scalar",
                  "style": { "palette": "datadog16" },
                  "formulas": [{ "formula": "query1" }],
                  "sort": {
                    "count": 500,
                    "order_by": [
                      { "type": "formula", "index": 0, "order": "desc" }
                    ]
                  }
                }
              ],
              "type": "sunburst",
              "legend": { "type": "automatic" }
            },
            "layout": { "x": 0, "y": 5, "width": 6, "height": 4 }
          }
        ]
      },
      "layout": {
        "x": 0,
        "y": 0,
        "width": 6,
        "height": 10,
        "is_column_break": true
      }
    },
    {
      "id": 8542817691306961,
      "definition": {
        "title": "xDS",
        "background_color": "vivid_purple",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 1477222529832088,
            "definition": {
              "type": "note",
              "content": "The xDS (discovery service) protocol enables dynamic configuration updates from the control plane to Envoy data plane proxies. This section monitors the health and performance of configuration delivery, which is critical for applying policies and routing changes.",
              "background_color": "purple",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "center",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 6, "height": 1 }
          },
          {
            "id": 1631242990744119,
            "definition": {
              "title": "Active Connections",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:kuma.xds.streams_active{$zone,$instance_id,$cluster_name}"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "area"
                }
              ]
            },
            "layout": { "x": 0, "y": 1, "width": 3, "height": 2 }
          },
          {
            "id": 3691350682865210,
            "definition": {
              "title": "Envoy Config Generations",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    {
                      "alias": "error",
                      "style": { "palette": "dd20", "palette_index": 17 },
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "operation"
                        }
                      },
                      "formula": "query2"
                    },
                    {
                      "alias": "success",
                      "style": { "palette": "dd20", "palette_index": 3 },
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "operation"
                        }
                      },
                      "formula": "query1 - query2"
                    }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "sum:kuma.xds.generation_errors.count{$zone,$instance_id,$cluster_name}.as_rate().rollup(avg, 15)"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.xds.generation.count{$zone,$instance_id,$cluster_name}.as_rate().rollup(avg, 15)"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": { "x": 3, "y": 1, "width": 3, "height": 2 }
          },
          {
            "id": 1846519345009893,
            "definition": {
              "title": "Responses",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "operation"
                        }
                      },
                      "alias": "responses",
                      "formula": "query1"
                    }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.xds.responses_sent.count{$zone,$instance_id,$cluster_name}.as_rate().rollup(avg, 15)"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": { "x": 0, "y": 3, "width": 3, "height": 2 }
          },
          {
            "id": 4308218408630842,
            "definition": {
              "title": "Config Delivery Latency (99th Percentile)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:kuma.xds.delivery.quantile{$zone,quantile:0.99,$instance_id,$cluster_name}"
                    }
                  ],
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "millisecond"
                        }
                      },
                      "formula": "query1"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 3, "y": 3, "width": 3, "height": 2 }
          },
          {
            "id": 6667086618085281,
            "definition": {
              "title": "Config Generation Latency (p99)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:kuma.xds.generation.quantile{$zone,quantile:0.99,proxy_type:dataplane,$instance_id,$cluster_name}"
                    }
                  ],
                  "formulas": [
                    {
                      "formula": "query1",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "millisecond"
                        }
                      }
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 0, "y": 5, "width": 3, "height": 2 }
          },
          {
            "id": 5503152987182677,
            "definition": {
              "title": "Requests",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "operation"
                        }
                      },
                      "alias": "received",
                      "formula": "query2"
                    }
                  ],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "sum:kuma.xds.requests_received.count{$zone,$instance_id,$cluster_name} by {confirmation}.as_count().rollup(avg, 15)"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": { "x": 3, "y": 5, "width": 3, "height": 2 }
          },
          {
            "id": 3404201926886316,
            "definition": {
              "title": "Endpoints Cache Performance",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query2",
                      "query": "avg:kuma.cla_cache{$instance_id,$zone,result:miss,$cluster_name}.rollup(avg, 15)"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:kuma.cla_cache{$instance_id,$zone,$cluster_name}.rollup(avg, 15)"
                    },
                    {
                      "data_source": "metrics",
                      "name": "query3",
                      "query": "avg:kuma.cla_cache{$instance_id,$zone,result:hit-wait,$cluster_name}.rollup(avg, 15)"
                    }
                  ],
                  "formulas": [
                    {
                      "alias": "miss",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      },
                      "formula": "per_second(query2) / per_second(query1) * 100"
                    },
                    {
                      "alias": "hit-wait",
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "percent"
                        }
                      },
                      "formula": "per_second(query3) / per_second(query1) * 100"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "yaxis": { "include_zero": true, "min": "0", "max": "100" },
              "markers": [
                { "value": "20 < y < 100", "display_type": "warning dashed" },
                { "value": "0 < y < 20", "display_type": "ok dashed" }
              ]
            },
            "layout": { "x": 0, "y": 7, "width": 4, "height": 2 }
          },
          {
            "id": 3404201926886317,
            "definition": {
              "type": "note",
              "content": "**hit-wait**: Requests waiting for another request to populate cache - normal during high concurrency",
              "background_color": "purple",
              "font_size": "12",
              "text_align": "left",
              "vertical_align": "center",
              "show_tick": true,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 4, "y": 7, "width": 2, "height": 2 }
          }
        ]
      },
      "layout": { "x": 6, "y": 0, "width": 6, "height": 10 }
    },
    {
      "id": 2708736787343333,
      "definition": {
        "title": "Leader",
        "background_color": "vivid_purple",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 3741078862595649,
            "definition": {
              "type": "note",
              "content": "Each Kuma zone must have exactly one leader instance for proper operation.",
              "background_color": "purple",
              "font_size": "14",
              "text_align": "left",
              "vertical_align": "center",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 6, "height": 1 }
          },
          {
            "id": 8661086842802331,
            "definition": {
              "title": "Leaders",
              "title_size": "16",
              "title_align": "left",
              "type": "query_value",
              "requests": [
                {
                  "formulas": [{ "formula": "count_nonzero(query1)" }],
                  "queries": [
                    {
                      "aggregator": "last",
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.leader{$zone,$instance_id,$cluster_name}"
                    }
                  ],
                  "response_format": "scalar",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 0,
                      "palette": "white_on_green"
                    }
                  ]
                }
              ],
              "autoscale": true,
              "precision": 0,
              "timeseries_background": {
                "yaxis": { "include_zero": true },
                "type": "area"
              }
            },
            "layout": { "x": 0, "y": 1, "width": 2, "height": 2 }
          },
          {
            "id": 2698193577791332,
            "definition": {
              "title": "Leader Instances",
              "title_size": "16",
              "title_align": "left",
              "type": "query_table",
              "requests": [
                {
                  "queries": [
                    {
                      "aggregator": "last",
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:kuma.leader{$zone,$instance_id,$cluster_name} by {cluster_name,zone,kube_service}"
                    }
                  ],
                  "response_format": "scalar",
                  "sort": {
                    "count": 500,
                    "order_by": [
                      { "type": "formula", "index": 0, "order": "desc" }
                    ]
                  },
                  "formulas": [
                    {
                      "cell_display_mode": "number",
                      "alias": "Leader",
                      "formula": "query1"
                    }
                  ]
                }
              ],
              "has_search_bar": "auto"
            },
            "layout": { "x": 2, "y": 1, "width": 4, "height": 2 }
          },
          {
            "id": 8614340111303112,
            "definition": {
              "title": "Leader Election Status",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "formulas": [{ "formula": "query1" }],
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "avg:kuma.leader_election.master_status{$instance_id,$cluster_name} by {name,kube_service,host}"
                    }
                  ],
                  "response_format": "timeseries",
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ],
              "yaxis": { "include_zero": true, "min": "0", "max": "1.5" },
              "markers": [
                {
                  "label": " Backup ",
                  "value": "-0.5 < y < 0.5",
                  "display_type": "info dashed"
                },
                {
                  "label": " Leader ",
                  "value": "0.5 < y < 1.5",
                  "display_type": "ok dashed"
                }
              ]
            },
            "layout": { "x": 0, "y": 3, "width": 6, "height": 2 }
          }
        ]
      },
      "layout": { "x": 0, "y": 10, "width": 6, "height": 6 }
    },
    {
      "id": 8781148049763819,
      "definition": {
        "title": "Go Runtime",
        "background_color": "vivid_purple",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 5710359456796066,
            "definition": {
              "type": "note",
              "content": "Go runtime metrics provide insights into the resource utilization and performance characteristics of Kuma control plane components.",
              "background_color": "purple",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "center",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 6, "height": 1 }
          },
          {
            "id": 5151573599414004,
            "definition": {
              "title": "Goroutines",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.go.goroutines{$zone,$instance_id,$cluster_name}"
                    }
                  ],
                  "formulas": [{ "number_format": {}, "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": { "x": 0, "y": 1, "width": 3, "height": 2 }
          },
          {
            "id": 7354433772896516,
            "definition": {
              "title": "Threads",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.go.threads{$zone,$instance_id,$cluster_name}"
                    }
                  ],
                  "formulas": [{ "number_format": {}, "formula": "query1" }],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "bars"
                }
              ]
            },
            "layout": { "x": 3, "y": 1, "width": 3, "height": 2 }
          },
          {
            "id": 5669383081664033,
            "definition": {
              "title": "Memory Allocated",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.go.memstats.alloc_bytes{$zone,$instance_id,$cluster_name}.rollup(avg, 15)"
                    }
                  ],
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "byte_in_binary_bytes_family"
                        }
                      },
                      "formula": "per_second(query1)"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 0, "y": 3, "width": 3, "height": 2 }
          },
          {
            "id": 7170770919490113,
            "definition": {
              "title": "GC Latency (p75)",
              "title_size": "16",
              "title_align": "left",
              "show_legend": true,
              "legend_layout": "auto",
              "legend_columns": ["avg", "min", "max", "value", "sum"],
              "type": "timeseries",
              "requests": [
                {
                  "response_format": "timeseries",
                  "queries": [
                    {
                      "data_source": "metrics",
                      "name": "query1",
                      "query": "sum:kuma.go.gc.duration_seconds.quantile{$zone,$instance_id,quantile:0.75,$cluster_name}.rollup(avg, 15)"
                    }
                  ],
                  "formulas": [
                    {
                      "number_format": {
                        "unit": {
                          "type": "canonical_unit",
                          "unit_name": "second"
                        }
                      },
                      "formula": "query1"
                    }
                  ],
                  "style": {
                    "palette": "dog_classic",
                    "order_by": "values",
                    "line_type": "solid",
                    "line_width": "normal"
                  },
                  "display_type": "line"
                }
              ]
            },
            "layout": { "x": 3, "y": 3, "width": 3, "height": 2 }
          }
        ]
      },
      "layout": { "x": 6, "y": 10, "width": 6, "height": 6 }
    },
    {
      "id": 842504469602646,
      "definition": {
        "title": "Control Plane Logs",
        "background_color": "vivid_purple",
        "show_title": true,
        "type": "group",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 5895555829538668,
            "definition": {
              "type": "note",
              "content": "Kuma control plane logs provide detailed insights into system operations and error conditions. Log are aggregated by patterns.",
              "background_color": "purple",
              "font_size": "14",
              "text_align": "center",
              "vertical_align": "top",
              "show_tick": false,
              "tick_pos": "50%",
              "tick_edge": "left",
              "has_padding": true
            },
            "layout": { "x": 0, "y": 0, "width": 12, "height": 1 }
          },
          {
            "id": 1173713165327207,
            "definition": {
              "title": "All Control Plane Logs",
              "title_size": "16",
              "title_align": "left",
              "requests": [
                {
                  "columns": [
                    { "field": "status_line", "width": "auto" },
                    { "field": "matches", "width": "auto" },
                    { "field": "volume", "width": "auto" },
                    { "field": "@component", "width": "auto" },
                    { "field": "source", "width": "auto" },
                    { "field": "service", "width": "auto" },
                    { "field": "message", "width": "auto" }
                  ],
                  "query": {
                    "data_source": "logs_pattern_stream",
                    "group_by": [
                      { "facet": "@component" },
                      { "facet": "source" },
                      { "facet": "service" }
                    ],
                    "indexes": [],
                    "query_string": "source:kuma service:kuma-control-plane $cluster_name"
                  },
                  "response_format": "event_list"
                }
              ],
              "type": "list_stream"
            },
            "layout": { "x": 0, "y": 1, "width": 12, "height": 4 }
          },
          {
            "id": 3679723625506016,
            "definition": {
              "title": "Control Plane Error Logs",
              "title_size": "16",
              "title_align": "left",
              "requests": [
                {
                  "columns": [
                    { "field": "status_line", "width": "auto" },
                    { "field": "matches", "width": "auto" },
                    { "field": "volume", "width": "auto" },
                    { "field": "@component", "width": "auto" },
                    { "field": "source", "width": "auto" },
                    { "field": "service", "width": "auto" },
                    { "field": "message", "width": "auto" }
                  ],
                  "query": {
                    "data_source": "logs_pattern_stream",
                    "group_by": [
                      { "facet": "@component" },
                      { "facet": "source" },
                      { "facet": "service" }
                    ],
                    "indexes": [],
                    "query_string": "source:kuma service:kuma-control-plane status:error $cluster_name"
                  },
                  "response_format": "event_list"
                }
              ],
              "type": "list_stream"
            },
            "layout": { "x": 0, "y": 5, "width": 12, "height": 5 }
          }
        ]
      },
      "layout": { "x": 0, "y": 16, "width": 12, "height": 11 }
    }
  ],
  "template_variables": [
    {
      "name": "instance_id",
      "prefix": "instance_id",
      "available_values": [],
      "default": "*"
    },
    {
      "name": "zone",
      "prefix": "zone",
      "available_values": [],
      "default": "*"
    },
    {
      "name": "cluster_name",
      "prefix": "cluster_name",
      "available_values": [],
      "default": "*"
    }
  ],
  "layout_type": "ordered",
  "notify_list": [],
  "reflow_type": "fixed"
}
