name: Octopus Deploy
files:
- name: octopus_deploy.yaml
  options:
  - template: init_config
    options:
    - template: init_config/default
    - template: init_config/http
  - template: instances
    options:
    - name: octopus_endpoint
      display_priority: 8
      description: |
        Octopus API endpoint.
        See https://octopus.com/docs/octopus-rest-api/getting-started#authentication for more details.
      value:
        example: http://localhost:80/api
        type: string
      required: true
    - name: spaces
      display_priority: 5
      description: |
        Filter your integration by spaces.
      value:
        type: object
        properties:
          - name: limit
            description: |
              Maximum number of spaces to be processed.
            type: integer
          - name: include
            type: array
            items:
              anyOf:
                - type: string
                - type: object
          - name: exclude
            type: array
            items:
              type: string
          - name: interval
            type: integer
        example: {}
    - name: project_groups
      display_priority: 5
      description: |
        Filter your integration by project groups and projects.
      value:
        type: object
        properties:
          - name: limit
            description: |
              Maximum number of project groups to be processed.
            type: integer
          - name: include
            type: array
            items:
              anyOf:
                - type: string
                - type: object
          - name: exclude
            type: array
            items:
              type: string
          - name: interval
            type: integer
        example: {}
    - name: projects
      display_priority: 5
      description: |
        Filter your integration by projects.
      value:
        type: object
        properties:
          - name: limit
            description: |
              Maximum number of projects to be processed.
            type: integer
          - name: include
            type: array
            items:
              anyOf:
                - type: string
                - type: object
          - name: exclude
            type: array
            items:
              type: string
          - name: interval
            type: integer
        example: {}
    - template: instances/default
    - template: instances/http
      overrides:
        headers.display_priority: 6
        headers.enabled: true
        headers.description: |
          Headers to use for every request. An Authorization header including the Octopus Deploy API key token is required
          for authentication for the REST API.
          You can alternatively use the `auth_token` option.

        headers.value.example:
          X-Octopus-ApiKey: "<OCTOPUS_API_KEY>"
        auth_token.display_priority: 4
  - template: logs
    example:
    - type: integration
      source: octopus-deploy
      service: <SERVICE_NAME>