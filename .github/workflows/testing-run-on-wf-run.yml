name: Run on PR Check

on:
  # workflow_run:
  #   workflows: ['Check PR']
  #   types:
  #     - completed
  pull_request:

jobs:
  run-on-pr-check:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          fetch-depth: 0
      - name: Set up Python
        uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065 # v5.6.0
        with:
          python-version: '3.12'
      - name: Wait
        run: |
          sleep 100
      - name: Define SHA
        id: define_sha
        run: |
          # Determine if the triggering event was a push or a pull request
          # if [[ "${{ github.event.workflow_run.event }}" == "push" ]]; then
          #   echo "Triggered by push"
          #   sha=${{ github.sha }}
          # elif [[ "${{ github.event.workflow_run.event }}" == "pull_request" ]]; then
          #   echo "Triggered by pull_request"
          #   sha=${{ github.event.pull_request.head.sha }}
          # else
          #   echo "Triggered by unknown event: ${{ github.event.workflow_run.event }}"
          #   sha=${{ github.sha }}
          # fi
          sha = ${{ github.event.pull_request.head.sha }}
          echo "sha=$sha" >> $GITHUB_OUTPUT
      - name: Get run ID
        run: |
          run_id=$(gh run list --workflow "Check PR" -c ${{ steps.define_sha.outputs.sha }} --json databaseId --jq '.[-1].databaseId')
          echo "run_id=$run_id"          
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}