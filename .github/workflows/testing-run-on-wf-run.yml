name: Run on PR Check

on:
  workflow_run:
    workflows: ['Resolve Dependencies and Build Wheels']
    types:
      - completed

jobs:
  run-on-pr-check:
    runs-on: ubuntu-22.04
    steps:
      - name: Checkout code
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          fetch-depth: 0
      - name: Set up Python
        uses: actions/setup-python@a26af69be951a213d495a4c3e4e4022e16d87065 # v5.6.0
        with:
          python-version: '3.12'

      - name: Define SHA
        id: define_sha
        run: |
          echo "sha=${{ github.event.workflow_run.head_sha }}" >> $GITHUB_OUTPUT
          echo "event=${{ github.event.workflow_run.event }}" >> $GITHUB_OUTPUT
          echo "ref_name=${{ github.ref_name }}" >> $GITHUB_OUTPUT
          echo "branch=${{ github.event.workflow_run.head_branch }}" >> $GITHUB_OUTPUT
          echo "pr_number=${{ github.event.workflow_run.pull_requests.number }}" >> $GITHUB_OUTPUT

      - name: Get run ID
        run: |
          echo "run_id_variable=${{ github.event.workflow_run.id }}"         
          run_id=$(gh run list --workflow ".github/workflows/resolve-build-deps.yaml" -c ${{ steps.define_sha.outputs.sha }} --json databaseId --jq '.[-1].databaseId')
          echo "run_id_list=$run_id" 
          if [ ${#DD_API_KEY} -gt 2 ]; then echo "accessible!"; else echo "not accessible"; fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DD_API_KEY: ${{ secrets.DD_API_KEY }}