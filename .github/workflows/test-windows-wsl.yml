name: Windows WSL

on:
  pull_request:
    paths:
    - .github/workflows/fips/**

jobs:
  run-linux-container:
    runs-on: windows-2025

    steps:
    - uses: Vampire/setup-wsl@v4
      with:
        distribution: Debian

    - name: Docker on WSL
      shell: wsl-bash {0}
      run: |
        sudo apt-get update
        sudo apt-get install curl -y
        curl -fsSL https://get.docker.com -o get-docker.sh
        sudo sh ./get-docker.sh
        sudo dockerd &
        sleep 5

    - uses: actions/checkout@v4

    - name: Set up servers
      shell: wsl-bash {0}
      run: |
        docker build -t http-server .github/workflows/fips/compose/linux/
        docker run -d -p 443:443 --network host http-server ./start-server.sh ECDHE-RSA-AES128-SHA256
        sleep 5
        curl https://localhost:433

    - name: Check connection
      run: |
        curl https://localhost:433
        curl https://http-server:433
