id: zscaler-private-access
metric_id: zscaler-private-access
backend_only: false
facets:
  - groups:
      - Web Access
    name: Method
    path: http.method
    source: log
  - groups:
      - Web Access
    name: Status Code
    path: http.status_code
    source: log
  - groups:
      - Web Access
    name: URL Path
    path: http.url
    source: log
  - groups:
      - Web Access
    name: User-Agent
    path: http.useragent
    source: log
  - groups:
      - Web Access
    name: Browser
    path: http.useragent_details.browser.family
    source: log
  - groups:
      - Web Access
    name: Device
    path: http.useragent_details.device.family
    source: log
  - groups:
      - Web Access
    name: OS
    path: http.useragent_details.os.family
    source: log
  - groups:
      - Web Access
    name: Version
    path: http.version
    source: log
  - groups:
      - Geoip
    name: City Name
    path: network.client.geoip.city.name
    source: log
  - groups:
      - Geoip
    name: Continent Code
    path: network.client.geoip.continent.code
    source: log
  - groups:
      - Geoip
    name: Continent Name
    path: network.client.geoip.continent.name
    source: log
  - groups:
      - Geoip
    name: Country ISO Code
    path: network.client.geoip.country.iso_code
    source: log
  - groups:
      - Geoip
    name: Country Name
    path: network.client.geoip.country.name
    source: log
  - groups:
      - Geoip
    name: Subdivision ISO Code
    path: network.client.geoip.subdivision.iso_code
    source: log
  - groups:
      - Geoip
    name: Subdivision Name
    path: network.client.geoip.subdivision.name
    source: log
  - groups:
      - Web Access
    name: Client IP
    path: network.client.ip
    source: log
  - groups:
      - Web Access
    name: Client Port
    path: network.client.port
    source: log
  - groups:
      - Geoip
    name: Destination City Name
    path: network.destination.geoip.city.name
    source: log
  - groups:
      - Geoip
    name: Destination Continent Code
    path: network.destination.geoip.continent.code
    source: log
  - groups:
      - Geoip
    name: Destination Continent Name
    path: network.destination.geoip.continent.name
    source: log
  - groups:
      - Geoip
    name: Destination Country ISO Code
    path: network.destination.geoip.country.iso_code
    source: log
  - groups:
      - Geoip
    name: Destination Country Name
    path: network.destination.geoip.country.name
    source: log
  - groups:
      - Geoip
    name: Destination Subdivision ISO Code
    path: network.destination.geoip.subdivision.iso_code
    source: log
  - groups:
      - Geoip
    name: Destination Subdivision Name
    path: network.destination.geoip.subdivision.name
    source: log
  - groups:
      - Web Access
    name: Destination IP
    path: network.destination.ip
    source: log
  - groups:
      - Web Access
    name: Destination Port
    path: network.destination.port
    source: log
  - groups:
      - User
    name: User Email
    path: usr.email
    source: log
  - groups:
      - User
    name: User ID
    path: usr.id
    source: log
  - groups:
      - User
    name: User Name
    path: usr.name
    source: log

pipeline:
  type: pipeline
  name: Zscaler Private Access
  enabled: true
  filter:
    query: source:zscaler-private-access
  processors:
    - type: service-remapper
      name: Define `EventType` as the official service of the log
      enabled: true
      sources:
        - EventType
    - type: pipeline
      name: Audit Logs
      enabled: true
      filter:
        query: service:audit-logs
      processors:
        - type: attribute-remapper
          name: Map `CreationTime` to `timestamp`
          enabled: true
          sources:
            - CreationTime
          sourceType: attribute
          target: timestamp
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `ModifiedBy` to `usr.id`
          enabled: true
          sources:
            - ModifiedBy
          sourceType: attribute
          target: usr.id
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `User` to `usr.email`
          enabled: true
          sources:
            - User
          sourceType: attribute
          target: usr.email
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: App Connector or Private Service Edge or Private Cloud Controller Status
      enabled: true
      filter:
        query: service:app-connector-status OR service:private-service-edge-status OR
          service:private-cloud-controller-status
      processors:
        - type: attribute-remapper
          name: Map `PublicIP` to `network.client.ip`
          enabled: true
          sources:
            - PublicIP
          sourceType: attribute
          target: network.client.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: User Status
      enabled: true
      filter:
        query: service:user-status
      processors:
        - type: attribute-remapper
          name: Map `PublicIP` to `network.client.ip`
          enabled: true
          sources:
            - PublicIP
          sourceType: attribute
          target: network.client.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `Username` to `usr.name`
          enabled: true
          sources:
            - Username
          sourceType: attribute
          target: usr.name
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: array-processor
          name: Set `PosturesMissCount` as the array length of `PosturesMisses`
          enabled: true
          operation:
            source: PosturesMisses
            target: PosturesMissCount
            type: length
        - type: array-processor
          name: Set `PosturesHitCount` as the array length of `PosturesHit`
          enabled: true
          operation:
            source: PosturesHit
            target: PosturesHitCount
            type: length
    - type: pipeline
      name: App Protection
      enabled: true
      filter:
        query: service:app-protection
      processors:
        - type: attribute-remapper
          name: Map `ClientPublicIp` to `network.client.ip`
          enabled: true
          sources:
            - ClientPublicIp
          sourceType: attribute
          target: network.client.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `ClientPort` to `network.client.port`
          enabled: true
          sources:
            - ClientPort
          sourceType: attribute
          target: network.client.port
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `UserID` to `usr.id`
          enabled: true
          sources:
            - UserID
          sourceType: attribute
          target: usr.id
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `URL` to `http.url`
          enabled: true
          sources:
            - URL
          sourceType: attribute
          target: http.url
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `UserAgent` to `http.useragent`
          enabled: true
          sources:
            - UserAgent
          sourceType: attribute
          target: http.useragent
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: user-agent-parser
          name: Extracting useragent details from htttp.useragent
          enabled: true
          sources:
            - http.useragent
          target: http.useragent_details
          encoded: false
          combineVersionDetails: false
        - type: attribute-remapper
          name: Map `Method` to `http.method`
          enabled: true
          sources:
            - Method
          sourceType: attribute
          target: http.method
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `ProtocolVersion` to `http.version`
          enabled: true
          sources:
            - ProtocolVersion
          sourceType: attribute
          target: http.version
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `StatusCode` to `http.status_code`
          enabled: true
          sources:
            - StatusCode
          sourceType: attribute
          target: http.status_code
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: Browser Access
      enabled: true
      filter:
        query: service:browser-access
      processors:
        - type: attribute-remapper
          name: Map `ClientPublicIp` to `network.client.ip`
          enabled: true
          sources:
            - ClientPublicIp
          sourceType: attribute
          target: network.client.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `URL` to `http.url`
          enabled: true
          sources:
            - URL
          sourceType: attribute
          target: http.url
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `UserAgent` to `http.useragent`
          enabled: true
          sources:
            - UserAgent
          sourceType: attribute
          target: http.useragent
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: user-agent-parser
          name: Extracting useragent details from htttp.useragent
          enabled: true
          sources:
            - http.useragent
          target: http.useragent_details
          encoded: false
          combineVersionDetails: false
        - type: attribute-remapper
          name: Map `Method` to `http.method`
          enabled: true
          sources:
            - Method
          sourceType: attribute
          target: http.method
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `StatusCode` to `http.status_code`
          enabled: true
          sources:
            - StatusCode
          sourceType: attribute
          target: http.status_code
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `NameID` to `usr.id`
          enabled: true
          sources:
            - NameID
          sourceType: attribute
          target: usr.id
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: User Activity
      enabled: true
      filter:
        query: service:user-activity
      processors:
        - type: attribute-remapper
          name: Map `ClientPublicIP` to `network.client.ip`
          enabled: true
          sources:
            - ClientPublicIP
          sourceType: attribute
          target: network.client.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `ServerIP` to `network.destination.ip`
          enabled: true
          sources:
            - ServerIP
          sourceType: attribute
          target: network.destination.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: geo-ip-parser
          name: GeoIp Parser for `network.destination.ip`
          enabled: true
          sources:
            - network.destination.ip
          target: network.destination.geoip
          ip_processing_behavior: do-nothing
        - type: attribute-remapper
          name: Map `ServerPort` to `network.destination.port`
          enabled: true
          sources:
            - ServerPort
          sourceType: attribute
          target: network.destination.port
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `Username` to `usr.name`
          enabled: true
          sources:
            - Username
          sourceType: attribute
          target: usr.name
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - name: Lookup for `IPProtocol` to `IPProtocolName` field
          enabled: true
          source: IPProtocol
          target: IPProtocolName
          lookupTable: |-
            6,tcp
            17,udp
            1,icmp
          type: lookup-processor
    - type: pipeline
      name: Microsegmentation
      enabled: true
      filter:
        query: service:microsegmentation
      processors:
        - type: attribute-remapper
          name: Map `DestinationIP` to `network.destination.ip`
          enabled: true
          sources:
            - DestinationIP
          sourceType: attribute
          target: network.destination.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: geo-ip-parser
          name: GeoIp Parser for `network.destination.ip`
          enabled: true
          sources:
            - network.destination.ip
          target: network.destination.geoip
          ip_processing_behavior: do-nothing
        - name: Lookup for `Protocol` to `ProtocolName` field
          enabled: true
          source: Protocol
          target: ProtocolName
          lookupTable: |-
            6,tcp
            17,udp
            1,icmp
          type: lookup-processor
    - type: geo-ip-parser
      name: GeoIp Parser for `network.client.ip`
      enabled: true
      sources:
        - network.client.ip
      target: network.client.geoip
      ip_processing_behavior: do-nothing
    - type: grok-parser
      name: Extract the `LogTimestamp` value from logs
      enabled: true
      source: LogTimestamp
      samples:
        - Wed Jul 30 10:06:01 2025
        - Fri May 6 11:40:00 2022
      grok:
        supportRules: ""
        matchRules: |-
          date_1 %{date("EEE MMM dd HH:mm:ss yyyy"):timestamp}
          date_2 %{date("EEE MMM d HH:mm:ss yyyy"):timestamp}
    - type: date-remapper
      name: Define `timestamp` as the official date of the log
      enabled: true
      sources:
        - timestamp
