name: Nutanix
files:
  - name: nutanix.yaml
    options:
      - template: init_config
        options:
          - template: init_config/default
      - template: instances
        options:
          - name: pc_ip
            description: |
              The IP address or FQDN of the Prism Central.
              This is required to connect to your Nutanix Prism Central instance.

              You can optionally include the port in this field (e.g., 'prism-central.example.com:9440').
              If a port is specified here, do not set the pc_port option, as this will cause a configuration error.
            required: true
            display_priority: 5
            value:
              type: string
              example: prism-central.example.com
          - name: pc_port
            description: |
              The port of the Prism Central API.
              Default is 9440 for HTTPS.

              Note: If you include the port in the pc_ip field (e.g., 'prism-central.example.com:9440'),
              do not set this option as it will cause a configuration error.
            display_priority: 4
            value:
              type: integer
              example: 9440
          - name: pc_username
            description: |
              The username to authenticate with Prism Central.
            required: true
            display_priority: 3
            value:
              type: string
          - name: pc_password
            description: |
              The password to authenticate with Prism Central.
            required: true
            display_priority: 2
            value:
              type: string
          - name: page_limit
            description: |
              The maximum number of items to retrieve per page when making paginated API requests.
              This controls the page size for API calls to Prism Central.
              Default is 50. Increase this value to reduce the number of API calls for large environments.
            display_priority: 1
            value:
              type: integer
              example: 50
          - name: pc_max_retries
            description: |
              The maximum number of retry attempts for API requests when rate limited by Prism Central API.
              Set to 0 to disable retries. Default is 3.
            value:
              type: integer
              example: 3
          - name: pc_base_backoff_seconds
            description: |
              The initial backoff duration in seconds when retrying rate-limited requests.
              The actual backoff time uses exponential backoff: base * (2 ^ attempt) + jitter.
              Default is 1 second.
            value:
              type: number
              example: 1
          - name: pc_max_backoff_seconds
            description: |
              The maximum backoff duration in seconds when retrying rate-limited requests.
              This caps the exponential backoff calculation to prevent excessive wait times.
              Default is 30 seconds.
            value:
              type: number
              example: 30
          - name: resource_filters
            description: |
              Filter infrastructure metrics and activity data (events, tasks, alerts, audits)
              by cluster, host, VM, or activity attributes. Each filter: 'resource', 'patterns' (regex list),
              'type' (include default, or exclude). Exclude wins over include. No filters = collect all.

              Infrastructure filters (cluster|host|vm): 'property' name (default) or id.

              Activity filters:
              - Event: resource 'event', property 'type' (eventType) or 'classification'
              - Task: resource 'task', property 'status' (e.g. SUCCEEDED, FAILED, RUNNING)
              - Alert: resource 'alert', property 'severity' (INFO, WARNING, CRITICAL) or 'alertType' (e.g. A1031)

              Examples:
              - Filter by cluster name:
                - resource: cluster
                  property: name
                  patterns: ['^prod-.*']
              - Filter by host name (exclude):
                - resource: host
                  property: name
                  type: exclude
                  patterns: ['^standby-.*']
              - Filter events by type (include only PasswordAudit, LicenseAudit):
                - resource: event
                  property: type
                  patterns: ['^PasswordAudit$', '^LicenseAudit$']
              - Filter tasks by status (exclude failed/canceled):
                - resource: task
                  property: status
                  type: exclude
                  patterns: ['^FAILED$', '^CANCELED$']
              - Filter alerts by severity (include WARNING and CRITICAL):
                - resource: alert
                  property: severity
                  patterns: ['^WARNING$', '^CRITICAL$']
              - Filter alerts by alert type (API field alertType):
                - resource: alert
                  property: alertType
                  patterns: ['^A1031$', '^A130172$']
            value:
              type: array
              items:
                type: object
                properties:
                  - name: resource
                    type: string
                  - name: patterns
                    type: array
                    items:
                      type: string
                  - name: type
                    type: string
                  - name: property
                    type: string
              example:
                - resource: cluster
                  property: name
                  patterns:
                    - '^prod-.*'
                - resource: host
                  property: name
                  type: exclude
                  patterns:
                    - '^standby-.*'
                - resource: event
                  property: type
                  patterns:
                    - '^PasswordAudit$'
                    - '^LicenseAudit$'
                - resource: task
                  property: status
                  type: exclude
                  patterns:
                    - '^FAILED$'
                    - '^CANCELED$'
                - resource: alert
                  property: severity
                  patterns:
                    - '^WARNING$'
                    - '^CRITICAL$'
                - resource: alert
                  property: alertType
                  patterns:
                    - '^A1031$'
                    - '^A130172$'
          - name: collect_events
            description: |
              Whether to collect events from Prism Central.
              Default is true.
            value:
              type: boolean
              example: true
          - name: collect_alerts
            description: |
              Whether to collect alerts from Prism Central.
              Default is true.
            value:
              type: boolean
              example: true
          - template: instances/http
          - template: instances/default
            overrides:
              min_collection_interval.value.example: 120
              min_collection_interval.enabled: true
