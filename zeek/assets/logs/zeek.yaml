id: zeek
metric_id: zeek
backend_only: false
facets:
  - name: Assigned Address
    source: log
    path: assigned_addr
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Auth Attempts
    source: log
    path: auth_attempts
    type: integer
    facetType: range
    groups:
      - Zeek
  - name: Bytes
    source: log
    path: bytes
    type: integer
    facetType: range
    groups:
      - Zeek
    unit:
      name: byte
      family: bytes
  - name: Certificate Key Algorithm
    source: log
    path: certificate.key_alg
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Certificate Key Type
    source: log
    path: certificate.key_type
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Certificate Signature Algorithm
    source: log
    path: certificate.sig_alg
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Certificate Version
    source: log
    path: certificate.version
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Client Message
    source: log
    path: client_message
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Client Requested Address
    source: log
    path: request
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Client Requested Port
    source: log
    path: request_p
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Direction
    source: log
    path: direction
    type: string
    facetType: list
    groups:
      - Zeek
  - name: DNS Client
    source: log
    path: dns_client
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Duration Seconds
    source: log
    path: duration_sec
    type: double
    facetType: range
    groups:
      - Zeek
    unit:
      name: second
      family: time
  - name: File Size
    source: log
    path: file_size
    type: double
    facetType: range
    groups:
      - Zeek
    unit:
      name: byte
      family: bytes
  - name: Host Port
    source: log
    path: host_p
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Lease Time
    source: log
    path: lease_time
    type: double
    facetType: range
    groups:
      - Zeek
    unit:
      name: second
      family: time
  - name: Mac Address
    source: log
    path: mac
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Message Types
    source: log
    path: msg_types
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Missed Bytes
    source: log
    path: missed_bytes
    type: double
    facetType: range
    groups:
      - Zeek
    unit:
      name: byte
      family: bytes
  - name: Missing Bytes
    source: log
    path: missing_bytes
    type: double
    facetType: range
    groups:
      - Zeek
    unit:
      name: byte
      family: bytes
  - name: Name
    source: log
    path: zeek_name
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Notice Type
    source: log
    path: note
    type: string
    facetType: list
    groups:
      - Zeek
  - name: NTP Mode
    source: log
    path: ntp_mode
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Operation Codes
    source: log
    path: opcodes
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Originator IP
    source: log
    path: orig_h
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Originator Port
    source: log
    path: orig_p
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Overflow Bytes
    source: log
    path: overflow_bytes
    type: integer
    facetType: range
    groups:
      - Zeek
    unit:
      name: byte
      family: bytes
  - name: Percent Lost
    source: log
    path: percent_lost
    type: double
    facetType: range
    groups:
      - Zeek
  - name: Protocol
    source: log
    path: zeek_proto
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Requested Address
    source: log
    path: requested_addr
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Responder IP
    source: log
    path: resp_h
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Responder Port
    source: log
    path: resp_p
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Seen Bytes
    source: log
    path: seen_bytes
    type: integer
    facetType: range
    groups:
      - Zeek
    unit:
      name: byte
      family: bytes
  - name: Server Bound Address
    source: log
    path: bound
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Server Bound Port
    source: log
    path: bound_p
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Server Message
    source: log
    path: server_message
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Size
    source: log
    path: size
    type: double
    facetType: range
    groups:
      - Zeek
    unit:
      name: byte
      family: bytes
  - name: Software Type
    source: log
    path: software_type
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Stratum
    source: log
    path: stratum
    type: string
    facetType: list
    groups:
      - Zeek
  - name: Total Bytes
    source: log
    path: total_bytes
    type: integer
    facetType: range
    groups:
      - Zeek
    unit:
      name: byte
      family: bytes
pipeline:
  type: pipeline
  name: Zeek
  enabled: true
  filter:
    query: "source:zeek"
  processors:
    - type: pipeline
      name: Processing for Corelight logs
      enabled: true
      filter:
        query: "service:corelight "
      processors:
        - type: grok-parser
          name: Parsing corelight logs
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1706513868185
            tags: []
          source: message
          samples:
            - <134>Dec 26 01:35:11 machine-name
              {"_path":"capture_loss","_write_ts":"2023-12-12T05:52:50.756358Z","ts":"2023-12-12T05:52:32.763303Z","ts_delta":15.235642194747925,"peer":"zeek","gaps":3,"acks":316,"percent_lost":0.9493670886075949}
          grok:
            supportRules: ""
            matchRules: corelight (<%{word:}>)?(%{date("MMM d HH:mm:ss"):}|%{date("MMM  d
              HH:mm:ss"):})? %{notSpace:} %{data::json}
    - type: service-remapper
      name: Define `_path` as the official service of the log
      enabled: true
      meta:
        last_update:
          timestamp: 1702017044706
          user_name: null
          user_email: tirthraj.chaudhari@crestdatasys.com
        tags: []
      sources:
        - _path
    - type: date-remapper
      name: Define `ts` as the official date of the log
      enabled: true
      meta:
        last_update:
          timestamp: 1705297517451
          user_name: null
          user_email: tirthraj.chaudhari@crestdatasys.com
        tags: []
      sources:
        - ts
    - type: pipeline
      name: Processing for conn logs
      enabled: true
      filter:
        query: "@_path:conn* "
      processors:
        - name: Lookup for `conn_state` to `connection_state` field
          enabled: true
          meta:
            last_update:
              user_id: "5188848"
              timestamp: 1703676765082
            tags: []
          source: conn_state
          target: connection_state
          lookupTable: >-
            S0,Connection attempt seen - no reply

            S1,Connection established - not terminated

            SF,Normal establishment and termination

            REJ,Connection attempt rejected

            S2,Connection established and close attempt by originator seen

            S3,Connection established and close attempt by responder seen

            RSTO,Connection established - originator aborted

            RSTR,Responder sent a RST

            RSTOS0,Originator sent a SYN followed by a RST - we never saw a SYN-ACK from the responder

            RSTRH,Responder sent a SYN ACK followed by a RST - we never saw a SYN from the (purported) originator

            SH,Originator sent a SYN followed by a FIN - we never saw a SYN ACK from the responder

            SHR,Responder sent a SYN ACK followed by a FIN - we never saw a SYN from the originator

            OTH,No SYN seen - just midstream traffic
          type: lookup-processor
    - type: pipeline
      name: Processing for pe logs
      enabled: true
      filter:
        query: "@_path:pe "
      processors:
        - name: Lookup for `is_exe` to `file_type` field
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1703677068027
            tags: []
          source: is_exe
          target: file_type
          lookupTable: |-
            true,exe
            false,other
          type: lookup-processor
    - type: pipeline
      name: Processing for reporter logs
      enabled: true
      filter:
        query: "@_path:reporter "
      processors:
        - type: grok-parser
          name: Parsing `severity` from `level` attribute
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1703150417587
            tags: []
          source: level
          samples:
            - Reporter::INFO
          grok:
            supportRules: ""
            matchRules: reporter_rule Reporter::%{word:severity}
    - type: pipeline
      name: Processing for ntp logs
      enabled: true
      filter:
        query: "@_path:ntp "
      processors:
        - name: Lookup for `mode` to `ntp_mode`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1703677092149
            tags: []
          source: mode
          target: ntp_mode
          lookupTable: |-
            0,reserved
            1,symmetric active
            2,symmetric passive
            3,client
            4,server
            5,broadcast
            6,NTP control message
            7,reserved for private use
          type: lookup-processor
    - type: pipeline
      name: Processing for suricata logs
      enabled: true
      filter:
        query: "@_path:suricata_corelight "
      processors:
        - name: Lookup for `alert.severity` to `alert_severity`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1703677108119
            tags: []
          source: alert.severity
          target: alert_severity
          lookupTable: |-
            1,High
            2,Medium
            3,Low
          type: lookup-processor
    - type: pipeline
      name: Processing for http logs and Standard attribute remapping for HTTP
        requests
      enabled: true
      filter:
        query: "@_path:http "
      processors:
        - type: string-builder-processor
          name: "Create URL based on `host` and `uri` "
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701846816689
            tags: []
          template: http://%{host}%{uri}
          target: http_url
          replaceMissing: false
        - type: attribute-remapper
          name: Map `method` to `http.method`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701846869260
            tags: []
          sources:
            - method
          sourceType: attribute
          target: http.method
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `host` to `http.url_details.host`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701846876997
            tags: []
          sources:
            - host
          sourceType: attribute
          target: http.url_details.host
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `uri` to `http.url_details.path`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701846888311
            tags: []
          sources:
            - uri
          sourceType: attribute
          target: http.url_details.path
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `referrer` to `http.referer`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701846896386
            tags: []
          sources:
            - referrer
          sourceType: attribute
          target: http.referer
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `version` to `http.version`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701846907046
            tags: []
          sources:
            - version
          sourceType: attribute
          target: http.version
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `user_agent` to `http.useragent`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701846918539
            tags: []
          sources:
            - user_agent
          sourceType: attribute
          target: http.useragent
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `status_code` to `http.status_code`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701846925024
            tags: []
          sources:
            - status_code
          sourceType: attribute
          target: http.status_code
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: Standard attribute remapping for Web Access
      enabled: true
      filter:
        query: "@_path:(conn* OR dns OR ftp OR http OR rdp OR smtp OR socks OR ssh OR
          tunnel OR smb_files OR smb_mapping OR smtp_links) "
      processors:
        - type: attribute-remapper
          name: Map `id.orig_h` to `network.client.ip`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847060059
            tags: []
          sources:
            - id.orig_h
          sourceType: attribute
          target: network.client.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `id.orig_p` to `network.client.port`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847067187
            tags: []
          sources:
            - id.orig_p
          sourceType: attribute
          target: network.client.port
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `id.resp_h` to `network.destination.ip`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847074685
            tags: []
          sources:
            - id.resp_h
          sourceType: attribute
          target: network.destination.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `id.resp_p` to `network.destination.port`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847090352
            tags: []
          sources:
            - id.resp_p
          sourceType: attribute
          target: network.destination.port
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `orig_bytes`, `request_body_len` to `network.bytes_read`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1705906756651
            tags: []
          sources:
            - orig_bytes
            - request_body_len
          sourceType: attribute
          target: network.bytes_read
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `resp_bytes`, `response_body_len` to `network.bytes_written`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1705906775463
            tags: []
          sources:
            - resp_bytes
            - response_body_len
          sourceType: attribute
          target: network.bytes_written
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: Processing for dns logs and Standard attribute remapping for DNS
      enabled: true
      filter:
        query: "@_path:(dns OR generic_dns_tunnels) "
      processors:
        - type: geo-ip-parser
          name: Extracting geolocation information from the client IP
          enabled: true
          meta:
            last_update:
              user_id: "5795824"
              timestamp: 1702533948797
            tags: []
          sources:
            - network.client.ip
          target: network.client.geoip
          ip_processing_behavior: do-nothing
        - type: attribute-remapper
          name: Map `trans_id` to `dns.id`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847522944
            tags: []
          sources:
            - trans_id
          sourceType: attribute
          target: dns.id
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `domain`, `query` to `dns.question.name`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1705906916460
            tags: []
          sources:
            - domain
            - query
          sourceType: attribute
          target: dns.question.name
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `qclass_name` to `dns.question.class`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847535752
            tags: []
          sources:
            - qclass_name
          sourceType: attribute
          target: dns.question.class
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `qtype_name` to `dns.question.type`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847542502
            tags: []
          sources:
            - qtype_name
          sourceType: attribute
          target: dns.question.type
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `rcode_name` to `dns.flags.rcode`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847553269
            tags: []
          sources:
            - rcode_name
          sourceType: attribute
          target: dns.flags.rcode
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `answers` to `dns.answer.name`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847559202
            tags: []
          sources:
            - answers
          sourceType: attribute
          target: dns.answer.name
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: Standard attribute remapping for user attributes
      enabled: true
      filter:
        query: "@_path:(ftp OR socks OR http) "
      processors:
        - type: attribute-remapper
          name: Map `user`, `username` to `usr.name`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1705906979360
            tags: []
          sources:
            - user
            - username
          sourceType: attribute
          target: usr.name
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: Standard attribute remapping for Syslog
      enabled: true
      filter:
        query: "@_path:syslog "
      processors:
        - type: attribute-remapper
          name: Map `severity` to `syslog.severity`
          enabled: true
          meta:
            last_update:
              user_id: "5795826"
              timestamp: 1701847507631
            tags: []
          sources:
            - severity
          sourceType: attribute
          target: syslog.severity
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: Remap `id.orig_h`,`id.orig_p`,`id.resp_h` and `id.resp_p` attributes
      enabled: true
      filter:
        query: "@_path:(ntp OR snmp OR ssl OR syslog OR files OR intel OR notice OR dpd
          OR weird OR ldap OR ldap_search) "
      processors:
        - type: attribute-remapper
          name: Map `id.orig_h` to `orig_h`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1705907023566
            tags: []
          sources:
            - id.orig_h
          sourceType: attribute
          target: orig_h
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `id.orig_p` to `orig_p`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1705907046240
            tags: []
          sources:
            - id.orig_p
          sourceType: attribute
          target: orig_p
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `id.resp_h` to `resp_h`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1705907060166
            tags: []
          sources:
            - id.resp_h
          sourceType: attribute
          target: resp_h
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `id.resp_p` to `resp_p`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1705907077240
            tags: []
          sources:
            - id.resp_p
          sourceType: attribute
          target: resp_p
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: pipeline
      name: Remap `duration` to `duration_sec` attribute
      enabled: true
      filter:
        query: "@_path:(conn* OR dhcp OR snmp) "
      processors:
        - type: attribute-remapper
          name: Map `duration` to `duration_sec`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1705907098421
            tags: []
          sources:
            - duration
          sourceType: attribute
          target: duration_sec
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
    - type: status-remapper
      name: Define `severity`, `syslog.severity` as the official status of the log
      enabled: true
      meta:
        last_update:
          timestamp: 1705907127426
          user_name: Mohit Tilala
          user_email: mohit.tilala@crestdatasys.com
        tags: []
      sources:
        - severity
        - syslog.severity
    - type: attribute-remapper
      name: Map `name` to `zeek_name`
      enabled: true
      meta:
        last_update:
          timestamp: 1705913239983
          user_name: Mohit Tilala
          user_email: mohit.tilala@crestdatasys.com
        tags: []
      sources:
        - name
      sourceType: attribute
      target: zeek_name
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `proto` to `zeek_proto`
      enabled: true
      meta:
        last_update:
          timestamp: 1705913267746
          user_name: Mohit Tilala
          user_email: mohit.tilala@crestdatasys.com
        tags: []
      sources:
        - proto
      sourceType: attribute
      target: zeek_proto
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
