{
    "name": "[n8n] Stale Queue Consumer (No Dequeue Activity)",
    "type": "query alert",
    "query": "max(last_15m):derivative(sum:n8n.queue.job.dequeued.count{*} by {host}.as_count()) <= 0",
    "message": "{{#is_alert}}No dequeue activity on {{host.name}}. Stale consumers or stuck worker deployment detected.{{/is_alert}}{{#is_warning}}Dequeue activity on {{host.name}} unusually low.{{/is_warning}}{{#is_recovery}}Dequeue activity resumed on {{host.name}}.{{/is_recovery}}",
    "tags": [
        "integration:n8n",
        "service:n8n",
        "category:queue",
        "category:availability",
        "category:worker-health"
    ],
    "options": {
        "thresholds": {
            "critical": 0
        },
        "notify_audit": false,
        "require_full_window": true,
        "notify_no_data": true,
        "no_data_timeframe": 20,
        "renotify_interval": 15,
        "include_tags": true,
        "evaluation_delay": 120,
        "new_group_delay": 300,
        "escalation_message": "Queue consumers still stale. Workers may need restart.",
        "renotify_statuses": ["alert", "no data"]
    },
    "priority": 1,
    "restricted_roles": null
}
