{
    "name": "[n8n] Combined Queue Health (Backlog OR Wait Time)",
    "type": "query alert",
    "query": "avg(last_5m):( sum:n8n.queue.job.waiting.total{*} by {host} / 100 ) + ( ( sum:n8n.queue.job.waiting.duration.seconds.sum{*} by {host} / sum:n8n.queue.job.waiting.duration.seconds.count{*} by {host} ) / 300 ) > 2",
    "message": "{{#is_alert}}Queue health degraded on {{host.name}}. Health score: {{value}} (threshold: {{threshold}}). Score = (backlog/100) + (avg_wait_seconds/300). A score of 2 means 200 jobs waiting, or 10 min avg wait, or a combination of both.{{/is_alert}}{{#is_warning}}Queue health on {{host.name}} showing early degradation. Score: {{value}}. Score = (backlog/100) + (avg_wait_seconds/300).{{/is_warning}}{{#is_recovery}}Queue health on {{host.name}} returned to normal.{{/is_recovery}}",
    "tags": [
        "integration:n8n",
        "service:n8n",
        "category:queue",
        "category:composite"
    ],
    "options": {
        "thresholds": {
            "critical": 2,
            "warning": 1.5,
            "critical_recovery": 1.5,
            "warning_recovery": 1
        },
        "notify_audit": false,
        "require_full_window": false,
        "notify_no_data": false,
        "no_data_timeframe": null,
        "renotify_interval": 30,
        "include_tags": true,
        "evaluation_delay": 60,
        "new_group_delay": 60
    },
    "priority": 2,
    "restricted_roles": null
}
