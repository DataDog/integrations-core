version: '3.7'

x-common-params: &common-params
  domainname: &domain example.com
  volumes: 
    - /tmp/shared-volume:/tmp/shared-volume/
  networks:
    - kdc-net
  environment: &environment
    KRB5_KEYTAB: ${KRB5_KEYTAB}
    KRB5_CCNAME: ${KRB5_CCNAME}
    KRB5_REALM: ${KRB5_REALM}
    KRB5_SVC: ${KRB5_SVC}
    KRB5_KDC: &kdc kdc
    WEBHOST: &webhost ${WEBHOST}
    DOMAIN: *domain
    # KRB5_USER: datadog/admin
    # KRB5_PASS: 123pass

services:

  kdc:
    <<: *common-params
    build: ./kerberos-kdc
    image: kerberos-kdc
    ports:
      - "88:8888"
      - "749:8749"
      - "464:8464"
    hostname: *kdc
    networks:
      kdc-net:
        aliases:
          - kdc.example.com

  web:
    <<: *common-params
    image: kerberos-nginx
    build: ./kerberos-nginx
    expose:
      - "80"
    ports:
      - "80:80"
    hostname: web
    networks:
      kdc-net:
        aliases:
          - *webhost
    depends_on:
      - "kdc"

networks:
  kdc-net: {}
  