version: '3.7'

x-common-params: &common-params
  domainname: &domain example.com
  volumes: 
    - &sharedvol /tmp/shared-volume:/tmp/shared/
  networks:
    - kdc-net
  environment: &environment
    KRB5_USER: datadog/admin
    KRB5_SVC: HTTP
    KRB5_PASS: 123pass
    KRB5_REALM: EXAMPLE.COM
    KRB5_KDC: &kdc kdc
    KRB5_KEYTAB: /tmp/shared/http.keytab
    KRB5_CCNAME: /tmp/shared/krbc5ccname
    DOMAIN: *domain
    WEBHOST: &webhost web.example.com

services:

  kdc:
    <<: *common-params
    build: ./kerberos-kdc
    image: kerberos-kdc
    ports:
      - "8888:8888"
      - "8749:8749"
      - "8464:8464"
    hostname: *kdc
    networks:
      kdc-net:
        aliases:
          - kdc.example.com

  web:
    <<: *common-params
    image: kerberos-nginx
    build: ./kerberos-nginx
    expose:
      - "80"
    ports:
      - "80:80"
    hostname: web
    networks:
      kdc-net:
        aliases:
          - *webhost
    depends_on:
      - "kdc"

networks:
  kdc-net: {}
  