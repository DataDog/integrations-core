id: barracuda_secure_edge
# See app_id in your integration's manifest.json file to learn more:
# https://docs.datadoghq.com/developers/integrations/check_references/#manifest-file
metric_id: barracuda-secure-edge
# If for some reason id must be different than app_id, add the app_id in this field instead.
# If id and app_id already match, this field can be left blank.
backend_only: false
facets:
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: action
    path: action
    source: log
    type: string
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: dest_ip
    path: dest_ip
    source: log
    type: string
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: event_id
    path: event_id
    source: log
    type: string
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: eventname
    path: eventname
    source: log
    type: string
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: level
    path: level
    source: log
    type: string
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: module
    path: module
    source: log
    type: string
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: productname
    path: productname
    source: log
    type: string
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: protocol
    path: protocol
    source: log
    type: string
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: rule
    path: rule
    source: log
    type: string
  - description: ""
    facetType: list
    groups:
      - Barracuda SecureEdge
    name: src_ip
    path: src_ip
    source: log
    type: string
pipeline:
  type: pipeline
  name: Barracuda_Secure_Edge
  enabled: true
  filter:
    query: source:barracuda_secure_edge
  processors:
    - type: grok-parser
      name: Box Event eventS
      enabled: true
      source: message
      samples:
        - "2025 04 02 09:37:14 +00:00 Info     event: [1071065] Insert Event
          from 127.0.0.1:43134 - (D|2|ccactivate|1|License|4700|Query Activation
          State for  Failed|CloudGen-WAN|1743586634|Querying licensing servers
          for the license activation state failed)"
        - "2025 04 02 06:09:42 +00:00 Info     event: [1071065] Insert Event
          from 127.0.0.1:42081 -
          (D|2|NGAdmin|2|Login|2420|root|CloudGen-WAN|1743574182|Login root from
          10.10.16.1 : Allowed.)"
      grok:
        supportRules: ""
        matchRules: >-
          
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s+%{word:level}\s+event:\s+\[%{number:id}\]\s+%{data:text}%{ip:ip_address}\:%{port:port}\s+\-\s+\(%{data::csv("type,notification_id,module,severity,eventname,event_id,demo,productname,epoch,message","|")}\)
    - type: grok-parser
      name: Box Firewall Activity
      enabled: true
      source: message
      samples:
        - "2025 04 02 12:20:51 +00:00 Security Block:
          FWD|UDP|p1|10.10.17.18|137|00:41:0e:93:aa:91|10.10.17.255|137|netbios\
          -ns||BLOCKALL|4002|||0|1|40|30|20|10||||||"
        - "2025 04 02 12:21:07 +00:00 Info     Allow:
          LOUT|UDP|p2|10.10.16.116|123|00:0c:29:ca:a2:3c|14.139.60.103|123|ntp|\
          |BOX-NTP-OUT|0|10.10.16.116|14.139.60.103|0|1|0|0|0|0||||||"
        - "2025 04 02 12:20:12 +00:00 Security Block:
          <cumulative>|UDP|p2|10.10.17.18|0|00:00:00:00:00:00|10.10.17.255|137|\
          ||BLOCKALL|4002|||0|2|0|0|0|0||||||"
      grok:
        supportRules: ""
        matchRules: >-
          autoFilledRule3 %{date("yyyy MM dd HH:mm:ss
          Z"):timestamp}\s+%{word:level}\s*%{word:action}:\s*\[%{word:event_type}\]\s*%{word:module}:\s*%{data:message}

          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss Z"):timestamp}\s+%{word:level}\s*%{word:action}:%{data::csv("type,protocol,src_if,src_ip,src_port,src_mac,dest_ip,dest_port,dest_service,dest_if,rule,info,src_nat, dst_nat,duration,count,received_bytes,sent_bytes,received_packets,sent_packets, user,prot,application,target,content,uricat","|")}

          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss Z"):timestamp}\s+%{word:level}\s*%{word:action}:%{data:message}
    - type: grok-parser
      name: Box SSH sshd
      enabled: true
      source: message
      samples:
        - "2025 03 31 11:45:34 +00:00 Info     sshd: Server listening on
          169.254.128.2 port 22."
        - "2025 04 01 06:05:31 +00:00 Info     LOGIN ATTEMPT: sshd[26823]: Login
          (password) root from 10.10.16.1 port 55827 Accepted"
        - "2025 04 02 08:19:55 +00:00 Notice   sshd: notice: Shell (/bin/bash)
          opened for user root@10.10.16.1:57129 (uid=0)"
        - "2025 04 02 11:37:23 +00:00 Notice   sshd: notice: Starting session:
          shell on pts/0 for root from 10.10.16.1 port 63675 id 0"
      grok:
        supportRules: ""
        matchRules: >+
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s*%{word:level}\s*%{data:type}:\s*(%{data:module})?(\[%{number:id}\])?:\s*%{data:message}


          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s*%{word:level}\s*%{data:type}:\s*%{data:message}

    - type: grok-parser
      name: Box Auth access
      enabled: true
      source: message
      samples:
        - "2025 04 02 12:20:39 +00:00 Notice       root : TTY=pts/0 ;
          PWD=/etc/yum.repos.d ; USER=root ; COMMAND=/bin/systemctl rsyslog
          status"
        - >
          2025 04 02 12:20:39 +00:00 Info     : pam_unix(sudo:session): session
          opened for user root by root(uid=0)
        - "2025 03 31 11:46:17 +00:00 Info     LOGIN ATTEMPT: control[5405]:
          Login localhost_hapair_daemon from 127.0.0.1 : Allowed."
        - "2025 03 31 12:16:35 +00:00 Info     boxconfig[26379]: Session
          localhost_CloudGen-WAN: Closed"
        - >
          2025 05 27 19:47:27 +00:00 Info     : pam_unix(sudo:session): Login
          root from 10.10.16.1: Denied: Invalid password
      grok:
        supportRules: ""
        matchRules: >-
          autoFilledRule3 %{date("yyyy MM dd HH:mm:ss
          Z"):timestamp}\s*%{word:level}\s*%{word:module}\s*:\s*%{data:meesage}


          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss Z"):timestamp}\s*%{word:level}\s*%{data:action}:\s*%{data}%{ip:src}%{data}%{number:port}%{data}


          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss Z"):timestamp}\s*%{word:level}\s*%{data:action}:\s*%{data:type}\[%{number:type_id}\]:\s*%{data:message}


          autoFilledRule4 %{date("yyyy MM dd HH:mm:ss Z"):timestamp}\s*%{word:level}\s*(:\s+)?%{data:message}
    - type: grok-parser
      name: Box System mgmaccess
      enabled: true
      source: message
      samples:
        - 2025 03 31 11:46:16 +00:00 Notice   Starting Management Access Server
          ...
        - 2025 03 31 11:46:17 +00:00 Info     Opened listen socket on
          169.254.128.2:807
        - "2025 04 01 10:54:57 +00:00 Info     Handler #17 returned with code 2
          (IOStreamSock: Connect(10.10.16.116:814): Connection refused)"
        - "2025 04 01 10:55:14 +00:00 Info     Connected new handler #23 of type
          'Firewall'"
        - 2025 03 31 11:46:16 +00:00 Notice   Running in box group
      grok:
        supportRules: ""
        matchRules: >-
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s*%{word:level}\s*%{data}%{ip:ip}:%{number:port}\):\s+%{data:message}\)


          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s*%{word:level}\s*%{data:message}
    - type: grok-parser
      name: Box Network dhcp
      enabled: true
      source: message
      samples:
        - "2025 03 31 11:45:37 +00:00 Info     openxdhcp[4500]: START, operation
          mode=daemon"
        - "2025 03 31 11:45:37 +00:00 Notice   openxdhcp[4500]: start worker
          xdhcp1 for active link provider"
        - "2025 03 31 11:45:52 +00:00 Info     xdhcp1[4530]: interface dhcp
          addresses are local=10.10.17.114 and gateway=10.10.16.1"
        - "2025 03 31 11:45:52 +00:00 Notice   xdhcp1[4530]: local interface
          dhcp IP changed 0.0.0.0->10.10.17.114"
        - "2025 03 31 13:14:18 +00:00 Info     xdhcp1[5102]: common link
          parameters: link probing mode=, accept DNS assignment=yes accept
          DOMAIN=no "
      grok:
        supportRules: ""
        matchRules: >+
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s*%{word:level}\s*%{word:process}\[%{number:process_id}\]:\s+%{data:message}


          autoFilledRule4 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s*%{word:level}\s*\[%{number:proccess_id}\]\s*%{data}\s*\:\s*%{word:action}\s*%{data:message}


          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s*%{word:level}\s*%{data:module}\s:*%{data}=\s*%{ip:local_ip}\s*%{data}=%{ip:gateway_ip}


          autoFilledRule3 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s*%{word:level}\s*%{data:message}

    - type: grok-parser
      name: VPN vpn
      enabled: true
      source: message
      samples:
        - 2025 03 31 11:46:44 +00:00 Info     -------- VPN Server Startup
          Version = 5.0.0.1 (pid=9451, ppid=1, inst=CSC_VPN) -----------
        - "2025 03 31 11:46:29 +00:00 Info     L2TP server config file changed.
          restart required "
        - "2025 03 31 13:15:41 +00:00 Notice   BIND: Reload service.conf"
        - "2025 03 31 13:15:41 +00:00 Notice   Wait: No valid license found."
        - "2025 05 08 11:46:30 +00:00 Info     PPTP options config file changed.
          restart required "
      grok:
        supportRules: ""
        matchRules: >-
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s*%{word:level}\s*%{word:module}\:%{data:message}

          autoFilledRule3 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s*%{word:level}\s*%{data:message}
    - type: attribute-remapper
      name: " Map timestamp to syslog.timestamp"
      enabled: true
      sources:
        - timestamp
      sourceType: attribute
      target: syslog.timestamp
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: status-remapper
      name: Status Remapper from Level to Status
      enabled: true
      sources:
        - level
    - type: grok-parser
      name: Box Event operative
      enabled: true
      source: message
      samples:
        - "2025 03 31 11:46:20 +00:00 Internal event: [1070045] Startup
          CheckEventState (pid=6397): check every 30 sec"
        - "2025 04 01 11:05:27 +00:00 Error    event: [1070256] (11)
          IOStreamSock: Receive() error:068000DF:asn1 encoding routines::too
          large"
        - "2025 04 01 06:26:09 +00:00 Internal event: [1070310] Confirm (worker:
          2759) from 10.10.16.1,  User [root] -
          (D|2|boxconfig|2|Login|2420|root|CloudGen-WAN)"
        - "2025 04 02 09:24:16 +00:00 Notice   event: [1071200] starting worker
          11022: connected from 10.10.16.116:6752"
      grok:
        supportRules: ""
        matchRules: >-
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s*%{word}:\s+\[%{number:event_id}\]\s+%{word:event_action}\s+\(worker:
          %{number:worker_id}\)\s+from\s+%{ip:source_ip},\s+User\s+\[%{data}\]\s+-\s+\(%{data::csv("type,severity,component,code,action,session_id,username,system_name","|")}\)


          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s+%{word:level}\s*%{word}:\s+\[%{number:event_id}\]\s+%{data:message}
    - type: grok-parser
      name: Box Config admin
      enabled: true
      source: message
      samples:
        - "2025 04 02 01:45:51 +00:00 Notice   127.0.0.1:23697 login succeeded:
          localhost_CloudGen-WAN Valid password and valid challenge"
        - 2025 04 02 02:15:51 +00:00 Info     New Session
          GCSID_localhost_CloudGen-WAN_127.0.0.1_63219_19688
        - "2025 04 01 11:11:24 +00:00 Notice   127.0.0.1:4425 login succeeded:
          root Valid token"
        - 2025 04 01 06:15:51 +00:00 Info     New Session
          GCSID_localhost_CloudGen-WAN_127.0.0.1_22883_31238
        - "2025 03 31 11:46:39 +00:00
          Info     [localhost_wanhub@127.0.0.1_43774]  Commit operation: 0
          Remove(disabled)
          /opt/phion/config/active/servers/CSC/services/DHCPR/service.conf"
      grok:
        supportRules: ""
        matchRules: >-
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s*(%{ip:source_ip}:%{number:source_port})?\s+%{data:message}


          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s+%{word:level}\s+%{data:message}
    - type: grok-parser
      name: Box Config changes
      enabled: true
      source: message
      samples:
        - 2025 05 23 11:46:38 +00:00
          Info     [localhost_wanhub@127.0.0.1_43774]  COMMIT(add)
          servers/CSC/services/DHCPR (Generic Service directory for DHCPR)
        - 2025 03 31 11:46:23 +00:00 Info     [init] COMMIT(add)
          servers/CSC/services/DHCP/dhcpe (DHCP Enterprise Configuration)
        - 2025 04 02 09:24:16 +00:00 Info     [root@10.10.16.1_63632]  Deleting
          session GCSID_root_10.10.16.1_63632_11026
      grok:
        supportRules: ""
        matchRules: >-
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s+\[%{data:initiator}\]\s+%{word}\(%{word:commit_action}\)\s+%{notSpace:path}\s+\(%{data:message}\)


          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s+%{word:level}\s+\[%{data:initiator}\]\s+%{data:message}
    - type: grok-parser
      name: Box Config sync
      enabled: true
      source: message
      samples:
        - 2025 05 12 11:46:36 +00:00 Notice   Starting main loop pid=9123
        - 2025 05 12 13:15:40 +00:00 Notice   Starting main loop pid=7232
      grok:
        supportRules: ""
        matchRules: autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s*%{data:message}\s+pid=%{number:process_id}
    - type: grok-parser
      name: Box Control admin
      enabled: true
      source: message
      samples:
        - 2025 03 31 11:46:14 +00:00 Info     [cmdline] [phionctrl root]  startup
        - "2025 04 01 06:05:09 +00:00 Security control: [root@10.10.16.1]
          NGAdmin login failed Invalid Password"
        - "2025 03 31 13:15:35 +00:00 Info     control:
          [localhost_hapair_daemon@127.0.0.1] logged in"
        - 2025 03 31 11:46:14 +00:00 Info     [phionctrl root] Removed watchdog
          service-state file
      grok:
        supportRules: ""
        matchRules: >
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s+%{word:log_source}:\s+\[%{word:username}@%{ip:source_ip}\]%{data:message}


          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s+%{word:level}\s+(\[%{word:log_source}\]\s+)?\[%{word:controller}\s+%{word:username}\]%{data:event_action}
    - type: grok-parser
      name: Box Control AuthService
      enabled: true
      source: message
      samples:
        - "2025 04 01 06:26:28 +00:00 Internal phibs: SAML: process binary for
          SAML/ADFS authentication."
        - 2025 04 02 11:00:01 +00:00 Info     MSAD-Offline-Groups Setting MSAD
          offline group sync cache to 117.49 MByte (auto-calculated)
        - '2025 03 31 11:46:20 +00:00 Notice   phibs: Configuration: Adding
          scheme certvalidate of type "Certificate-Validator"'
      grok:
        supportRules: ""
        matchRules: >-
          autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s+%{word:auth_component}:\s+%{word:auth_process}:\s+%{data:event}\s+for\s+%{data:auth_type}


          autoFilledRule2 %{date("yyyy MM dd HH:mm:ss ZZ"):timestamp}\s+%{word:level}\s+(%{word:auth_component}:\s+%{word:auth_process}:\s+)?%{data:message}
    - type: grok-parser
      name: Box Firewall
      enabled: true
      source: message
      samples:
        - "2025 03 31 13:15:47 +00:00 Notice   firewall: [Request] Rule:
          /opt/phion/bin/acpffwdrule prefixwrite
          /opt/phion/config/active/servers/CSC/services/NGFW/active.fwrule
          /opt/phion/run/rule.prefix &"
        - "2025 03 31 13:16:17 +00:00 Warning  firewall: [DNS] Operation: DNS
          server with IP 127.0.0.1 now considererd dead after 4 failed health
          checks. Will be re-employed when reachable again."
        - "2025 03 31 13:18:20 +00:00 Info     firewall: [Request]
          Configuration: Maximum forward pending connections per source = 64"
        - "2025 03 31 13:16:17 +00:00 Error    firewall: [DNS] Operation: Every
          single specified DNS server has been unreachable for at least 4
          retries with 3000ms between them. Hostname resolution implicitly
          suspended until a reachable DNS server is configured or an existing
          one becomes reachable again."
      grok:
        supportRules: ""
        matchRules: autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s+%{word:log_source}:\s+\[%{word:service}\]\s+%{word:operation_type}:\s+%{data:message}
    - type: grok-parser
      name: Box Network activation
      enabled: true
      source: message
      samples:
        - "2025 03 31 13:18:30 +00:00 Internal [0140200] 0 0 boxnet(p,ARGS):
          wrote outer line control parametrisation for xDHCP links to
          /var/phion/preserve/boxnet/DHCP/xDHCP.opconf"
        - "2025 03 31 11:45:32 +00:00 Internal [0140000] 0 boxnet(Q,ARGS):
          Logical Check Sequence Begin "
        - "2025 03 31 11:45:31 +00:00 Internal [0140200] make_box(b,ARGS):
          conf-file checksum 12509353523906182422 mismatches last known good
          value 0, fast activation decision deferred "
      grok:
        supportRules: ""
        matchRules: autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s+\[%{number:event_id}\]\s+%{data:function}:\s+%{data:message}
    - type: grok-parser
      name: Box SSH config
      enabled: true
      source: message
      samples:
        - "2025 03 31 11:45:26 +00:00 Internal [0210108] writeSSHdconf():
          starting handling of ssh daemon configuration "
        - "2025 03 31 11:45:27 +00:00 Internal [0210112] writeSSHdconf():
          finished activation of ssh daemon configuration "
        - "2025 03 31 11:45:27 +00:00 Info     [0213014] writeSSHdconf():
          -------------- END ---------------------------- "
      grok:
        supportRules: ""
        matchRules: autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s+\[%{number:event_id}\]\s+%{data:function}:\s+%{data:message}
    - type: grok-parser
      name: VPN sslvpn
      enabled: true
      source: message
      samples:
        - "2025 03 31 11:46:35 +00:00 Info     sslvpn: SSL Cipher Spec
          unspecified - strong ciphers only selected - using:
          'ALL:!ADH:RC4+RSA:+HIGH:+MEDIUM:+LOW:+EXP:-SSLv2'"
        - "2025 03 31 11:46:35 +00:00 Error    sslvpn: ACTIVATE Self-signed
          certificate key is empty"
      grok:
        supportRules: ""
        matchRules: autoFilledRule1 %{date("yyyy MM dd HH:mm:ss
          ZZ"):timestamp}\s+%{word:level}\s+%{word:log_source}:\s+(%{word:event_type})?\s+%{data:message}
    - type: status-remapper
      name: Remapper level to status
      enabled: true
      sources:
        - level
    - type: date-remapper
      name: "Define `timestamp` as the official date of the log "
      enabled: true
      sources:
        - timestamp
