{"title":"Lustre - Overview","description":"# About\nThis dashboard provides comprehensive observability for your Lustre distributed filesystem, monitoring filesystem capacity, network health, I/O performance, and operational metrics across clients, metadata servers (MDS), and object storage servers (OSS).\n","widgets":[{"id":1,"definition":{"title":"About","banner_img":"/static/images/logos/lustre_large.svg","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":2,"definition":{"type":"note","content":"# Lustre Filesystem Monitoring\nThis dashboard provides observability for your Lustre filesystem across all node types:\n\n- **Client nodes**: Monitor I/O performance and filesystem usage\n- **MDS (Metadata Server)**: Track metadata operations and lock management\n- **OSS (Object Storage Server)**: Monitor storage capacity and throughput\n- **Network (LNet)**: Monitor inter-node communication health and performance","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":2,"height":3}},{"id":3,"definition":{"type":"note","content":"# Useful Links\n\n[Lustre Integration](https://docs.datadoghq.com/integrations/lustre)\n\n[Lustre Documentation](https://lustre.org/documentation/)\n\n[Lustre Wiki](https://wiki.lustre.org/)","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":2,"y":0,"width":2,"height":3}}]},"layout":{"x":0,"y":0,"width":4,"height":6}},{"id":4,"definition":{"title":"System Overview","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":5,"definition":{"type":"note","content":"This overview provides a quick look into the general health and status of your Lustre filesystem deployment.","background_color":"blue","font_size":"16","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":8,"height":1}},{"id":2870880334756239,"definition":{"title":"Lustre device health","title_size":"16","title_align":"left","type":"hostmap","requests":{"fill":{"q":"avg:lustre.device.health{$host} by {host}"}},"node_type":"host","no_metric_hosts":false,"no_group_hosts":true,"group":[],"scope":["$host"],"style":{"palette":"green_to_orange","palette_flip":true,"fill_min":"0","fill_max":"1"}},"layout":{"x":0,"y":1,"width":2,"height":2}},{"id":7487343900080374,"definition":{"title":"Lustre network health","title_size":"16","title_align":"left","type":"hostmap","requests":{"fill":{"q":"avg:lustre.net.local.health_stats.health_value{$host} by {host}"}},"node_type":"host","no_metric_hosts":false,"no_group_hosts":true,"group":[],"scope":["$host"],"style":{"palette":"green_to_orange","palette_flip":true,"fill_min":"0","fill_max":"1000"}},"layout":{"x":2,"y":1,"width":2,"height":2}},{"id":8,"definition":{"title":"Monitors","type":"manage_status","display_format":"countsAndList","color_preference":"text","hide_zero_counts":true,"show_status":true,"last_triggered_format":"relative","query":"tag:(integration:lustre)","sort":"status,asc","count":50,"start":0,"summary_type":"monitors","show_priority":false,"show_last_triggered":false},"layout":{"x":4,"y":1,"width":4,"height":4}},{"id":9,"definition":{"title":"Percent of total storage used","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"percent"}},"formula":"(query1 - query2) / query1 * 100"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:lustre.filesystem.kbytestotal{$host}","aggregator":"last"},{"data_source":"metrics","name":"query2","query":"sum:lustre.filesystem.kbytesavail{$host}","aggregator":"last"}],"response_format":"scalar","conditional_formats":[{"comparator":">","value":80,"palette":"white_on_red"},{"comparator":"<=","value":80,"palette":"white_on_green"}]}],"autoscale":true,"precision":2},"layout":{"x":0,"y":3,"width":2,"height":2}},{"id":3725150561965415,"definition":{"title":"Average write throughput","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"throughput(query1)","number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family","per_unit_name":"second"}}}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:lustre.filesystem.write_bytes.sum{$host}","aggregator":"avg"}],"response_format":"scalar"}],"autoscale":true,"precision":2},"layout":{"x":2,"y":3,"width":2,"height":2}}]},"layout":{"x":4,"y":0,"width":8,"height":6}},{"id":24,"definition":{"title":"Job Statistics","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":25,"definition":{"type":"note","content":"Monitor per-job I/O statistics to identify workload patterns and performance characteristics across different jobs and users.\n\nThese metrics are exclusive to OSS and MDS nodes.\n","background_color":"blue","font_size":"16","text_align":"center","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":26,"definition":{"title":"Job write activity","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{},"type":"timeseries","requests":[{"formulas":[{"alias":"Bytes Written","style":{"palette":"blue"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family"}},"formula":"top(query2, 10, 'area', 'desc')"}],"queries":[{"data_source":"metrics","name":"query2","query":"avg:lustre.job_stats.write_bytes.sum{$job_id, $host} by {job_id}"}],"response_format":"timeseries","style":{"line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":1,"width":4,"height":4}},{"id":5560879550495508,"definition":{"title":"Job read activity","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{},"type":"timeseries","requests":[{"formulas":[{"alias":"Bytes Read","style":{"palette":"green"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family"}},"formula":"top(query1, 10, 'mean', 'desc')"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:lustre.job_stats.read_bytes.sum{$job_id, $host} by {job_id}.as_count()"}],"response_format":"timeseries","style":{"line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":4,"y":1,"width":4,"height":4}},{"id":3974364661751452,"definition":{"title":"Top jobs by write count","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:lustre.job_stats.write_bytes.count{$host, $job_id} by {job_id}.as_count()","aggregator":"sum"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"layout":{"x":8,"y":1,"width":4,"height":4}}]},"layout":{"x":0,"y":6,"width":12,"height":6}},{"id":15,"definition":{"title":"I/O Performance","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":16,"definition":{"type":"note","content":"Monitor I/O throughput and latency across the Lustre filesystem. Track read/write operations, data transfer rates, and operation latencies.\n\nThese metrics are exclusive to client nodes.","background_color":"blue","font_size":"16","text_align":"center","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":17,"definition":{"title":"Read/Write Throughput","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Bytes Read/sec","style":{"palette":"green"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family","per_unit_name":"second"}},"formula":"per_second(query1)"},{"alias":"Bytes Written/sec","style":{"palette":"blue"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family","per_unit_name":"second"}},"formula":"per_second(query2)"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:lustre.filesystem.read_bytes.sum{$host, $device_uuid} by {device_uuid}"},{"data_source":"metrics","name":"query2","query":"sum:lustre.filesystem.write_bytes.sum{$host, $device_uuid} by {device_uuid}.as_count()"}],"response_format":"timeseries","style":{"line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":1,"width":6,"height":4}},{"id":18,"definition":{"title":"I/O Operation Latency","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Read Latency","style":{"palette":"green"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"microsecond"}},"formula":"derivative(query1)"},{"alias":"Write Latency","style":{"palette":"blue"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"microsecond"}},"formula":"derivative(query2)"}],"queries":[{"data_source":"metrics","name":"query1","query":"max:lustre.filesystem.read.sum{$device_uuid, $host} by {device_uuid}"},{"data_source":"metrics","name":"query2","query":"max:lustre.filesystem.write.sum{$device_uuid, $host} by {device_uuid}"}],"response_format":"timeseries","style":{"line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":1,"width":6,"height":4}}]},"layout":{"x":0,"y":12,"width":12,"height":6}},{"id":11,"definition":{"title":"Filesystem Capacity","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":12,"definition":{"type":"note","content":"Monitor filesystem capacity across all Lustre filesystems. Track available space and inode usage to prevent capacity issues. \n\nThese metrics are exclusive to client nodes.","background_color":"blue","font_size":"16","text_align":"center","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":13,"definition":{"title":"Disk Space Utilization","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Used Space %","formula":"(query1 - query2) / query1 * 100"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:lustre.filesystem.kbytestotal{$host} by {device_uuid}"},{"data_source":"metrics","name":"query2","query":"avg:lustre.filesystem.kbytesfree{$host} by {device_uuid}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"max":"100"}},"layout":{"x":0,"y":1,"width":4,"height":4}},{"id":14,"definition":{"title":"Inode Usage","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Used Inodes %","formula":"(query1 - query2) / query1 * 100"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:lustre.filesystem.filestotal{*} by {device_uuid}"},{"data_source":"metrics","name":"query2","query":"avg:lustre.filesystem.filesfree{*} by {device_uuid}"}],"response_format":"timeseries","style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"max":"100"}},"layout":{"x":4,"y":1,"width":4,"height":4}},{"id":8887720186498028,"definition":{"title":"Top devices by bytes written","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:lustre.filesystem.write_bytes.sum{*} by {device_uuid}","aggregator":"avg"}],"response_format":"scalar","formulas":[{"formula":"query1","number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_decimal_bytes_family"}}}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"layout":{"x":8,"y":1,"width":4,"height":4}}]},"layout":{"x":0,"y":18,"width":12,"height":6}},{"id":20,"definition":{"title":"Network Health","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":21,"definition":{"type":"note","content":"Monitor Lustre network (LNet) health and performance. Track network errors, timeouts, and connectivity issues across all nodes.","background_color":"blue","font_size":"16","text_align":"center","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":23,"definition":{"title":"Health score by NID","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"avg:lustre.net.local.health_stats.health_value{*} by {local_nid,host}","aggregator":"avg"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":10,"order_by":[{"type":"formula","index":0,"order":"asc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"layout":{"x":0,"y":1,"width":4,"height":4}},{"id":22,"definition":{"title":"Network health score","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Health Score","formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"avg:lustre.net.local.health_stats.health_value{*} by {local_nid,host}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":4,"y":1,"width":4,"height":4}},{"id":4732756525754001,"definition":{"title":"Network error count","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{},"type":"timeseries","requests":[{"formulas":[{"number_format":{"unit":{"type":"canonical_unit","unit_name":"error"}},"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:lustre.net.local.health_stats.error{*} by {local_nid,host}.as_count()"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":8,"y":1,"width":4,"height":4}}]},"layout":{"x":0,"y":24,"width":12,"height":6,"is_column_break":true}},{"id":2133745380016921,"definition":{"title":"Server Performance","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":893590138794159,"definition":{"type":"note","content":"Monitor server-side performance metrics from MDS (Metadata Servers) and OSS (Object Storage Servers). Track request processing, storage utilization, and lock management.","background_color":"blue","font_size":"16","text_align":"center","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":6410782059505070,"definition":{"title":"Number of active requests on servers","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{},"type":"timeseries","requests":[{"formulas":[{"style":{"palette":"orange"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"request"}},"alias":"MDS requests","formula":"query1"},{"style":{"palette":"blue"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"request"}},"alias":"OSS requests","formula":"query2"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:lustre.mds.mdt.req_active.count{$host} by {host}.as_count()"},{"data_source":"metrics","name":"query2","query":"sum:lustre.oss.req_active.count{$host} by {host}.as_count()"}],"response_format":"timeseries","style":{"line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":1,"width":4,"height":4}},{"id":8001234567890123,"definition":{"title":"Request wait time on servers","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{},"type":"timeseries","requests":[{"formulas":[{"alias":"Wait time on MDS","style":{"palette":"orange"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"microsecond"}},"formula":"per_second(query1)"},{"style":{"palette":"blue"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"microsecond"}},"alias":"Wait time on OSS","formula":"per_second(query2)"}],"queries":[{"data_source":"metrics","name":"query1","query":"max:lustre.mds.mdt.req_waittime.sum{$host} by {host}"},{"data_source":"metrics","name":"query2","query":"max:lustre.oss.req_waittime.sum{$host} by {host}"}],"response_format":"timeseries","style":{"line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":4,"y":1,"width":4,"height":4}},{"id":8001234567890124,"definition":{"title":"Object storage throughput","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Read Bytes/sec","style":{"palette":"green"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family","per_unit_name":"second"}},"formula":"per_second(query1)"},{"alias":"Write Bytes/sec","style":{"palette":"blue"},"number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family","per_unit_name":"second"}},"formula":"per_second(query2)"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:lustre.obdfilter.read_bytes.sum{$host} by {device_name}"},{"data_source":"metrics","name":"query2","query":"sum:lustre.obdfilter.write_bytes.sum{$host} by {device_name}"}],"response_format":"timeseries","style":{"line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":8,"y":1,"width":4,"height":4}}]},"layout":{"x":0,"y":30,"width":12,"height":6}},{"id":3049346073011246,"definition":{"title":"Logs","background_color":"vivid_blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":7306774512556778,"definition":{"type":"note","content":"Monitor the logs from the Lustre filesystem.","background_color":"blue","font_size":"16","text_align":"center","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":6840982378119667,"definition":{"title":"Logs count by operation type","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"time":{},"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"logs","search":{"query":"service:lustre OR source:lustre"},"indexes":["*"],"group_by":[{"facet":"@lustre.operation_type","limit":25,"sort":{"aggregation":"count","order":"desc","metric":"count"},"should_exclude_missing":true}],"compute":{"aggregation":"count"},"storage":"hot"}],"response_format":"timeseries","style":{"palette":"dog_classic","order_by":"values","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":1,"width":7,"height":4}},{"id":4073447403738002,"definition":{"title":"Logs","title_size":"16","title_align":"left","requests":[{"response_format":"event_list","query":{"data_source":"logs_stream","query_string":"service:lustre OR source:lustre","indexes":[],"storage":"hot"},"columns":[{"field":"status_line","width":"auto"},{"field":"timestamp","width":"auto"},{"field":"host","width":"auto"},{"field":"service","width":"auto"},{"field":"content","width":"compact"}]}],"type":"list_stream"},"layout":{"x":7,"y":1,"width":5,"height":4}}]},"layout":{"x":0,"y":36,"width":12,"height":6}}],"template_variables":[{"name":"host","prefix":"host","available_values":[],"default":"*"},{"name":"job_id","prefix":"job_id","available_values":[],"default":"*"},{"name":"device_uuid","prefix":"device_uuid","available_values":[],"default":"*"},{"name":"node_type","prefix":"node_type","available_values":[],"default":"*"},{"name":"local_nid","prefix":"local_nid","available_values":[],"default":"*"}],"layout_type":"ordered","notify_list":[],"reflow_type":"fixed"}
