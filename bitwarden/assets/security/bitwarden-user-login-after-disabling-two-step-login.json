{
    "name": "Bitwarden user login after disabling two step login",
    "product": [
        "security_monitoring"
    ],
    "defaultRuleId": "",
    "tags": [
        "mitre_platform:windows",
        "technique:T1556-modify-authentication-process",
        "mitre_platform:saas",
        "mitre_platform:linux",
        "source:bitwarden",
        "tactic:TA0005-defense-evasion",
        "security:attack",
        "mitre_platform:cloud"
    ],
    "isEnabled": true,
    "isBeta": true,
    "isShadowDeployed": true,
    "isMapperMetricsOnly": false,
    "options": {
        "detectionMethod": "threshold",
        "evaluationWindow": 900,
        "keepAlive": 3600,
        "maxSignalDuration": 86400
    },
    "queries": [
        {
            "name": "disable_2fa",
            "query": "source:bitwarden service:event-logs @event.type:1003",
            "groupByFields": [
                "@usr.name"
            ],
            "distinctFields": [],
            "aggregation": "count"
        },
        {
            "name": "successful_login_attempt",
            "query": "source:bitwarden service:event-logs @event.type:1000",
            "groupByFields": [
                "@usr.name"
            ],
            "distinctFields": [],
            "aggregation": "count"
        }
    ],
    "cases": [
        {
            "condition": "disable_2fa > 0 THEN successful_login_attempt > 0",
            "name": "User login after disabling two step login",
            "status": "Medium",
            "notifications": []
        }
    ]
}