id: crowdstrike-fdr
metric_id: crowdstrike-fdr
backend_only: false
facets:
  - groups:
      - DNS
    name: Question Name
    path: dns.question.name
    source: log
  - groups:
      - DNS
    name: Question Type
    path: dns.question.type
    source: log
  - groups:
      - Event
    name: Event Name
    path: evt.name
    source: log
  - groups:
      - Web Access
    name: URL Path
    path: http.url
    source: log
  - groups:
      - Geoip
    name: City Name
    path: network.client.geoip.city.name
    source: log
  - groups:
      - Geoip
    name: Continent Code
    path: network.client.geoip.continent.code
    source: log
  - groups:
      - Geoip
    name: Continent Name
    path: network.client.geoip.continent.name
    source: log
  - groups:
      - Geoip
    name: Country ISO Code
    path: network.client.geoip.country.iso_code
    source: log
  - groups:
      - Geoip
    name: Country Name
    path: network.client.geoip.country.name
    source: log
  - groups:
      - Geoip
    name: Subdivision ISO Code
    path: network.client.geoip.subdivision.iso_code
    source: log
  - groups:
      - Geoip
    name: Subdivision Name
    path: network.client.geoip.subdivision.name
    source: log
  - groups:
      - Web Access
    name: Client IP
    path: network.client.ip
    source: log
  - groups:
      - Web Access
    name: Client Port
    path: network.client.port
    source: log
  - groups:
      - Geoip
    name: Destination City Name
    path: network.destination.geoip.city.name
    source: log
  - groups:
      - Geoip
    name: Destination Continent Code
    path: network.destination.geoip.continent.code
    source: log
  - groups:
      - Geoip
    name: Destination Continent Name
    path: network.destination.geoip.continent.name
    source: log
  - groups:
      - Geoip
    name: Destination Country ISO Code
    path: network.destination.geoip.country.iso_code
    source: log
  - groups:
      - Geoip
    name: Destination Country Name
    path: network.destination.geoip.country.name
    source: log
  - groups:
      - Geoip
    name: Destination Subdivision ISO Code
    path: network.destination.geoip.subdivision.iso_code
    source: log
  - groups:
      - Geoip
    name: Destination Subdivision Name
    path: network.destination.geoip.subdivision.name
    source: log
  - groups:
      - Web Access
    name: Destination IP
    path: network.destination.ip
    source: log
  - groups:
      - Web Access
    name: Destination Port
    path: network.destination.port
    source: log
  - groups:
      - User
    name: User ID
    path: usr.id
    source: log
  - groups:
      - User
    name: User Name
    path: usr.name
    source: log
pipeline:
  type: pipeline
  name: CrowdStrike FDR
  enabled: true
  filter:
    query: source:crowdstrike-fdr
  processors:
    - type: arithmetic-processor
      name: Convert `ContextTimeStamp` epoch to milliseconds epoch
      enabled: true
      expression: ContextTimeStamp * 1000
      target: ContextTimeStamp
      replaceMissing: false
    - type: date-remapper
      name: Define `ContextTimeStamp` as the official date of the log
      enabled: true
      sources:
        - ContextTimeStamp
    - type: attribute-remapper
      name: Map `event_simpleName` to `evt.name`
      enabled: true
      sources:
        - event_simpleName
      sourceType: attribute
      target: evt.name
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `UID`, `UserSid`, `OriginalUserSid`, `UserRid` to `usr.id`
      enabled: true
      sources:
        - UID
        - UserSid
        - OriginalUserSid
        - UserRid
      sourceType: attribute
      target: usr.id
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `UserRealName`, `OriginalUserName`, `SourceAccountUserName`,
        `UserName`, `sAMAccountName` to `usr.name`
      enabled: true
      sources:
        - UserRealName
        - OriginalUserName
        - SourceAccountUserName
        - UserName
        - sAMAccountName
      sourceType: attribute
      target: usr.name
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `LocalAddressIP4`, `LocalAddressIP6`, `SourceEndpointAddressIP4`,
        `SourceEndpointAddressIP6` to `network.client.ip`
      enabled: true
      sources:
        - LocalAddressIP4
        - LocalAddressIP6
        - SourceEndpointAddressIP4
        - SourceEndpointAddressIP6
      sourceType: attribute
      target: network.client.ip
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `RemoteAddressIP4`, `RemoteAddressIP6`, `TargetServerAddressIP4`,
        `TargetServerAddressIP6` to `network.destination.ip`
      enabled: true
      sources:
        - RemoteAddressIP4
        - RemoteAddressIP6
        - TargetServerAddressIP4
        - TargetServerAddressIP6
      sourceType: attribute
      target: network.destination.ip
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `LocalPort` to `network.client.port`
      enabled: true
      sources:
        - LocalPort
      sourceType: attribute
      target: network.client.port
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `RemotePort` to `network.destination.port`
      enabled: true
      sources:
        - RemotePort
      sourceType: attribute
      target: network.destination.port
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `HttpUrl` to `http.url`
      enabled: true
      sources:
        - HttpUrl
      sourceType: attribute
      target: http.url
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - name: Lookup on `RequestType` Field
      enabled: true
      source: RequestType
      target: RequestTypeValue
      lookupTable: |-
        0,UNKNOWN
        1,A
        2,NS
        5,CNAME
        12,PTR
        15,MX
        16,TXT
        28,AAAA
        255,ANY
      type: lookup-processor
    - type: attribute-remapper
      name: Map `RequestTypeValue` to `dns.question.type`
      enabled: true
      sources:
        - RequestTypeValue
      sourceType: attribute
      target: dns.question.type
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `DomainName` to `dns.question.name`
      enabled: true
      sources:
        - DomainName
      sourceType: attribute
      target: dns.question.name
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: geo-ip-parser
      name: Extract geolocation information form client ip
      enabled: true
      sources:
        - network.client.ip
      target: network.client.geoip
      ip_processing_behavior: do-nothing
    - name: Lookup on `ConnectionDirection` Field
      enabled: true
      source: ConnectionDirection
      target: ConnectionDirectionValue
      lookupTable: |-
        0,DIRECTION_OUTBOUND
        1,DIRECTION_INBOUND
        2,DIRECTION_NEITHER
        3,DIRECTION_BOTH
        4,DIRECTION_UNKNOWN
      type: lookup-processor
    - name: Lookup on `ConnectionFlags` Field
      enabled: true
      source: ConnectionFlags
      target: ConnectionFlagsValue
      lookupTable: |-
        1,RAW_SOCKET
        2,PROMISCUOUS_MODE_SIO_RCVALL
        4,PROMISCUOUS_MODE_SIO_RCVALL_IGMPMCAST
        8,PROMISCUOUS_MODE_SIO_RCVALL_MCAST
        16,IS_LOOPBACK
      type: lookup-processor
    - name: Lookup on `event_platform` Field
      enabled: true
      source: event_platform
      target: event_platform_value
      lookupTable: |-
        Win,Windows
        Lin,Linux
        Mac,Mac
        Android,Android
      type: lookup-processor
    - name: Lookup on `FileCategory` Field
      enabled: true
      source: FileCategory
      target: FileCategoryValue
      lookupTable: |-
        0,OTHER
        1,ARCHIVES
        2,OFFICE_DOCUMENTS
        3,MULTIMEDIA_FILES
        4,DESIGN_FILES
        5,SOURCE_CODE
        6,EXECUTABLE_FILES
        7,VIRTUAL_MACHINE_FILES
        8,EMAIL_FILES
        9,DATA_AND_LOGS
        10,ENCRYPTED
      type: lookup-processor
    - name: Lookup on `HttpInternalSource` Field
      enabled: true
      source: HttpInternalSource
      target: HttpInternalSourceValue
      lookupTable: |-
        0,HTTP_INVALID_SOURCE
        1,HTTP_WFP_NETWORK_EVENT_SOURCE
        2,HTTP_ETW_WININET_SOURCE
        3,HTTP_ETW_WININET_CAPTURE_SOURCE
      type: lookup-processor
    - name: Lookup on `HttpMethod` Field
      enabled: true
      source: HttpMethod
      target: HttpMethodValue
      lookupTable: |-
        0,HTTP_METHOD_UNKNOWN
        1,HTTP_METHOD_GET
        2,HTTP_METHOD_HEAD
        3,HTTP_METHOD_POST
        4,HTTP_METHOD_PUT
        5,HTTP_METHOD_DELETE
        6,HTTP_METHOD_OPTIONS
        7,HTTP_METHOD_CONNECT
        8,HTTP_METHOD_TRACE
        9,HTTP_METHOD_PATCH
        10,HTTP_METHOD_WILDCARD
        11,HTTP_METHOD_ACL
        12,HTTP_METHOD_BASELINECONTROL
        13,HTTP_METHOD_BIND
        14,HTTP_METHOD_CHECKIN
        15,HTTP_METHOD_CHECKOUT
        16,HTTP_METHOD_COPY
        17,HTTP_METHOD_LABEL
        18,HTTP_METHOD_LINK
        19,HTTP_METHOD_LOCK
        20,HTTP_METHOD_MERGE
        21,HTTP_METHOD_MKACTIVITY
        22,HTTP_METHOD_MKCALENDAR
        23,HTTP_METHOD_MKCOL
        24,HTTP_METHOD_MKREDIRECTREF
        25,HTTP_METHOD_MKWORKSPACE
        26,HTTP_METHOD_MOVE
        27,HTTP_METHOD_ORDERPATCH
        28,HTTP_METHOD_PRI
        29,HTTP_METHOD_PROPFIND
        30,HTTP_METHOD_PROPPATCH
        31,HTTP_METHOD_REBIND
        32,HTTP_METHOD_REPORT
        33,HTTP_METHOD_SEARCH
        34,HTTP_METHOD_UNBIND
        35,HTTP_METHOD_UNCHECKOUT
        36,HTTP_METHOD_UNLINK
        37,HTTP_METHOD_UNLOCK
        38,HTTP_METHOD_UPDATE
        39,HTTP_METHOD_UPDATEREDIRECTREF
        40,HTTP_METHOD_VERSIONCONTROL
      type: lookup-processor
    - name: Lookup on `InjectedThreadFlag` Field
      enabled: true
      source: InjectedThreadFlag
      target: InjectedThreadFlagValue
      lookupTable: |-
        0,NONE
        1,PREV_MODE_KERNEL
        2,START_ADDRESS_IN_NAMED_PE
        4,START_ADDRESS_IN_SYS_RANGE
        8,SYSTEM_THREAD
        16,SOURCE_PROCESS_IS_SYSTEM
        32,TARGET_ANALYSIS_FAILED
        64,CONTEXT_ANALYSIS_FAILED
        128,START_ADDRESS_IN_NTDLL
        256,START_ADDRESS_IN_WIN_DLL
        512,START_ADDRESS_PRIVATE_MEM
      type: lookup-processor
    - name: Lookup on `IntegrityLevel` Field
      enabled: true
      source: IntegrityLevel
      target: IntegrityLevelValue
      lookupTable: |-
        0,UNTRUSTED
        4096,LOW
        8192,MEDIUM
        8448,MEDIUM_PLUS
        12288,HIGH
        16384,SYSTEM
        20480,PROTECTED
      type: lookup-processor
    - name: Lookup on `LogonType` Field
      enabled: true
      source: LogonType
      target: LogonTypeValue
      lookupTable: |-
        2,INTERACTIVE 
        3,NETWORK 
        4,BATCH 
        5,SERVICE
        6,PROXY
        7,UNLOCK 
        8,NETWORK_CLEARTEXT
        9,NEW_CREDENTIALS
        10,REMOTE_INTERACTIVE
        11,CACHED_INTERACTIVE 
        12,CACHED_REMOTE_INTERACTIVE
        13,CACHED_UNLOCK
      type: lookup-processor
    - name: Lookup on `MachOSubType` Field
      enabled: true
      source: MachOSubType
      target: MachOSubTypeValue
      lookupTable: |-
        0,UNKNOWN
        1,EXECUTABLE64
        2,DYLIB64
        3,BUNDLE64
        4,KEXT64
        5,EXECUTABLE32
        6,DYLIB32
        7,BUNDLE32
      type: lookup-processor
    - name: Lookup on `PayloadClassification` Field
      enabled: true
      source: PayloadClassification
      target: PayloadClassificationValue
      lookupTable: |-
        0,UNKNOWN
        1,ANTIVIRUS
        2,GENERIC_MALWARE
        3,RAT
      type: lookup-processor
    - name: Lookup on `PayloadClassificationFlags` Field
      enabled: true
      source: PayloadClassificationFlags
      target: PayloadClassificationFlagsValue
      lookupTable: |-
        0,NONE
        1,KNOWN_BENIGN
        2,SUSPICIOUS
        4,KNOWN_MALICIOUS
        8,ENABLE_VISIBILITY
        16,LARGE_VISIBILITY
        32,EXPERIMENTAL
      type: lookup-processor
    - name: Lookup on `Protocol` Field
      enabled: true
      source: Protocol
      target: ProtocolValue
      lookupTable: |-
        0,IP
        1,ICMP
        2,IGMP
        6,TCP
        17,UDP
        41,IPV6
        47,GRE
        58,ICMPV6
        255,UNKNOWN
      type: lookup-processor
    - name: Lookup on `Status` Field
      enabled: true
      source: Status
      target: StatusValue
      lookupTable: |-
        0,STATUS_SUCCESS
        259,STATUS_PENDING
        3221225506,STATUS_ACCESS_DENIED
        1611792386,STATUS_NO_EXISTING_CREDENTIALS
        1611726866,STATUS_DEP_DISABLED_APPCOMPAT
        3221225533,STATUS_DATA_LATE_ERROR
        3759013928,STATUS_PROCESS_CRITICAL
        3759013929,STATUS_PROCESS_WHITELISTED
        3759013930,STATUS_PROCESS_MICROSOFT_SIGNED
        3759013931,STATUS_PROCESS_APPLE_SIGNED
        538181633,STATUS_COMPONENT_ENABLED
        3759407166,STATUS_COMPONENT_DISABLED
        1611923478,STATUS_COMPONENT_STOPPED
        1612251168,STATUS_HTTP_VISIBILITY_ENABLED
        1612251176,STATUS_SMTP_VISIBILITY_ENABLED
        1612447779,STATUS_PREVENTION_NOT_NEEDED
        1611530273,STATUS_MASK_ADJUSTED
        1612578852,STATUS_ALREADY_BLOCKED
        3221226347,STATUS_DRIVER_BLOCKED_CRITICAL
        3221225541,STATUS_INVALID_PAGE_PROTECTION
        258,STATUS_TIMEOUT
        3221225473,STATUS_UNSUCCESSFUL
        3221225609,STATUS_RESOURCE_DATA_NOT_FOUND
        3221225611,STATUS_RESOURCE_NAME_NOT_FOUND
        3221225524,STATUS_OBJECT_NAME_NOT_FOUND
        3221225760,STATUS_CANCELLED
        3221225492,STATUS_UNRECOGNIZED_MEDIA
        3760521403,STATUS_NO_ACTIVE_RPC_THREAD
        3221225738,STATUS_PROCESS_IS_TERMINATING
        290,STATUS_NOTHING_TO_TERMINATE
        3221226138,STATUS_POLICY_OBJECT_NOT_FOUND
        3758096423,STATUS_PROCESS_KILLED
        3221227780,STATUS_FILE_TOO_LARGE
        3221225485,STATUS_INVALID_PARAMETER
        3221225659,STATUS_NOT_SUPPORTED
        3221225653,STATUS_IO_TIMEOUT
        3221226029,STATUS_RETRY
        3758358545,STATUS_FEATURE_DISABLED
        3760849112,STATUS_NON_CROWDSTRIKE
        3760914656,STATUS_LFO_UPLOAD_FAILURE
        3760914657,STATUS_LFO_UPLOAD_CLOUD_FAILURE
        3760914660,STATUS_PROCESS_LSASS
        3760914661,STATUS_PROCESS_CROWDSTRIKE
      type: lookup-processor
    - name: Lookup on `SuspiciousHandleOpenReason` Field
      enabled: true
      source: SuspiciousHandleOpenReason
      target: SuspiciousHandleOpenReasonValue
      lookupTable: |-
        1,HIGHER_IL
        2,NETWORK_SERVICE_ISOLATION
      type: lookup-processor
    - name: Lookup on `ThreadExecutionControlType` Field
      enabled: true
      source: ThreadExecutionControlType
      target: ThreadExecutionControlTypeValue
      lookupTable: |-
        0,THREAD_INJECT
        1,THREAD_INJECT_MASQUERADE
        2,THREAD_HIJACK
        3,PROCESS_HOLLOWING
        4,WINDOWS_HOOK
        5,PROCESS_OVERWRITE_HOLLOWING
        6,REMOTE_APC
        7,REMOTE_ATOM_BOMB
        8,PROCESS_HOLLOWING_APC
        9,SET_WINDOW_LONG
        10,SET_PROP
        11,LOCAL_CLASSIFIED_MEMORY_OPERATION
        12,REMOTE_CLASSIFIED_MEMORY_OPERATION
      type: lookup-processor
    - name: Lookup on `TokenObjectCheckType` Field
      enabled: true
      source: TokenObjectCheckType
      target: TokenObjectCheckTypeValue
      lookupTable: |-
        0,CAPTURETOKEN
        1,CREATEPROCESS
        2,CREATETHREAD
        4,USERLOADIMAGE
        8,PEFILEWRITE
        16,ASEPUPDATE
        32,NETWORKIOCTL
        64,OPENPROCESS
        2147483648,DELETE
      type: lookup-processor
    - name: Lookup on `UserIsAdmin` Field
      enabled: true
      source: UserIsAdmin
      target: UserIsAdminValue
      lookupTable: |-
        0,False
        1,True
      type: lookup-processor
    - name: Lookup on `UserLogonFlags` Field
      enabled: true
      source: UserLogonFlags
      target: UserLogonFlagsValue
      lookupTable: |-
        0,NONE
        1,LOGON_IS_SYNTHETIC 
        2,USER_IS_ADMIN 
        4,USER_IS_LOCAL 
        8,USER_IS_BUILT_IN
        16,USER_IDENTITY_MISSING
      type: lookup-processor
    - name: Lookup on `VnodeModificationType` Field
      enabled: true
      source: VnodeModificationType
      target: VnodeModificationTypeValue
      lookupTable: |-
        0,CREATE
        1,LINK
        2,OPEN
        3,RENAME_FROM
        4,RENAME_TO
        5,TRUNCATE
        6,UNLINK
        7,WRITE
        8,SET_FLAGS
        9,SET_MODE
        10,CLOSE
        11,EXECUTE
        12,DUP
        13,FCNTL
        14,MMAP
        15,DELETE_EXT_ATTR
        16,SET_EXT_ATTR
        17,CLONE
        18,SET_ACL
        19,UTIMES
        20,EXCHANGE_DATA
        21,COPYFILE
        22,SET_ATTR_LIST
        23,SET_OWNER
        24,GET_ATTR_LIST
        25,FS_GET_PATH
      type: lookup-processor
    - type: geo-ip-parser
      name: GeoIP Parser for `network.client.ip`
      enabled: true
      sources:
        - network.client.ip
      target: network.client.geoip
      ip_processing_behavior: do-nothing
    - type: geo-ip-parser
      name: GeoIP Parser for `network.destination.ip`
      enabled: true
      sources:
        - network.destination.ip
      target: network.destination.geoip
      ip_processing_behavior: do-nothing
