{"title":"FoundationDB Transactions and Queues","description":"## FoundationDB Transactions and Queues\n\nProvides an overview of the rate of transactions being processed, along with further information on the nature of the workloads (reads and writes) and the state of the various queues.","widgets":[{"id":6823871069913358,"definition":{"title":"Overview","type":"group","banner_img":"/static/images/integration_dashboard/foundationdb_hero_1.png","show_title":false,"layout_type":"ordered","widgets":[{"id":7263335183093038,"definition":{"type":"note","content":"This dashboard gives you a birds-eye view of your FoundationDB cluster health by tracking transaction volume and storage lag time. You can find more information about this dashboard on our blog [here](http://datadoghq.com/blog/monitor-foundationdb-with-datadog).","background_color":"transparent","font_size":"16","text_align":"left","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":false},"layout":{"x":0,"y":0,"width":12,"height":2}}]},"layout":{"x":0,"y":0,"width":12,"height":5}},{"id":7531557369718772,"definition":{"title":"Transactions","type":"group","show_title":true,"layout_type":"ordered","widgets":[{"id":2210132241876772,"definition":{"title":"Transactions Started","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Batch Transactions / Second","formula":"query1"},{"alias":"Default Transactions / Second","formula":"query2"},{"alias":"Immediate Transactions / Second","formula":"query3"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"avg:foundationdb.workload.transactions.started_batch_priority.hz{$service}","data_source":"metrics","name":"query1"},{"query":"avg:foundationdb.workload.transactions.started_default_priority.hz{$service}","data_source":"metrics","name":"query2"},{"query":"avg:foundationdb.workload.transactions.started_immediate_priority.hz{$service}","data_source":"metrics","name":"query3"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":6953092315462984,"definition":{"title":"Transactions Committed","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Commits / Second","formula":"query1"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"avg:foundationdb.workload.transactions.committed.hz{$service}","data_source":"metrics","name":"query1"}],"style":{"palette":"purple","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":4772159496539460,"definition":{"type":"note","content":"The number of [transactions](https://apple.github.io/foundationdb/developer-guide.html#transaction-basics) started and committed give an overall idea of the throughput of the database cluster. Started transactions are broken down by type.\n\nA high number of conflicts could indicate a database design issue or inefficient application access patterns. If there are many conflicts, it is good to investigate and [minimize](https://apple.github.io/foundationdb/developer-guide.html#minimizing-conflicts) them.\n\nFoundationDB puts an upper 5 second limit on transactions. A high number of transactions rejected for being too old may mean that the cluster is unable to cope with the workload, or that the application has [long-running transactions](https://apple.github.io/foundationdb/known-limitations.html#long-transactions).","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":8,"y":0,"width":4,"height":4}},{"id":1421721531136720,"definition":{"title":"Transactions Conflicted","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Conflicts / Second","formula":"query1"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"avg:foundationdb.workload.transactions.conflicted.hz{$service}","data_source":"metrics","name":"query1"}],"style":{"palette":"orange","line_type":"solid","line_width":"normal"},"display_type":"area"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":2,"width":4,"height":2}},{"id":7399291455390138,"definition":{"title":"Transactions Rejected (Queued Too Long)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Rejections / second","formula":"query1"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.workload.transactions.rejected_for_queued_too_long.hz{$service}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":4,"y":2,"width":4,"height":2}}]},"layout":{"x":0,"y":5,"width":12,"height":5}},{"id":7990340662848492,"definition":{"title":"Storage Queues","type":"group","show_title":true,"layout_type":"ordered","widgets":[{"id":2099069311788678,"definition":{"title":"Maximum Data Lag","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"conditional_formats":[{"comparator":">=","palette":"white_on_red","value":1},{"comparator":">=","palette":"white_on_yellow","value":0.5},{"comparator":"<","palette":"white_on_green","value":0.5}],"response_format":"scalar","queries":[{"query":"avg:foundationdb.process.role.data_lag.seconds{$service}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":true,"precision":2},"layout":{"x":0,"y":0,"width":2,"height":3}},{"id":2911166993206736,"definition":{"title":"Data Lag History","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Average (seconds)","formula":"query1"},{"alias":"Maximum (seconds)","formula":"query2"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.process.role.data_lag.seconds{$service}","data_source":"metrics","name":"query1"},{"query":"max:foundationdb.process.role.data_lag.seconds{$service}","data_source":"metrics","name":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":2,"y":0,"width":4,"height":3}},{"id":1331251205163924,"definition":{"type":"note","content":"Data lag represents how far the storage server is behind the current version. A storage server with high data lag will not be able to answer read queries for recent versions. This may result in transactions failing with \"Request for future version\".\n\nSuch a problem may indicate that the storage server cannot hold the write throughput. If it afflicts only a particular storage server, perhaps the writes are heavily focused on a certain key.","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":6,"y":0,"width":6,"height":3}},{"id":7081514958050386,"definition":{"title":"Maximum Durability Lag","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"conditional_formats":[{"comparator":">","palette":"white_on_red","value":60},{"comparator":">=","palette":"white_on_yellow","value":10},{"comparator":"<","palette":"white_on_green","value":10}],"response_format":"scalar","queries":[{"query":"avg:foundationdb.process.role.durability_lag.seconds{$service}","data_source":"metrics","name":"query1","aggregator":"max"}]}],"autoscale":true,"precision":2},"layout":{"x":0,"y":3,"width":2,"height":3}},{"id":5667309530144832,"definition":{"title":"Durability Lag History","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Average (seconds)","formula":"query1"},{"alias":"Maximum (seconds)","formula":"query2"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.process.role.durability_lag.seconds{$service}","data_source":"metrics","name":"query1"},{"query":"max:foundationdb.process.role.durability_lag.seconds{$service}","data_source":"metrics","name":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":2,"y":3,"width":4,"height":3}},{"id":4886114659873416,"definition":{"type":"note","content":"Durability lag is the time taken between a value arriving at the storage server and being committed to the storage engine.\n\nTypically, values are held in memory for 5 seconds to be available for transactions to read, and then committed. A little higher than this is normal, but much higher may indicate the storage server cannot handle the write throughput.","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":6,"y":3,"width":6,"height":3}},{"id":1282728129597308,"definition":{"type":"note","content":"For more about queues, [see this FoundationDB forum post](https://forums.foundationdb.org/t/what-do-you-monitor/184/21?page=2).","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":6,"width":12,"height":1}}]},"layout":{"x":0,"y":10,"width":12,"height":8,"is_column_break":true}},{"id":3024716489099632,"definition":{"title":"Log Queues","type":"group","show_title":true,"layout_type":"ordered","widgets":[{"id":764597356849914,"definition":{"title":"Queue Length","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1 / 1000000"}],"conditional_formats":[{"comparator":">","palette":"white_on_red","value":1600},{"comparator":">=","palette":"white_on_yellow","value":1000},{"comparator":"<","palette":"white_on_green","value":1000}],"response_format":"scalar","queries":[{"query":"avg:foundationdb.process.role.queue_length{fdb_role:log}","data_source":"metrics","name":"query1","aggregator":"avg"}]}],"autoscale":false,"custom_unit":"MB","precision":2},"layout":{"x":0,"y":0,"width":2,"height":3}},{"id":6564861785294792,"definition":{"title":"Queue Length History","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Queue Length (bytes)","formula":"query1"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.process.role.queue_length{fdb_role:log}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":2,"y":0,"width":4,"height":3}},{"id":49742894713894,"definition":{"type":"note","content":"Transaction logs hold transactions that have been committed, but that have not yet been written by a storage server. The queue is held in memory and written durably to disk.\n\nWhen the log exceeds 1.5GB, log spilling takes place. This may be a sign that the database can't keep up with the workload, although may also happen when a storage server fails.\n\nInput bytes is new data coming into the logs, while durable bytes is data removed from the logs by the storage servers after writing it.","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":6,"y":0,"width":6,"height":3}},{"id":8604271526023666,"definition":{"title":"Log Length Change","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Change (bytes)","formula":"query1 - query2"}],"response_format":"timeseries","on_right_yaxis":false,"queries":[{"query":"sum:foundationdb.process.role.input_bytes.counter{fdb_role:log} by {fdb_process}.as_count()","data_source":"metrics","name":"query1"},{"query":"sum:foundationdb.process.role.durable_bytes.counter{fdb_role:log} by {fdb_process}.as_count()","data_source":"metrics","name":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":3,"width":4,"height":3}},{"id":3546161831681930,"definition":{"title":"Input Bytes","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Average (bytes / second)","formula":"query1"},{"alias":"Maximum (bytes / second)","formula":"query2"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.process.role.input_bytes.hz{fdb_role:log}","data_source":"metrics","name":"query1"},{"query":"max:foundationdb.process.role.input_bytes.hz{fdb_role:log}","data_source":"metrics","name":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":4,"y":3,"width":4,"height":3}},{"id":7658552990350276,"definition":{"title":"Durable (Output) Bytes","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Average (bytes / second)","formula":"query1"},{"alias":"Maximum (bytes / second)","formula":"query2"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.process.role.durable_bytes.hz{fdb_role:log}","data_source":"metrics","name":"query1"},{"query":"max:foundationdb.process.role.durable_bytes.hz{fdb_role:log}","data_source":"metrics","name":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"label":"","scale":"linear","min":"auto","max":"auto"},"markers":[]},"layout":{"x":8,"y":3,"width":4,"height":3}}]},"layout":{"x":0,"y":18,"width":12,"height":7}},{"id":8583239874245352,"definition":{"title":"Operations","type":"group","show_title":true,"layout_type":"ordered","widgets":[{"id":617247425025980,"definition":{"title":"Read Requests","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Requests / second","formula":"query1"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.workload.operations.read_requests.hz{$service}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":0,"width":4,"height":2}},{"id":8259862090996736,"definition":{"title":"Low Priority Read Requests","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Requests / second","formula":"query1"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.workload.operations.low_priority_reads.hz{$service}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":4,"y":0,"width":4,"height":2}},{"id":6259859862527082,"definition":{"title":"Completed Read operations","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Reads / second","formula":"query1"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.workload.operations.reads.hz{$service}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":8,"y":0,"width":4,"height":2}},{"id":3689974919495706,"definition":{"title":"Write Operations Completed","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Writes / second","formula":"query1"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.workload.operations.writes.hz{$service}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":0,"y":2,"width":4,"height":2}},{"id":1246848430284440,"definition":{"title":"Proxy memory limit errors","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Errors / second","formula":"query1"}],"response_format":"timeseries","queries":[{"query":"avg:foundationdb.workload.operations.memory_errors.hz{$service}","data_source":"metrics","name":"query1"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear","label":"","min":"auto","max":"auto"},"markers":[]},"layout":{"x":4,"y":2,"width":4,"height":2}},{"id":8304484655265424,"definition":{"type":"note","content":"Memory errors are requests rejected by proxies because they are reached their memory limit, which indicates they already have too many requests.","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":8,"y":2,"width":4,"height":2}}]},"layout":{"x":0,"y":25,"width":12,"height":5}}],"template_variables":[{"name":"service","default":"*","prefix":"service","available_values":[]}],"layout_type":"ordered","is_read_only":false,"notify_list":[],"reflow_type":"fixed","id":"6vn-5wq-k3i"}