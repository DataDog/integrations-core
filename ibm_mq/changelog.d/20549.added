Make queue discovery logic more resilient and add new metric to track broken queues
