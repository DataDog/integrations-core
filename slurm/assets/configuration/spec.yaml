name: Slurm
files:
- name: slurm.yaml
  options:
  - template: init_config
    options:
      - name: slurm_binaries_dir
        description: |
          The directory at which all the Slurm binaries are located. These are mainly:
          sinfo, sacct, sdiag, sshare and sdiag.
        value:
          type: string
          example: /usr/bin/
      - template: init_config/default
  - template: instances
    options:
    - name: collect_sinfo_stats
      description: Whether or not to collect statistics from the sinfo command.
      value:
        type: string
        example: 'true'
    - name: collect_sdiag_stats
      description: Whether or not to collect statistics from the sdiag command.
      value:
        type: string
        example: 'true'
    - name: collect_squeue_stats
      description: Whether or not to collect statistics from the squeue command.
      value:
        type: string
        example: 'true'
    - name: collect_sacct_stats
      description: Whether or not to collect statistics from the sacct command.
      value:
        type: string
        example: 'true'
    - name: collect_sshare_stats
      description: Whether or not to collect statistics from the sshare command.
      value:
        type: string
        example: 'true'
    - name: collect_gpu_stats
      description: Whether or not to collect GPU statistics when Slurm is configured to use GPUs.
      value:
        type: string
        example: 'false'
    - name: sinfo_collection_level
      description: |
        The level of detail to collect from the sinfo command. The default is 'basic'. Available options are 1, 2 and
        3. Level 1 collects data only for partitions. Level 2 collects data from individual nodes. Level 3 
        collects data from from individual nodes as well but will be more verbose and include data such as CPU and 
        memory usage as reported from the OS as well as additional tags.
      value:
        type: string
        example: '1'
    - name: sinfo_path
      description: Full path to the sinfo binary.
      value:
        type: string
        example: /usr/bin/sinfo
    - name: sacct_path
      description: Full path to the sacct binary.
      value:
        type: string
        example: /usr/bin/sacct
    - name: sdiag_path
      description: Full path to the sdiag binary.
      value:
        type: string
        example: /usr/bin/sdiag
    - name: sshare_path
      description: Full path to the sshare binary.
      value:
        type: string
        example: /usr/bin/sshare
    - name: sqeuue_path
      description: Full path to the squeue binary.
      value:
        type: string
        example: /usr/bin/squeue
    - template: instances/default
      overrides:
        min_collection_interval.description: |
          This changes the collection interval of the check. For more information, see:
          https://docs.datadoghq.com/developers/write_agent_check/#collection-interval

          Most Slurm metrics are collected from calling the different binaries. Depending on the size of the slurm cluster,
          this can be a very expensive operation. It is recommended to set this to a higher value than the default 15 
          seconds, but this can be adjusted based on the size of the cluster and the desired granularity of the metrics.
        min_collection_interval.value.display_default: 15
        min_collection_interval.value.default: 60
        min_collection_interval.value.example: 60
        min_collection_interval.enabled: true

