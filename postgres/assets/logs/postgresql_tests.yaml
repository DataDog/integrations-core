id: "postgresql"
tests:
 -
  sample: "2017-11-07 17:30:39 UTC LOG:  incomplete startup packet"
  result:
    custom:
      db:
        date: 1510075839000
        severity: "LOG"
    message: "incomplete startup packet"
    status: "info"
    tags:
     - "source:LOGS_SOURCE"
    timestamp: 1510075839000
 -
  sample: "2017-11-08 18:11:35.727 UTC [5237] postgres psql postgres [local] 5a0348cd.1475 LOG:  statement: SELECT * FROM playground;"
  result:
    custom:
      db:
        date: 1510164695727
        instance: "postgres"
        operation: "SELECT"
        severity: "LOG"
        statement: "SELECT * FROM playground;"
        user: "postgres"
      network:
        client:
          ip: "[local]"
      postgres:
        appname: "psql"
        proc_id: "5237"
        session_id: "5a0348cd.1475"
    message: "2017-11-08 18:11:35.727 UTC [5237] postgres psql postgres [local] 5a0348cd.1475 LOG:  statement: SELECT * FROM playground;"
    status: "info"
    tags:
     - "source:LOGS_SOURCE"
     - "db:postgres"
    timestamp: 1510164695727
 -
  sample: "2019-12-10 18:27:45.389 UTC [114] datadog_test datadog-agent datadog 172.28.0.1 5defc7c5.72 LOG:  duration: 0.140 ms  statement: select checkpoints_timed, checkpoints_req, buffers_checkpoint, buffers_clean, maxwritten_clean, buffers_backend, buffers_alloc, buffers_backend_fsync, checkpoint_write_time, checkpoint_sync_time FROM pg_stat_bgwriter"
  result:
    custom:
      db:
        date: 1576002465389
        instance: "datadog_test"
        operation: "select"
        severity: "LOG"
        statement: "select checkpoints_timed, checkpoints_req, buffers_checkpoint, buffers_clean, maxwritten_clean, buffers_backend, buffers_alloc, buffers_backend_fsync, checkpoint_write_time, checkpoint_sync_time FROM pg_stat_bgwriter"
        user: "datadog"
      duration: 140000.0
      network:
        client:
          ip: "172.28.0.1"
      postgres:
        appname: "datadog-agent"
        proc_id: "114"
        session_id: "5defc7c5.72"
    message: "2019-12-10 18:27:45.389 UTC [114] datadog_test datadog-agent datadog 172.28.0.1 5defc7c5.72 LOG:  duration: 0.140 ms  statement: select checkpoints_timed, checkpoints_req, buffers_checkpoint, buffers_clean, maxwritten_clean, buffers_backend, buffers_alloc, buffers_backend_fsync, checkpoint_write_time, checkpoint_sync_time FROM pg_stat_bgwriter"
    status: "info"
    tags:
     - "source:LOGS_SOURCE"
     - "db:datadog_test"
    timestamp: 1576002465389
 -
  sample: "2025-09-15 19:05:58.892 UTC:10.0.216.218(36378):shopper_1@dbmorders_1:[20337]:395:00000:2025-09-15 19:02:57 UTC:384/39221:0:68c862e1.4f71:[unknown]:LOCATION:  exec_simple_query, postgres.c:1075"
  result:
    custom:
      db:
        backend_start: 1757962977000
        date: 1757963158892
        instance: "dbmorders_1"
        severity: "LOCATION"
        user: "shopper_1"
      network:
        client:
          ip: "10.0.216.218"
          port: 36378
      postgres:
        appname: "[unknown]"
        proc_id: "20337"
        session_id: "68c862e1.4f71"
        vxid: "384/39221"
        xid: "0"
      session_lineno: 395
      sql_state: "00000"
    message: "exec_simple_query, postgres.c:1075"
    status: "info"
    tags:
     - "source:LOGS_SOURCE"
     - "db:dbmorders_1"
    timestamp: 1757963158892
 -
  sample: "2025-09-16 18:26:45.429 UTC:192.168.65.1(31674):postgres@postgres:[87]:34853:00000:2025-09-16 18:25:58 UTC:5/2050:2823:68c9abb6.57:pgbench:LOG:  duration: 0.003 ms  execute <unnamed>: INSERT INTO pgbench_history (tid, bid, aid, delta, mtime) VALUES ($1, $2, $3, $4, CURRENT_TIMESTAMP);"
  result:
    custom:
      db:
        backend_start: 1758047158000
        date: 1758047205429
        instance: "postgres"
        severity: "LOG"
        user: "postgres"
      duration: 3000.0
      network:
        client:
          ip: "192.168.65.1"
          port: 31674
      postgres:
        appname: "pgbench"
        proc_id: "87"
        session_id: "68c9abb6.57"
        vxid: "5/2050"
        xid: "2823"
      session_lineno: 34853
      sql_state: "00000"
    message: "execute <unnamed>: INSERT INTO pgbench_history (tid, bid, aid, delta, mtime) VALUES ($1, $2, $3, $4, CURRENT_TIMESTAMP);"
    status: "info"
    tags:
     - "source:LOGS_SOURCE"
     - "db:postgres"
    timestamp: 1758047205429
