# Test configuration for kafka_actions - retrieve_messages action
# This retrieves messages from the orders topic and emits them as Datadog events
# 
# Usage:
#   1. Start docker-compose: cd ../kafka_consumer/local_dev && docker compose -f docker-compose-test.yml up -d
#   2. Wait for messages to be produced (check logs: docker logs kafka-producer)
#   3. Run this check manually to retrieve and filter messages

init_config:

instances:
  - action: retrieve_messages
    
    kafka_connect_str: localhost:9092
    security_protocol: PLAINTEXT
    
    retrieve_messages:
      # Retrieve from orders topic
      topic: orders
      
      # Read from all partitions
      partition: -1
      
      # Start from earliest messages
      start_offset: -2
      
      # Scan up to 100 messages
      max_messages_scan: 100
      
      # Send up to 10 matching messages as events
      max_messages_send: 10
      
      # Timeout after 30 seconds
      timeout_ms: 30000
      
      # Filter for messages with amount > 500
      filters:
        - field: value.amount
          operator: gt
          value: "500"
    
    tags:
      - env:test
      - integration:kafka_actions

