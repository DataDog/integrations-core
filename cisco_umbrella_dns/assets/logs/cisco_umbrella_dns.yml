id: cisco_umbrella_dns
metric_id: cisco-umbrella-dns
backend_only: false
facets:
  - name: Category
    source: log
    path: categories.label
    type: string
    facetType: list
    groups:
      - Cisco Umbrella DNS
  - name: Client Country Code
    source: log
    path: external.geoip.country.iso_code
    type: string
    facetType: list
    groups:
      - Cisco Umbrella DNS
  - name: Isolated State
    source: log
    path: isolated.state
    type: string
    facetType: list
    groups:
      - Cisco Umbrella DNS
  - name: Request Size
    source: log
    path: requestsize
    type: integer
    facetType: range
    groups:
      - Cisco Umbrella DNS
    unit:
      name: byte
      family: bytes
  - name: Response Size
    source: log
    path: responsesize
    type: integer
    facetType: range
    groups:
      - Cisco Umbrella DNS
    unit:
      name: byte
      family: bytes
  - name: Return Message
    source: log
    path: returnmessage
    type: string
    facetType: list
    groups:
      - Cisco Umbrella DNS
  - name: Verdict
    source: log
    path: verdict
    type: string
    facetType: list
    groups:
      - Cisco Umbrella DNS
  - name: Warn Status
    source: log
    path: warnstatus
    type: string
    facetType: list
    groups:
      - Cisco Umbrella DNS
pipeline:
  type: pipeline
  name: Cisco Umbrella DNS
  enabled: true
  filter:
    query: "source:cisco_umbrella_dns"
  processors:
    - type: date-remapper
      name:
        Define `timestamp` as the official date of the log
      enabled: true
      meta:
        last_update:
          timestamp: 1704090436181
          user_name: Darshil Surti
          user_email: darshil.surti@crestdatasys.com
        tags: []
      sources:
        - timestamp
    - type: service-remapper
      name: Define `type` as the official service of the log
      enabled: true
      meta:
        last_update:
          timestamp: 1704090104316
          user_name: Darshil Surti
          user_email: darshil.surti@crestdatasys.com
        tags: []
      sources:
        - type
    - type: attribute-remapper
      name: Map `type` to `log-type`
      enabled: true
      meta:
        last_update:
          user_id: "5795822"
          timestamp: 1704088010451
        tags: []
      sources:
        - type
      sourceType: attribute
      target: log-type
      targetType: attribute
      preserveSource: true
      overrideOnConflict: false
    - type: pipeline
      name: Cisco Umbrella DNS logs
      enabled: true
      filter:
        query: "@service:dns "
      processors:
        - type: attribute-remapper
          name: Map `querytype` to `dns.answer.type`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704087996572
            tags: []
          sources:
            - querytype
          sourceType: attribute
          target: dns.answer.type
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `returncode` to `dns.flags.rcode`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704088010451
            tags: []
          sources:
            - returncode
          sourceType: attribute
          target: dns.flags.rcode
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `domain` to `dns.question.name`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704088022304
            tags: []
          sources:
            - domain
          sourceType: attribute
          target: dns.question.name
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: geo-ip-parser
          name: GeoIP Parser for External IP
          enabled: true
          meta:
            last_update:
              user_id: "5191598"
              timestamp: 1702622526430
            tags: []
          sources:
            - externalip
          target: external.geoip
          ip_processing_behavior: do-nothing
        - name: Lookup on `dns.flags.rcode` (returncode) to `returnmessage` field
          enabled: true
          meta:
            last_update:
              user_id: "5191598"
              timestamp: 1702622640141
            tags: []
          source: dns.flags.rcode
          target: returnmessage
          lookupTable: |-
            0, NOERROR
            1, FORMERR
            2, SERVFAIL
            3, NXDOMAIN
            4, NOTIMP
            5, REFUSED
            6, YXDOMAIN
            7, XRRSET
            8, NOTAUTH
            9, NOTZONE
          type: lookup-processor
    - type: pipeline
      name: Cisco Umbrella Proxy logs
      enabled: true
      filter:
        query: "@service:proxy "
      processors:
        - type: attribute-remapper
          name: Map `externalip` to `network.client.ip`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704108982693
            tags: []
          sources:
            - externalip
          sourceType: attribute
          target: network.client.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `destinationip` to `network.destination.ip`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704088066314
            tags: []
          sources:
            - destinationip
          sourceType: attribute
          target: network.destination.ip
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `url` to `http.url`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704088075739
            tags: []
          sources:
            - url
          sourceType: attribute
          target: http.url
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `statuscode` to `http.status_code`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704088084552
            tags: []
          sources:
            - statuscode
          sourceType: attribute
          target: http.status_code
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `referer` to `http.referer`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704088093347
            tags: []
          sources:
            - referer
          sourceType: attribute
          target: http.referer
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `useragent` to `http.useragent`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704088102993
            tags: []
          sources:
            - useragent
          sourceType: attribute
          target: http.useragent
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `requestmethod` to `http.method`
          enabled: true
          meta:
            last_update:
              user_id: "5795822"
              timestamp: 1704088112370
            tags: []
          sources:
            - requestmethod
          sourceType: attribute
          target: http.method
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `requestsize` to `network.bytes_read`
          enabled: true
          meta:
            last_update:
              user_id: "5191598"
              timestamp: 1704098151264
            tags: []
          sources:
            - requestsize
          sourceType: attribute
          target: network.bytes_read
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `responsesize` to `network.bytes_written`
          enabled: true
          meta:
            last_update:
              user_id: "5191598"
              timestamp: 1704098160175
            tags: []
          sources:
            - responsesize
          sourceType: attribute
          target: network.bytes_written
          targetType: attribute
          preserveSource: true
          overrideOnConflict: false
        - type: user-agent-parser
          name: Extract details from `http.useragent`
          enabled: true
          meta:
            last_update:
              user_id: "5191598"
              timestamp: 1704102529700
            tags: []
          sources:
            - http.useragent
          target: http.useragent_details
          encoded: false
          combineVersionDetails: false
        - type: url-parser
          name: Extract details from `http.url`
          enabled: true
          meta:
            last_update:
              user_id: "5191598"
              timestamp: 1702622703663
            tags: []
          sources:
            - http.url
          target: http.url_details
          normalizeEndingSlashes: false
        - type: geo-ip-parser
          name: GeoIP Parser for `network.client.ip`  (externalip)
          enabled: true
          meta:
            last_update:
              user_id: "5191598"
              timestamp: 1702623732699
            tags: []
          sources:
            - network.client.ip
          target: network.client.geoip
          ip_processing_behavior: do-nothing
        - type: geo-ip-parser
          name: GeoIP Parser for `network.destination.ip` (destinationip)
          enabled: true
          meta:
            last_update:
              user_id: "5191598"
              timestamp: 1702623702414
            tags: []
          sources:
            - network.destination.ip
          target: network.destination.geoip
          ip_processing_behavior: do-nothing
