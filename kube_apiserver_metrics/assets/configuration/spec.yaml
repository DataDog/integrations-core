name: Kubernetes API server metrics
files:
- name: kube_apiserver_metrics.yaml
  options:
  - template: init_config
    options:
      - template: init_config/openmetrics_legacy
  - template: instances
    options:
    - name: scheme
      description: |
        Used to specify the scheme to reach the APIServer endpoints. Default to https.
        This option is deprecated, declare the scheme in the prometheus_url
        parameter instead.
      value:
        type: string
        example: https
    - template: instances/openmetrics_legacy
      overrides:
        prometheus_url.value.example: https://localhost:443/metrics
        prometheus_url.display_priority: 1
        bearer_token_auth.value.display_default: true
        bearer_token_auth.value.example: true

- name: auto_conf.yaml
  options:
  - template: ad_identifiers
    overrides:
      value.example:
      - kube-apiserver
  - template: init_config
    options: []
  - template: instances
    options:
    - name: possible_prometheus_urls
      required: true
      description: |
        The URLs to try to get your application metrics that are exposed by Prometheus.
        The check will try each URLs in the list and will use the first working one.
        One of possible_prometheus_urls or prometheus_url parameter is required.
      value:
        type: array
        items:
          type: string
        example:
          - https://%%host%%:6443/metrics
          - https://%%host%%:8443/metrics
    - name: prometheus_url
      required: false
      description: |
        The URL where your application metrics are exposed by Prometheus.
        One of possible_prometheus_urls or prometheus_url parameter is required.
      value:
        example: https://%%host%%:6443/metrics
        type: string
    - name: bearer_token_auth
      description: |
        Used if you are using RBACs and need the Agent to authenticate
        against the APIServer to retrieve metrics. Default to true.
      enabled: true
      value:
        example: tls_only
        default: false
        anyOf:
        - type: boolean
        - type: string
    - name: bearer_token_path
      description: Used to specify the path where the service account token is located.
      value:
        type: string
        example: /var/run/secrets/kubernetes.io/serviceaccount/token
    - name: ssl_verify
      description: Used to verify self signed certificates.
      value:
        type: boolean
        example: false
    - name: tags
      description: |
        List of tags to attach to every metric, event and service check emitted by this integration.

        Learn more about tagging: https://docs.datadoghq.com/tagging/
      enabled: true
      value:
        type: array
        items:
          type: string
        example:
          - "apiserver:%%host%%"
