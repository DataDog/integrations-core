version: "3"

services:
  weblogic-admin-server:
    build: .
    hostname: wlsadmin
    ports:
      - '7001:7001'
      - '7002:7002'
    healthcheck:
      test: curl -f http://wlsadmin:7001/weblogic/ready || exit 1
      interval: 10s
    volumes:
      - ${PROPERTIES_DIR}/docker-run:/u01/oracle/properties
    environment:
      JAVA_OPTIONS: >-
        -Dcom.sun.management.jmxremote
        -Dcom.sun.management.jmxremote.authenticate=false
        -Dcom.sun.management.jmxremote.ssl=false
        -Dcom.sun.management.jmxremote.port=7002
        -Dcom.sun.management.jmxremote.rmi.port=7002
        -Djava.rmi.server.hostname=0.0.0.0
        -Djavax.management.builder.initial=weblogic.management.jmx.mbeanserver.WLSMBeanServerBuilder
  weblogic-managed-server-1:
    build: .
    hostname: ms1
    ports:
      - '8001:8001'
      - '7003:7003'
    healthcheck:
      test: curl -f http://wlsadmin:7001/weblogic/ready || exit 1
      interval: 10s
    volumes:
      - ${PROPERTIES_DIR}/docker-run:/u01/oracle/properties
    environment:
      JAVA_OPTIONS: >-
        -Dcom.sun.management.jmxremote
        -Dcom.sun.management.jmxremote.authenticate=false
        -Dcom.sun.management.jmxremote.ssl=false
        -Dcom.sun.management.jmxremote.port=7003
        -Dcom.sun.management.jmxremote.rmi.port=7003
        -Djava.rmi.server.hostname=0.0.0.0
        -Djavax.management.builder.initial=weblogic.management.jmx.mbeanserver.WLSMBeanServerBuilder
      MANAGED_SERV_NAME: managed-server1
    command: 'startManagedServer.sh'
  weblogic-managed-server-2:
    build: .
    hostname: ms2
    ports:
      - '8002:8001'
      - '7004:7004'
    healthcheck:
      test: curl -f http://wlsadmin:7001/weblogic/ready || exit 1
      interval: 10s
    volumes:
      - ${PROPERTIES_DIR}/docker-run:/u01/oracle/properties
    environment:
      JAVA_OPTIONS: >-
        -Dcom.sun.management.jmxremote
        -Dcom.sun.management.jmxremote.authenticate=false
        -Dcom.sun.management.jmxremote.ssl=false
        -Dcom.sun.management.jmxremote.port=7004
        -Dcom.sun.management.jmxremote.rmi.port=7004
        -Djava.rmi.server.hostname=0.0.0.0
        -Djavax.management.builder.initial=weblogic.management.jmx.mbeanserver.WLSMBeanServerBuilder
      MANAGED_SERV_NAME: managed-server2
    command: 'startManagedServer.sh'