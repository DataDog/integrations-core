version: '3'

# Adapted from https://github.com/Lewuathe/docker-presto-cluster
services:
  coordinator:
    build:
      context: ./config
      args:
        NODE_TYPE: coordinator
        NODE_ID: coordinator
        VERSION: latest
    container_name: presto_coordinator
    ports:
      - "8080:8080"
      - "9997:9999"
    environment:
      JAVA_OPTS: >-
          -Dcom.sun.management.jmxremote=true
          -Dcom.sun.management.jmxremote.port=9997
          -Dcom.sun.management.jmxremote.rmi.port=9997
          -Dcom.sun.management.jmxremote.local.only=false
          -Dcom.sun.management.jmxremote.authenticate=false
          -Dcom.sun.management.jmxremote.ssl=false
          -Djava.rmi.server.hostname=localhost

  worker1:
    build:
      context: ./config
      args:
        NODE_TYPE: worker
        NODE_ID: worker1
        VERSION: latest
    container_name: presto_worker1
    ports:
      - "8081:8080"
      - "9998:9999"
    environment:
      JAVA_OPTS: >-
          -Dcom.sun.management.jmxremote=true
          -Dcom.sun.management.jmxremote.port=9998
          -Dcom.sun.management.jmxremote.rmi.port=9998
          -Dcom.sun.management.jmxremote.local.only=false
          -Dcom.sun.management.jmxremote.authenticate=false
          -Dcom.sun.management.jmxremote.ssl=false
          -Djava.rmi.server.hostname=localhost

  worker2:
    build:
      context: ./config
      args:
        NODE_TYPE: worker
        NODE_ID: worker2
        VERSION: latest
    container_name: presto_worker2
    ports:
      - "8082:8080"
      - "9999:9999"
    environment:
      JAVA_OPTS: >-
          -Dcom.sun.management.jmxremote=true
          -Dcom.sun.management.jmxremote.port=9999
          -Dcom.sun.management.jmxremote.rmi.port=9999
          -Dcom.sun.management.jmxremote.local.only=false
          -Dcom.sun.management.jmxremote.authenticate=false
          -Dcom.sun.management.jmxremote.ssl=false
          -Djava.rmi.server.hostname=localhost
