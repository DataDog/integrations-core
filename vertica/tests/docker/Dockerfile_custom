ARG VERTICA_VERSION="latest"
FROM opentext/vertica-k8s:${VERTICA_VERSION}

# Install tzdata (pick what exists in the base image)
RUN set -eux; \
  if command -v microdnf >/dev/null 2>&1; then microdnf install -y tzdata && microdnf clean all; \
  elif command -v dnf >/dev/null 2>&1; then dnf install -y tzdata && dnf clean all; \
  elif command -v apt-get >/dev/null 2>&1; then apt-get update && apt-get install -y --no-install-recommends tzdata && rm -rf /var/lib/apt/lists/*; \
  elif command -v apk >/dev/null 2>&1; then apk add --no-cache tzdata; \
  else echo "WARN: no known package manager; skipping tzdata" >&2; fi

# Put the entrypoint in a known location that always exists
ADD ./custom-entrypoint.sh /usr/local/bin/custom-entrypoint.sh
RUN chmod 755 /usr/local/bin/custom-entrypoint.sh

# If you still want to prune extension packages, do it safely (only if the var exists)
# This avoids failing when ${VERTICA_OPT_DIR} isn't defined at build-time
RUN set -eux; \
  if [ -n "${VERTICA_OPT_DIR:-}" ] && [ -d "${VERTICA_OPT_DIR}/packages" ]; then \
    rm -rf "${VERTICA_OPT_DIR}/packages"; \
  fi

# Use exec form; we explicitly call bash -lc for your scriptâ€™s shellisms
ENTRYPOINT ["/bin/bash","-lc","/usr/local/bin/custom-entrypoint.sh"]