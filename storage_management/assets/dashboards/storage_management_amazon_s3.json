{"title":"Storage Management for Amazon S3","description":"Comprehensive S3 storage visibility, cost analysis, and optimization opportunities using Datadog Storage Management. Includes estimated costs using S3 list price.","widgets":[{"id":75657843207589,"definition":{"title":"Storage Management for Amazon S3","background_color":"vivid_purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":5512594644265452,"definition":{"type":"note","content":"[Storage Management](https://app.datadoghq.com/storage-monitoring) provides prefix-level visibility into your Amazon S3 usage, access patterns, and growth over timeâ€”so you can pinpoint storage cost drivers and take confident action to reduce spend.  \n\nThis dashboard uses metrics from the [AWS S3 integration](https://docs.datadoghq.com/integrations/amazon_s3/#data-collected) (`aws.s3.*`) and [Storage Management](https://docs.datadoghq.com/infrastructure/storage_management/amazon_s3/?tab=setupinventoryfromdatadog#visualize-granular-s3-usage-with-inventory-metrics) (`aws.s3.inventory.*`) to provide both real-time activity signals and detailed prefix level insights.  \n\nFor more information on setup, refer to the Storage Management [Blog](https://www.datadoghq.com/blog/storage-monitoring/) and [Documentation](https://docs.datadoghq.com/integrations/guide/storage-monitoring-setup/?tab=cloudformation).","background_color":"transparent","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":6,"height":3}},{"id":6488714809552977,"definition":{"type":"note","content":"Use [Storage Management](https://app.datadoghq.com/storage-monitoring) to answer questions like:\n\n**[ðŸ“Š Storage Overview & Distribution](https://app.datadoghq.com/dashboard/rf6-8p7-ri6/storage-management-for-amazon-s3?fromUser=true&tile_focus=2803734135258892#5992697293816792)**\n* Which buckets/prefixes have the most storage?\n* How is my data distributed across storage tiers?\n\n**[ðŸ’° Cost Overview & Trends](https://app.datadoghq.com/dashboard/rf6-8p7-ri6/storage-management-for-amazon-s3?fromUser=true&tile_focus=534976710789555#5992697293816792)**\n* What is my estimated monthly S3 storage cost?\n* Which buckets are costing me the most?\n\n**[ðŸ” Prefix Drill Down](https://app.datadoghq.com/dashboard/rf6-8p7-ri6/storage-management-for-amazon-s3?fromUser=true&tile_focus=2672707737598794#5992697293816792)**\n* Which prefixes are growing fastest?\n\n**[â„ï¸ Optimization: Cold & Unaccessed Data](https://app.datadoghq.com/dashboard/rf6-8p7-ri6/storage-management-for-amazon-s3?fromUser=true&tile_focus=5992697293816792#5992697293816792)**\n* Is there unaccessed data I'm paying Standard prices for?\n\n**[ðŸ—‘ï¸ Optimization: Non-Current Versions](https://app.datadoghq.com/dashboard/rf6-8p7-ri6/storage-management-for-amazon-s3?fromUser=true&tile_focus=3279230363512968#5992697293816792)**\n* Do I have non-current versions or delete markers accumulating?","background_color":"transparent","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":6,"y":0,"width":6,"height":3}},{"id":7488547580231868,"definition":{"title":"Total Storage (All buckets)","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region}","data_source":"metrics","name":"query1","aggregator":"last"}]}],"autoscale":true,"precision":2},"layout":{"x":0,"y":3,"width":3,"height":1}},{"id":5241683781019832,"definition":{"title":"Total Objects (All buckets)","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"query1"}],"response_format":"scalar","queries":[{"query":"sum:aws.s3.number_of_objects{$aws_account,$bucketname,$aws_region}","data_source":"metrics","name":"query1","aggregator":"last"}]}],"autoscale":true,"precision":2},"layout":{"x":3,"y":3,"width":3,"height":1}},{"id":4037841606447832,"definition":{"title":"Storage Management Enabled Buckets","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"count_not_null(query1)"}],"response_format":"scalar","queries":[{"query":"sum:aws.s3.inventory.total_prefix_size{$bucketname} by {bucketname}","data_source":"metrics","name":"query1","aggregator":"last"}]}],"autoscale":true,"custom_links":[{"label":"Configure More Buckets for Storage Monitoring","link":"https://app.datadoghq.com/storage-monitoring?mConfigure=true"}],"precision":2},"layout":{"x":6,"y":3,"width":3,"height":1}},{"id":7034349067743673,"definition":{"title":"Est. Monthly Cost (Storage)","title_size":"16","title_align":"left","type":"query_value","requests":[{"formulas":[{"formula":"((standard) / 1073741824 * 0.023) + ((standard_ia) / 1073741824 * 0.0125) + ((onezone_ia) / 1073741824 * 0.01) + ((intelligent_tiering) / 1073741824 * 0.023) + ((glacier_ir) / 1073741824 * 0.004) + ((glacier) / 1073741824 * 0.0036) + ((deep_archive) / 1073741824 * 0.00099) + ((express_one_zone) / 1073741824 * 0.16) + ((reduced_redundancy) / 1073741824 * 0.024)","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}}],"response_format":"scalar","queries":[{"data_source":"metrics","name":"standard","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardstorage}","aggregator":"last"},{"data_source":"metrics","name":"standard_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardiastorage}","aggregator":"last"},{"data_source":"metrics","name":"onezone_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:onezoneiastorage}","aggregator":"last"},{"data_source":"metrics","name":"intelligent_tiering","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:inteligentieringstorage}","aggregator":"last"},{"data_source":"metrics","name":"glacier_ir","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierinstantretrievalstorage}","aggregator":"last"},{"data_source":"metrics","name":"glacier","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierstorage}","aggregator":"last"},{"data_source":"metrics","name":"deep_archive","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:deeparchivestorage}","aggregator":"last"},{"data_source":"metrics","name":"express_one_zone","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:expressonezoneiastorage}","aggregator":"last"},{"data_source":"metrics","name":"reduced_redundancy","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:reducedredundancystorage}","aggregator":"last"}]}],"autoscale":true,"custom_links":[{"label":"Create Cost Alert Monitor","link":"https://app.datadoghq.com/monitors/create?type=metric"}],"precision":2},"layout":{"x":9,"y":3,"width":3,"height":1}}]},"layout":{"x":0,"y":0,"width":12,"height":5}},{"id":2803734135258892,"definition":{"title":"ðŸ“Š Storage Overview & Distribution","background_color":"blue","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":5836742451154800,"definition":{"title":"Bucket Size Trend","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:aws.s3.bucket_size_bytes{$bucketname,$aws_account,$aws_region,$storagetype} by {bucketname}"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":0,"width":6,"height":4}},{"id":7159276052388457,"definition":{"title":"Number of Objects Trend","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"horizontal","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"formula":"query1"}],"queries":[{"query":"sum:aws.s3.number_of_objects{$aws_account,$bucketname,$aws_region} by {bucketname}","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":6,"y":0,"width":6,"height":4}},{"id":8344094268684115,"definition":{"title":"Total Size by Bucket","type":"treemap","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"sum:aws.s3.bucket_size_bytes{$bucketname,$aws_account,$aws_region,$storagetype} by {bucketname}","aggregator":"last"}],"response_format":"scalar","style":{"palette":"datadog16"},"formulas":[{"formula":"default_zero(query1)"}]}]},"layout":{"x":0,"y":4,"width":12,"height":4}},{"id":6019703664854459,"definition":{"title":"Tiers distribution","title_size":"16","title_align":"left","type":"bar_chart","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"sum:aws.s3.bucket_size_bytes{$bucketname , $aws_account , $aws_region} by {storagetype}","aggregator":"last"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"datadog16"}},"layout":{"x":0,"y":8,"width":6,"height":4}},{"id":4716764159242050,"definition":{"title":"Buckets & Tiers distribution","title_size":"16","title_align":"left","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"sum:aws.s3.bucket_size_bytes{$bucketname , $aws_account , $aws_region} by {bucketname,storagetype}","aggregator":"last"}],"response_format":"scalar","style":{"palette":"datadog16"},"formulas":[{"formula":"query1"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"type":"sunburst","legend":{"type":"automatic"}},"layout":{"x":6,"y":8,"width":6,"height":4}}]},"layout":{"x":0,"y":5,"width":12,"height":1}},{"id":534976710789555,"definition":{"title":"ðŸ’° Cost Overview & Trends","background_color":"orange","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":8607334353603350,"definition":{"type":"note","content":"**Estimated Costs** (us-east-1 pricing):\n\n| Tier | $/GB/Month |\n|------|------------|\n| Standard | $0.023 |\n| Standard-IA | $0.0125 |\n| One Zone-IA | $0.01 |\n| Intelligent-Tiering | $0.023 |\n| Glacier IR | $0.004 |\n| Glacier Flexible | $0.0036 |\n| Deep Archive | $0.00099 |\n| Express One Zone | $0.16 |\n| Reduced Redundancy | $0.024 |\n\n*Note: Prices vary by region. For accurate costs, use [Cloud Cost Management](https://app.datadoghq.com/cost).*","background_color":"yellow","font_size":"12","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":3,"height":3}},{"id":5714999474291496,"definition":{"title":"Est. Monthly Cost by Storage Tier","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"size_bytes","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region} by {storagetype}","aggregator":"last"}],"response_format":"scalar","sort":{"count":50,"order_by":[{"type":"formula","index":1,"order":"desc"}]},"formulas":[{"alias":"Size","cell_display_mode":"bar","formula":"size_bytes","number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family"}}},{"alias":"Est. Cost/Month","cell_display_mode":"bar","conditional_formats":[{"comparator":">","palette":"white_on_red","value":10000},{"comparator":">","palette":"white_on_yellow","value":1000},{"comparator":">=","palette":"white_on_green","value":0}],"formula":"size_bytes / 1073741824 * 0.023","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}}]}],"has_search_bar":"auto"},"layout":{"x":3,"y":0,"width":4,"height":3}},{"id":73608684025222,"definition":{"title":"Est. Monthly Cost by Bucket (Top 20)","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"standard","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"standard_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardiastorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"onezone_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:onezoneiastorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"intelligent_tiering","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:inteligentieringstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"glacier_ir","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierinstantretrievalstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"glacier","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"deep_archive","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:deeparchivestorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"express_one_zone","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:expressonezoneiastorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"reduced_redundancy","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:reducedredundancystorage} by {bucketname}","aggregator":"last"}],"response_format":"scalar","formulas":[{"formula":"(default_zero(standard) / 1073741824 * 0.023) + (default_zero(standard_ia) / 1073741824 * 0.0125) + (default_zero(glacier_ir) / 1073741824 * 0.004) + (default_zero(glacier) / 1073741824 * 0.0036) + (default_zero(deep_archive) / 1073741824 * 0.00099)","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}}],"sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"custom_links":[{"label":"Create Cost Alert for {{bucketname.value}}","link":"https://app.datadoghq.com/monitors/create?type=metric&query=sum:aws.s3.bucket_size_bytes{bucketname:{{bucketname.value}}}"}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"datadog16"}},"layout":{"x":7,"y":0,"width":5,"height":3}},{"id":4881733015020597,"definition":{"title":"Est. Monthly Cost Trend (by Tier)","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"horizontal","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"Standard","formula":"standard / 1073741824 * 0.023","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}},{"alias":"Standard-IA","formula":"standard_ia / 1073741824 * 0.0125","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}},{"alias":"Glacier IR","formula":"glacier_ir / 1073741824 * 0.004","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}},{"alias":"Glacier Flexible","formula":"glacier / 1073741824 * 0.0036","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}},{"alias":"Deep Archive","formula":"deep_archive / 1073741824 * 0.00099","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}}],"queries":[{"data_source":"metrics","name":"standard","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardstorage}"},{"data_source":"metrics","name":"standard_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardiastorage}"},{"data_source":"metrics","name":"onezone_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:onezoneiastorage}"},{"data_source":"metrics","name":"intelligent_tiering","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:inteligentieringstorage}"},{"data_source":"metrics","name":"glacier_ir","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierinstantretrievalstorage}"},{"data_source":"metrics","name":"glacier","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierstorage}"},{"data_source":"metrics","name":"deep_archive","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:deeparchivestorage}"},{"data_source":"metrics","name":"express_one_zone","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:expressonezoneiastorage}"},{"data_source":"metrics","name":"reduced_redundancy","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:reducedredundancystorage}"}],"response_format":"timeseries","style":{"palette":"semantic","line_type":"solid","line_width":"normal"},"display_type":"area"}]},"layout":{"x":0,"y":3,"width":4,"height":3}},{"id":2009395919217475,"definition":{"title":"Increases by Bucket (WoW)","title_size":"16","title_align":"left","type":"change","custom_links":[{"label":"Investigate {{bucketname.value}} in Storage Management","link":"https://app.datadoghq.com/storage-monitoring/?id={{bucketname.value}}"}],"requests":[{"increase_good":false,"order_by":"change","change_type":"absolute","order_dir":"desc","response_format":"scalar","formulas":[{"formula":"week_before((default_zero(standard) / 1073741824 * 0.023) + (default_zero(standard_ia) / 1073741824 * 0.0125) + (default_zero(glacier_ir) / 1073741824 * 0.004))","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}},{"formula":"(default_zero(standard) / 1073741824 * 0.023) + (default_zero(standard_ia) / 1073741824 * 0.0125) + (default_zero(glacier_ir) / 1073741824 * 0.004)","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}}],"queries":[{"data_source":"metrics","name":"standard","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"standard_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardiastorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"onezone_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:onezoneiastorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"intelligent_tiering","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:inteligentieringstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"glacier_ir","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierinstantretrievalstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"glacier","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"deep_archive","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:deeparchivestorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"express_one_zone","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:expressonezoneiastorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"reduced_redundancy","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:reducedredundancystorage} by {bucketname}","aggregator":"last"}],"show_present":true}]},"layout":{"x":4,"y":3,"width":4,"height":3}},{"id":4803088509395483,"definition":{"title":"Decreases by Bucket (WoW)","title_size":"16","title_align":"left","type":"change","custom_links":[{"label":"Investigate {{bucketname.value}} in Storage Management","link":"https://app.datadoghq.com/storage-monitoring/?id={{bucketname.value}}"}],"requests":[{"increase_good":false,"order_by":"change","change_type":"absolute","order_dir":"asc","response_format":"scalar","formulas":[{"formula":"week_before((default_zero(standard) / 1073741824 * 0.023) + (default_zero(standard_ia) / 1073741824 * 0.0125) + (default_zero(glacier_ir) / 1073741824 * 0.004))","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}},{"formula":"(default_zero(standard) / 1073741824 * 0.023) + (default_zero(standard_ia) / 1073741824 * 0.0125) + (default_zero(glacier_ir) / 1073741824 * 0.004)"}],"queries":[{"data_source":"metrics","name":"standard","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"standard_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:standardiastorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"onezone_ia","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:onezoneiastorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"intelligent_tiering","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:inteligentieringstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"glacier_ir","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierinstantretrievalstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"glacier","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:glacierstorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"deep_archive","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:deeparchivestorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"express_one_zone","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:expressonezoneiastorage} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"reduced_redundancy","query":"sum:aws.s3.bucket_size_bytes{$aws_account,$bucketname,$aws_region,storagetype:reducedredundancystorage} by {bucketname}","aggregator":"last"}],"show_present":true}]},"layout":{"x":8,"y":3,"width":4,"height":3}}]},"layout":{"x":0,"y":6,"width":12,"height":1}},{"id":2672707737598794,"definition":{"title":"ðŸ” Prefix Drill Down (Storage Management)","background_color":"purple","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":2234041139663607,"definition":{"type":"note","content":"**Note**: Storage Management metrics include object data only (not metadata).\\\nNon-current versions and multipart uploads are included only if enabled in the inventory configuration.","background_color":"yellow","font_size":"14","text_align":"center","vertical_align":"center","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":12,"height":1}},{"id":4562882178168224,"definition":{"title":"Prefix size (3 levels deep)","type":"treemap","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"sum:aws.s3.inventory.total_prefix_size.levels{$bucketname,$aws_account,$prefix,$aws_region} by {bucketname,prefix0,prefix1,prefix2,prefix3}","aggregator":"last"}],"response_format":"scalar","style":{"palette":"datadog16"},"formulas":[{"formula":"query1"}]}]},"layout":{"x":0,"y":1,"width":12,"height":4}},{"id":2006848926778426,"definition":{"title":"Increases in Storage by Prefix (WoW)","type":"change","custom_links":[{"label":"Create Growth Alert Monitor","link":"https://app.datadoghq.com/monitors/create?type=metric"}],"requests":[{"increase_good":false,"order_by":"change","change_type":"relative","order_dir":"desc","response_format":"scalar","formulas":[{"formula":"week_before(query1)"},{"formula":"query1"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:aws.s3.inventory.total_prefix_size.levels{$bucketname,$aws_account,$prefix,$aws_region, prefix0:* , prefix1:* ,prefix2:* ,prefix3:*} by {bucketname,prefix1,prefix2,prefix3}","aggregator":"last"}]}]},"layout":{"x":0,"y":5,"width":6,"height":4}},{"id":4072502053067588,"definition":{"title":"Decreases in Storage by Prefix (WoW)","type":"change","custom_links":[{"label":"Create Growth Alert Monitor","link":"https://app.datadoghq.com/monitors/create?type=metric"}],"requests":[{"increase_good":false,"order_by":"change","change_type":"relative","order_dir":"asc","response_format":"scalar","formulas":[{"formula":"week_before(query1)"},{"formula":"query1"}],"queries":[{"name":"query1","data_source":"metrics","query":"sum:aws.s3.inventory.total_prefix_size.levels{$bucketname,$aws_account,$prefix,$aws_region, prefix0:* , prefix1:* ,prefix2:* ,prefix3:*} by {bucketname,prefix1,prefix2,prefix3}","aggregator":"last"}]}]},"layout":{"x":6,"y":5,"width":6,"height":4}},{"id":1776120838289628,"definition":{"title":"Prefixes with Most Storage","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.s3.inventory.total_prefix_size{$bucketname,$aws_account,$prefix,$aws_region} by {prefix}","aggregator":"last"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"layout":{"x":0,"y":9,"width":6,"height":3}},{"id":3529071251662775,"definition":{"title":"Prefixes with Most Objects","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.s3.inventory.prefix_object_count{$bucketname,$aws_account,$prefix,$aws_region} by {prefix}.as_count()","aggregator":"last"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"}}},"layout":{"x":6,"y":9,"width":6,"height":3}}]},"layout":{"x":0,"y":7,"width":12,"height":1}},{"id":7751028775711387,"definition":{"title":"ðŸ”§ Access Patterns & Request Analysis","background_color":"pink","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":6392232713253600,"definition":{"type":"note","content":"## ðŸ“Š Access Pattern Insights\n\n**Unlock prefix-level activity data** by enabling S3 Access Logs:\n\n1. Enable [S3 Server Access Logging](https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html) on your buckets\n2. Forward logs to Datadog via [Log Forwarder](https://docs.datadoghq.com/logs/guide/forwarder/)\n3. Storage Management will process and aggregate by prefix\n\nâ†’ [View Storage Management Activity](https://app.datadoghq.com/storage-monitoring)\n\n---\n\n**Bucket-level metrics (CloudWatch)** require enabling [S3 Request Metrics](https://docs.aws.amazon.com/AmazonS3/latest/userguide/cloudwatch-monitoring.html) per bucket in AWS. Note: CloudWatch request metrics incur additional AWS charges.\n\n*Both options require setup â€” enable what fits your observability needs.*","background_color":"orange","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":6,"height":4}},{"id":2384512178022754,"definition":{"title":"Prefix Requests (Requires Access Logs)","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"query":"sum:aws.s3.inventory.access_logs.total_requests_by_method{*} by {bucketname,prefix,method}","data_source":"metrics","name":"query1","aggregator":"avg"}],"response_format":"scalar","sort":{"count":50,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"conditional_formats":[{"custom_bg_color":"#e7dbff","comparator":">","palette":"custom_bg","value":0}],"cell_display_mode":"bar","alias":"Requests","formula":"query1"}]}],"has_search_bar":"auto","custom_links":[{"label":"Setup Access Logs","link":"https://docs.datadoghq.com/logs/guide/send-aws-services-logs-with-the-datadog-lambda-function/"}]},"layout":{"x":6,"y":0,"width":6,"height":4}},{"id":5518845200609728,"definition":{"title":"Request Trends by Bucket","title_size":"16","title_align":"left","show_legend":true,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"formulas":[{"alias":"All Requests","formula":"query1"}],"queries":[{"query":"sum:aws.s3.all_requests{$bucketname,$aws_account,$aws_region} by {bucketname}.as_count()","data_source":"metrics","name":"query1"}],"response_format":"timeseries","style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"bars"}]},"layout":{"x":0,"y":4,"width":6,"height":4}},{"id":1849846957027831,"definition":{"title":"ðŸ“Š Bucket Requests (CloudWatch - Requires Setup)","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"query":"sum:aws.s3.all_requests{$bucketname} by {bucketname,aws_account,region}.as_count()","data_source":"metrics","name":"all_requests","aggregator":"sum"},{"query":"sum:aws.s3.get_requests{$bucketname} by {bucketname,aws_account,region}.as_count()","data_source":"metrics","name":"get_requests","aggregator":"sum"},{"query":"sum:aws.s3.put_requests{$bucketname} by {bucketname,aws_account,region}.as_count()","data_source":"metrics","name":"put_requests","aggregator":"sum"}],"response_format":"scalar","sort":{"count":50,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"conditional_formats":[{"comparator":">","palette":"white_on_green","value":1000000},{"comparator":">","palette":"white_on_yellow","value":100000}],"cell_display_mode":"bar","alias":"Total Requests","formula":"all_requests"},{"cell_display_mode":"bar","alias":"GET","formula":"get_requests"},{"cell_display_mode":"bar","alias":"PUT","formula":"put_requests"},{"alias":"Read %","formula":"(get_requests / all_requests) * 100","conditional_formats":[{"comparator":"<","palette":"white_on_red","value":10}]}]}],"has_search_bar":"auto"},"layout":{"x":6,"y":4,"width":6,"height":4}}]},"layout":{"x":0,"y":8,"width":12,"height":9}},{"id":5992697293816792,"definition":{"title":"â„ï¸ Optimization: Cold & Unaccessed Data","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":4280014781492455,"definition":{"type":"note","content":"## ðŸŽ¯ Goal: Identify data that can be moved to cheaper tiers\n\n**Two signals for cold data:**\n\n| Signal | Metric | Meaning |\n|--------|--------|---------|\n| **Low Access** | `aws.s3.inventory.access_logs.total_requests_by_method` (requires Access Logs) | Prefixes with few/no read requests |\n| **Old Objects** | `aws.s3.inventory.prefix_age_days` | Prefix contains objects created long ago |\n\nâš ï¸ **Key insight:** Old â‰  Cold. A prefix with old objects may still be frequently accessed. Prioritize by **access patterns** when available.\n\nâ†’ [Enable S3 Access Logs](https://docs.aws.amazon.com/AmazonS3/latest/userguide/ServerLogs.html) to unlock access-based insights","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":4,"height":4}},{"id":6419432177136675,"definition":{"title":"Prefix Overview: Size, Access & Age","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.s3.inventory.total_prefix_size{$bucketname} by {bucketname,prefix}","aggregator":"last"},{"data_source":"metrics","name":"query2","query":"sum:aws.s3.inventory.access_logs.total_requests_by_method{$bucketname} by {bucketname,prefix}.rollup(count, daily)","aggregator":"max"},{"data_source":"metrics","name":"query3","query":"sum:aws.s3.inventory.prefix_age_days{$bucketname} by {bucketname,prefix}","aggregator":"last"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":2,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","alias":"Prefix Size","formula":"query1","number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family"}}},{"cell_display_mode":"bar","alias":"Requests","formula":"query2","conditional_formats":[{"comparator":"<=","palette":"white_on_red","value":0},{"comparator":"<","palette":"white_on_yellow","value":10},{"comparator":">=","palette":"white_on_green","value":10}]},{"cell_display_mode":"bar","alias":"Oldest Object Age (Days)","formula":"exclude_null(query3)","conditional_formats":[{"comparator":">","palette":"white_on_red","value":180},{"comparator":">","palette":"white_on_yellow","value":90},{"comparator":"<=","palette":"white_on_green","value":90}]},{"alias":"Est. Monthly Cost ($)","formula":"query1 / 1073741824 * 0.023","conditional_formats":[{"comparator":">","palette":"white_on_red","value":1000},{"comparator":">","palette":"white_on_yellow","value":100}],"number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}}]}],"has_search_bar":"auto","custom_links":[{"label":"View in Storage Management","link":"https://app.datadoghq.com/storage-monitoring/?id={{bucketname.value}}&bucket-side-panel="},{"label":"Create Lifecycle Rule in AWS","link":"https://s3.console.aws.amazon.com/s3/buckets/{{bucketname.value}}?tab=management"}]},"layout":{"x":4,"y":0,"width":8,"height":4}},{"id":5821426827593117,"definition":{"title":"Oldest Prefixes (Age of Oldest Object in Days)","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.s3.inventory.prefix_age_days{$bucketname} by {bucketname,prefix}","aggregator":"last"}],"response_format":"scalar","formulas":[{"formula":"query1","conditional_formats":[{"comparator":">","palette":"white_on_red","value":365},{"comparator":">","palette":"white_on_yellow","value":180}]}],"sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"datadog16"}},"layout":{"x":0,"y":4,"width":6,"height":4}},{"id":4517983433928302,"definition":{"title":"Least Accessed Prefixes (Requires Access Logs)","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.s3.inventory.access_logs.total_requests_by_method{$bucketname} by {bucketname,prefix}","aggregator":"sum"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"asc"}]}}]},"layout":{"x":6,"y":4,"width":6,"height":4}},{"id":872442429255081,"definition":{"title":"Bottom 20: Least Accessed Standard Tier Prefixes","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"requests","query":"sum:aws.s3.inventory.access_logs.total_requests_by_method{storagetype:standard,$bucketname} by {bucketname,prefix}","aggregator":"sum"},{"data_source":"metrics","name":"size","query":"sum:aws.s3.inventory.total_prefix_size{storagetype:standard,$bucketname} by {bucketname,prefix}","aggregator":"last"}],"response_format":"scalar","sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"asc"}]},"formulas":[{"formula":"requests","alias":"Requests"},{"formula":"size","alias":"Size"},{"formula":"size / 1073741824 * 0.023","alias":"Est. Cost/Mo ($)"}]}]},"layout":{"x":0,"y":8,"width":12,"height":4}}]},"layout":{"x":0,"y":17,"width":12,"height":13,"is_column_break":true}},{"id":2506633411746777,"definition":{"title":"ðŸ·ï¸ Optimization: Standard Tier Review","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":2244764576741509,"definition":{"type":"note","content":"## ðŸŽ¯ Goal: Validate data in Standard tier\n\n**Question:** Is expensive Standard tier storage justified?\n\n**Review criteria:**\n- âœ… Keep in Standard: Frequently accessed, low latency required\n- âš ï¸ Consider IA: Accessed monthly or less\n- ðŸ”„ Consider Intelligent-Tiering: Unpredictable access patterns\n- â„ï¸ Consider Glacier: Archival/compliance data\n","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":4,"height":3}},{"id":6956217241703554,"definition":{"title":"Buckets/Prefixes with most increase in Standard (WoW)","title_size":"16","title_align":"left","type":"change","custom_links":[{"label":"Create Growth Alert","link":"https://app.datadoghq.com/monitors/create?type=metric"}],"requests":[{"increase_good":false,"order_by":"change","change_type":"absolute","order_dir":"desc","response_format":"scalar","formulas":[{"formula":"week_before(query1)"},{"formula":"query1"}],"queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.s3.inventory.total_prefix_size{storagetype:standard, $bucketname} by {bucketname,prefix}","aggregator":"last"}],"show_present":true}]},"layout":{"x":4,"y":0,"width":8,"height":3}},{"id":6903603178096923,"definition":{"title":"Biggest buckets/prefixes in Standard tier","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.s3.inventory.total_prefix_size{storagetype:standard, $bucketname} by {bucketname,prefix}","aggregator":"last"}],"response_format":"scalar","sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"formula":"query1","cell_display_mode":"bar","alias":"Size","number_format":{"unit":{"type":"canonical_unit","unit_name":"byte_in_binary_bytes_family"}}},{"formula":"query1 / 1073741824 * 0.023","alias":"Est. Cost/Mo ($)","conditional_formats":[{"comparator":">","palette":"white_on_red","value":1000},{"comparator":">","palette":"white_on_yellow","value":100}],"number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}}]}],"has_search_bar":"auto"},"layout":{"x":0,"y":3,"width":6,"height":4}},{"id":8261982782774245,"definition":{"title":"Biggest Prefixes by Storage Tiers","type":"treemap","requests":[{"response_format":"scalar","queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.s3.inventory.total_prefix_size.levels{$bucketname,$storagetype} by {bucketname,storagetype,prefix1,prefix2}","aggregator":"last"}],"style":{"palette":"datadog16"},"formulas":[{"formula":"query1"}]}]},"layout":{"x":6,"y":3,"width":6,"height":4}}]},"layout":{"x":0,"y":30,"width":12,"height":8}},{"id":3279230363512968,"definition":{"title":"ðŸ—‘ï¸ Optimization: Non-Current Versions & Delete Markers","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":7858500001844505,"definition":{"type":"note","content":"## ðŸŽ¯ Goal: Clean up versioning overhead\n\n**What accumulates:**\n- Non-current object versions (old versions kept after updates)\n- Delete markers (tombstones from versioned deletes)\n- Incomplete multipart uploads\n\n**Why it matters:**\n- Hidden storage costs (not visible in basic views)\n- Can exceed current data size in active buckets\n\n**Action:** Add lifecycle rules to:\n- Expire non-current versions after N days\n- Remove delete markers when they're the only version\n- Abort incomplete multipart uploads after 7 days","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":4,"height":4}},{"id":8605198739258684,"definition":{"title":"Non Current Versions","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"query":"sum:aws.s3.inventory.total_prefix_size.levels{$bucketname, is_latest:false*, prefix1:*, prefix2:*, prefix3:*} by {bucketname,storagetype,prefix1,prefix2,prefix3}","data_source":"metrics","name":"query1","aggregator":"last"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"cell_display_mode":"bar","alias":"Non Current Bytes","formula":"query1"}]}],"has_search_bar":"auto"},"layout":{"x":4,"y":0,"width":8,"height":4}},{"id":8591849631830706,"definition":{"title":"Non-Current Versions Size Trend","title_size":"16","title_align":"left","show_legend":false,"type":"timeseries","requests":[{"queries":[{"data_source":"metrics","name":"noncurrent_size","query":"sum:aws.s3.inventory.total_prefix_size.levels{is_latest:false,$bucketname} by {bucketname}"}],"formulas":[{"formula":"noncurrent_size","alias":"Non-Current Size"}],"response_format":"timeseries","display_type":"line"}],"yaxis":{"include_zero":true,"scale":"linear"}},"layout":{"x":0,"y":4,"width":4,"height":3}},{"id":1337171094723004,"definition":{"type":"note","content":"**ðŸ“Š Understanding the Object Count Delta**\n\nCloudWatch reports *all* objects (`aws.s3.number_of_objects`), while Storage Management counts only objects included in your S3 Inventory configuration (`aws.s3.inventory.prefix_object_count`).\n\n**A large delta indicates hidden overhead:**\n- Non-current versions (if excluded from inventory)\n- Delete markers (if excluded from inventory)  \n- Object metadata overhead\n\nâ†’ Configure your [S3 Inventory](https://docs.aws.amazon.com/AmazonS3/latest/userguide/storage-inventory.html) to include non-current versions for full visibility.","background_color":"yellow","font_size":"14","text_align":"left","vertical_align":"center","show_tick":true,"tick_pos":"50%","tick_edge":"right","has_padding":true},"layout":{"x":4,"y":4,"width":4,"height":3}},{"id":7176899143381667,"definition":{"title":"Buckets: Object Count Delta (Potential Hidden Overhead)","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"query":"sum:aws.s3.number_of_objects{$bucketname} by {bucketname}","data_source":"metrics","name":"total_cw","aggregator":"last"},{"query":"sum:aws.s3.inventory.prefix_object_count.levels{$bucketname} by {bucketname}.as_count()","data_source":"metrics","name":"current_inv","aggregator":"last"}],"response_format":"scalar","sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"alias":"Non-Current Count","cell_display_mode":"bar","conditional_formats":[{"comparator":">","palette":"white_on_red","value":1000000},{"comparator":">","palette":"white_on_yellow","value":100000}],"formula":"total_cw - current_inv"},{"alias":"Current %","cell_display_mode":"bar","formula":"(current_inv / total_cw) * 100"}]}],"has_search_bar":"auto"},"layout":{"x":8,"y":4,"width":4,"height":3}},{"id":7052727722783233,"definition":{"title":"Increases in Non-current version data (MoM)","title_size":"16","title_align":"left","type":"change","requests":[{"increase_good":false,"order_by":"change","change_type":"absolute","order_dir":"desc","response_format":"scalar","formulas":[{"formula":"month_before(query1)"},{"formula":"query1"}],"queries":[{"query":"sum:aws.s3.inventory.total_prefix_size.levels{$bucketname, is_latest:false*, prefix0:* ,prefix1:* ,prefix2:* , prefix3:*} by {bucketname,prefix1,prefix2,prefix3}","data_source":"metrics","name":"query1","aggregator":"last"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}]},"layout":{"x":0,"y":7,"width":6,"height":3}},{"id":1381505656090121,"definition":{"title":"Decreases in Non-current version data (MoM)","title_size":"16","title_align":"left","time":{"type":"live","unit":"month","value":1},"type":"change","requests":[{"increase_good":false,"order_by":"change","change_type":"absolute","order_dir":"asc","response_format":"scalar","formulas":[{"formula":"month_before(query1)"},{"formula":"query1"}],"queries":[{"query":"sum:aws.s3.inventory.total_prefix_size.levels{$bucketname, is_latest:false* , prefix0:* ,prefix1:* ,prefix2:* ,prefix3:*} by {bucketname,prefix1,prefix2,prefix3}","data_source":"metrics","name":"query1","aggregator":"last"}],"sort":{"count":500,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}]},"layout":{"x":6,"y":7,"width":6,"height":3}},{"id":5457142434133248,"definition":{"title":"Prefixes with Most Delete Markers","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"data_source":"metrics","name":"query1","query":"sum:aws.s3.inventory.prefix_object_count.levels{delete_marker:true, $bucketname , prefix1:*,prefix2:* ,prefix3:*} by {bucketname,prefix1,prefix2,prefix3}","aggregator":"last"}],"response_format":"scalar","formulas":[{"formula":"query1"}],"sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{}},"layout":{"x":0,"y":10,"width":6,"height":3}}]},"layout":{"x":0,"y":38,"width":12,"height":14}},{"id":2659774398526289,"definition":{"title":"ðŸ“¦ Optimization: Small Object Overhead","background_color":"vivid_green","show_title":true,"type":"group","layout_type":"ordered","widgets":[{"id":6666402537731711,"definition":{"type":"note","content":"## ðŸŽ¯ Goal: Reduce small file overhead costs\n\n**The problem:**\nObjects smaller than 128 KB are billed as 128 KB each in:\n- Standard-IA\n- Glacier Instant Retrieval\n\n**Impact calculation:**\n- 1,000 files Ã— 1 KB actual = 1 MB stored\n- 1,000 files Ã— 128 KB billed = 125 MB charged\n- **125Ã— overhead!**\n\n**Solutions:**\n1. Bundle small files (TAR/ZIP) before transitioning\n2. Use Parquet/ORC for columnar data\n3. Keep small files in Standard tier\n4. Use S3 Intelligent-Tiering (no min size)","background_color":"white","font_size":"14","text_align":"left","vertical_align":"top","show_tick":false,"tick_pos":"50%","tick_edge":"left","has_padding":true},"layout":{"x":0,"y":0,"width":4,"height":4}},{"id":1476016800569234,"definition":{"title":"Small File Overhead by Bucket (IA/Glacier IR)","title_size":"16","title_align":"left","type":"query_table","requests":[{"queries":[{"data_source":"metrics","name":"small_count","query":"sum:aws.s3.inventory.prefix_small_file_count{storagetype IN (glacier_ir,standard_ia),$bucketname} by {bucketname}","aggregator":"last"},{"data_source":"metrics","name":"small_actual_size","query":"sum:aws.s3.inventory.prefix_small_file_size{storagetype IN (glacier_ir,standard_ia),$bucketname} by {bucketname}","aggregator":"last"}],"response_format":"scalar","sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"desc"}]},"formulas":[{"alias":"Small File Count","formula":"small_count"},{"alias":"Actual Size","formula":"small_actual_size"},{"alias":"Billed Size (128KB min)","formula":"small_count * 131072"},{"alias":"Est Overhead Cost/Mo ($)","formula":"((small_count * 131072) - small_actual_size) / 1073741824 * 0.0125","number_format":{"unit":{"type":"canonical_unit","unit_name":"dollar"}}}]}]},"layout":{"x":4,"y":0,"width":8,"height":3}},{"id":5777379104729541,"definition":{"title":"# of Objects <128KB in Standard IA or Glacier IR","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"sum:aws.s3.inventory.prefix_small_file_count{storagetype IN (glacier_ir,standard_ia)} by {bucketname,prefix}.as_count()","aggregator":"last"}],"response_format":"scalar","formulas":[{"formula":"query1","conditional_formats":[{"comparator":">","palette":"white_on_red","value":100000},{"comparator":">","palette":"white_on_yellow","value":10000}]}],"sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"dog_classic"}},"layout":{"x":4,"y":3,"width":4,"height":4}},{"id":57825562843977,"definition":{"title":"% of Objects <128KB (IA/Glacier IR)","title_size":"16","title_align":"left","type":"toplist","requests":[{"queries":[{"name":"query1","data_source":"metrics","query":"sum:aws.s3.inventory.prefix_small_file_count{storagetype IN (glacier_ir,standard_ia)} by {bucketname,prefix}.as_count()","aggregator":"last"},{"name":"query2","data_source":"metrics","query":"sum:aws.s3.inventory.prefix_object_count{storagetype IN (glacier_ir,standard_ia)} by {bucketname,prefix}.as_count()","aggregator":"last"}],"response_format":"scalar","formulas":[{"formula":"(query1 / query2) * 100","conditional_formats":[{"comparator":">","palette":"white_on_red","value":50},{"comparator":">","palette":"white_on_yellow","value":20}]}],"sort":{"count":20,"order_by":[{"type":"formula","index":0,"order":"desc"}]}}],"style":{"display":{"type":"stacked","legend":"automatic"},"palette":"dog_classic"}},"layout":{"x":8,"y":3,"width":4,"height":4}},{"id":8875123732258809,"definition":{"title":"Small Files Size Trend (IA/Glacier IR)","title_size":"16","title_align":"left","show_legend":false,"legend_layout":"auto","legend_columns":["avg","min","max","value","sum"],"type":"timeseries","requests":[{"response_format":"timeseries","queries":[{"name":"query2","data_source":"metrics","query":"sum:aws.s3.inventory.prefix_small_file_size{storagetype IN (glacier_ir,standard_ia)} by {bucketname,prefix}"}],"formulas":[{"formula":"query2"}],"style":{"palette":"dog_classic","line_type":"solid","line_width":"normal"},"display_type":"line"}]},"layout":{"x":0,"y":4,"width":4,"height":3}}]},"layout":{"x":0,"y":52,"width":12,"height":8}}],"template_variables":[{"name":"bucketname","prefix":"bucketname","available_values":[],"default":"*"},{"name":"prefix","prefix":"prefix","available_values":[],"default":"*"},{"name":"aws_account","prefix":"aws_account","available_values":[],"default":"*"},{"name":"aws_region","prefix":"region","available_values":[],"default":"*"},{"name":"storagetype","prefix":"storagetype","available_values":[],"default":"*"}],"layout_type":"ordered","notify_list":[],"template_variable_presets":[{"name":"Orange Logic S3 view","description":"","template_variables":[{"name":"bucketname","values":["ae-eng-us-orangelogic-cortex-proxies-qa-01","ae-se-us-orangelogic-tiering-dev-01","ae-eng-us-orangelogic-cortex-originals-qa-01","ae-eng-us-orangelogic-cortex-proxies-prod-01","ae-eng-us-orangelogic-cortex-originals-prod-01","ae-eng-us-orangelogic-cortex-transition-prod-02","ae-eng-us-orangelogic-cortex-transition-prod-01","ae-eng-us-orangelogic-cortex-test-proxies-qa-01","ae-eng-us-orangelogic-cortex-test-originals-qa-01","ae-eng-us-orangelogic-cortex-test-proxies-prod-01","ae-eng-us-orangelogic-cortex-proxies-glacier-qa-01","ae-eng-us-orangelogic-cortex-test-originals-prod-01","ae-eng-us-orangelogic-cortex-originals-glacier-qa-01","ae-eng-us-orangelogic-cortex-proxies-glacier-prod-01","ae-eng-us-orangelogic-cortex-access-migration-prod-01","ae-eng-us-orangelogic-cortex-access-migration-prod-02","ae-eng-us-orangelogic-cortex-originals-glacier-prod-01"]},{"name":"prefix","value":"*"},{"name":"aws_account","value":"*"},{"name":"aws_region","value":"*"}]},{"name":"Top Cost Buckets (Standard)","description":"Focus on buckets with most Standard tier storage","template_variables":[{"name":"bucketname","value":"*"},{"name":"prefix","value":"*"},{"name":"aws_account","value":"*"},{"name":"aws_region","value":"*"},{"name":"storagetype","value":"standardstorage"}]}],"reflow_type":"fixed"}
