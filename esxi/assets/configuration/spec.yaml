name: ESXi
files:
- name: esxi.yaml
  options:
  - template: init_config
    options:
    - template: init_config/default
  - template: instances
    options:
        - name: host
          required: true
          display_priority: 1
          description: The host used to resolve the ESXi IP. It is either a FQDN or an IP.
          value:
            type: string
            example: <HOSTNAME>
        - name: username
          required: true
          display_priority: 1
          description: |
            The ESXi host username
          value:
            type: string
            example: <USERNAME>
        - name: password
          required: true
          display_priority: 1
          description: |
            The ESXi host password
          value:
            type: string
            example: <PASSWORD>
        - name: use_guest_hostname
          description: |
            If true, the check will use the guest hostname for VMs instead of the VM name.
            This requires the VM to have VMware tools installed. If the guest hostname is
            not available, it will fallback to the VM name.
            Use this if you install the agent on VMs to avoid duplicate entries for hosts
            in the web application UI.
            Note: If VMs are duplicated in the Infrastructure List, follow these troubleshooting steps
                  https://docs.datadoghq.com/integrations/faq/troubleshooting-duplicated-hosts-with-vsphere/.
          value:
            type: boolean
            example: false
        - name: collect_per_instance_filters
          description: |
            Use this option to collect metrics tagged with instance values.
            Some ESXi metrics can be tagged with instance values.
            For each resource type (vm, host) to collect,
            you can choose which metrics you want to collect the instance value as tags using a list of regex.
            See https://github.com/DataDog/integrations-core/blob/master/esxi/datadog_checks/esxi/metrics.py
            for the list of collected metrics (do not prefix them with `esxi`)
            /!\ Use with parsimony, collecting per-instance metrics might be very expensive for big environments.
          value:
            example:
              vm:
                - <VM_REGEX>
              host:
                - <HOST_REGEX>
            type: object
            properties:
              - name: vm
                type: array
                items:
                  type: string
              - name: host
                type: array
                items:
                  type: string
        - template: instances/default
