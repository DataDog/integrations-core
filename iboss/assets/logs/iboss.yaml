id: iboss
metric_id: iboss
backend_only: false
facets:
  - groups:
      - Event
    name: Event Name
    path: evt.name
    source: log
  - groups:
      - Web Access
    name: Method
    path: http.method
    source: log
  - groups:
      - Web Access
    name: Status Code
    path: http.status_code
    source: log
  - groups:
      - Web Access
    name: URL Path
    path: http.url
    source: log
  - groups:
      - Web Access
    name: URL Host
    path: http.url_details.host
    source: log
  - groups:
      - Web Access
    name: URL Path
    path: http.url_details.path
    source: log
  - groups:
      - Web Access
    name: URL scheme
    path: http.url_details.scheme
    source: log
  - groups:
      - Web Access
    name: User-Agent
    path: http.useragent
    source: log
  - groups:
      - Web Access
    name: Browser
    path: http.useragent_details.browser.family
    source: log
  - groups:
      - Web Access
    name: Device
    path: http.useragent_details.device.family
    source: log
  - groups:
      - Web Access
    name: OS
    path: http.useragent_details.os.family
    source: log
  - groups:
      - Geoip
    name: City Name
    path: network.client.geoip.city.name
    source: log
  - groups:
      - Geoip
    name: Continent Code
    path: network.client.geoip.continent.code
    source: log
  - groups:
      - Geoip
    name: Continent Name
    path: network.client.geoip.continent.name
    source: log
  - groups:
      - Geoip
    name: Country ISO Code
    path: network.client.geoip.country.iso_code
    source: log
  - groups:
      - Geoip
    name: Country Name
    path: network.client.geoip.country.name
    source: log
  - groups:
      - Geoip
    name: Subdivision ISO Code
    path: network.client.geoip.subdivision.iso_code
    source: log
  - groups:
      - Geoip
    name: Subdivision Name
    path: network.client.geoip.subdivision.name
    source: log
  - groups:
      - Web Access
    name: Client IP
    path: network.client.ip
    source: log
  - groups:
      - Web Access
    name: Client Port
    path: network.client.port
    source: log
  - groups:
      - Geoip
    name: Destination City Name
    path: network.destination.geoip.city.name
    source: log
  - groups:
      - Geoip
    name: Destination Continent Code
    path: network.destination.geoip.continent.code
    source: log
  - groups:
      - Geoip
    name: Destination Continent Name
    path: network.destination.geoip.continent.name
    source: log
  - groups:
      - Geoip
    name: Destination Country ISO Code
    path: network.destination.geoip.country.iso_code
    source: log
  - groups:
      - Geoip
    name: Destination Country Name
    path: network.destination.geoip.country.name
    source: log
  - groups:
      - Geoip
    name: Destination Subdivision ISO Code
    path: network.destination.geoip.subdivision.iso_code
    source: log
  - groups:
      - Geoip
    name: Destination Subdivision Name
    path: network.destination.geoip.subdivision.name
    source: log
  - groups:
      - Web Access
    name: Destination IP
    path: network.destination.ip
    source: log
  - groups:
      - Web Access
    name: Destination Port
    path: network.destination.port
    source: log
  - groups:
      - User
    name: User Name
    path: usr.name
    source: log
  - description: ''
    facetType: range
    groups:
      - iboss
    name: Proxy Total Time
    path: iboss.proxyTotalTime
    source: log
    type: double
    unit:
      family: time
      name: millisecond
pipeline:
  type: pipeline
  name: iboss
  enabled: true
  filter:
    query: source:iboss
  processors:
    - type: grok-parser
      name: Parsing Event logs
      enabled: true
      source: message
      samples:
        - <46>Apr 21 08:52:10 cn1759625052-15-7vnsr30179.ibosscloud.com
          {"exception":"-","totalByteUsage":"0","policyLayers":"-","sourcePort":"0","resourceId":"-","contentTypeHeader":"-","callout":"0","privateIp":"-","sAction":"Allowed","sourceIpAddress":"-","subjectId":"-","responseCode":"0","proxyTimeSinceEpoch":"-","authStepUp":"false","productVersion":"10.3.3.70","ztScore":"0","proxyRule":"-","clientPeerTime":"-","totalByteCount":"0","host":"-","stealth":"0","action":"Allowed","uriPath":"-","computerMacAddress":"00:00:00:00:00:00","iboss":"cn-1793905901-78-vnsg13776.ibosscloud.com","ztPolicyName":"-","proxyPeerResponseTime":"-","tlsVersion":"-","ipAddress":"-","resourceName":"-","localProxyPort":"0","logSubType":"-","ibossIpAddress":"149.19.43.19","mde":"-","lastname":"-","macAddress":"00:00:00:00:00:00","ztPolicyId":"-","filename":"-","filteringGroupName":"-","cncFlag":"0","proxyDnsLookupTime":"-","identityProviderName":"-","proxyTotalTime":"-","destinationPort":"0","logType":"AUDIT","extension":"-","firstname":"-","scheme":"-","reportingGroup":"0","requestMethod":"-","description":"-","policyTrace":"-","categoryName":"-","directionName":"-","sandBoxDecoded":"-","urlLogId":"5168","sandboxResult":"-","computerName":"-","assetId":"-","audit":"1","genericSandboxResult":"-","useTime":"0","identityProviderUUID":"-","upstreamByteUsage":"0","proxyResponseTime":"-","applicationName":"-","direction":"0","malware":"0","chatGPTMessage":"-","proxyTransactionStartTime":"-","userAgent":"-","publicIp":"-","url":"User
          logged
          in","logTime":"2025-04-21","referrerUrl":"-","sha256Sum":"-","uriQuery":"-","serverPeerTime":"-","downstreamByteUsage":"0","dlpKeywords":"-","location":"default","time":"08:52:10","vendorAccountId":"313117","username":"@ca-nilay.modi@crestdata.ai","heuristicScore":"0"}
      grok:
        supportRules: ""
        matchRules: event_logs_parsing_rule <%{integer}>%{date("MMM dd hh:mm:ss")}
          %{notSpace:hostname} %{data::json}
    - type: grok-parser
      name: Parsing `categoryName` attribute
      enabled: true
      source: categoryName
      samples:
        - Malware Content;Phishing
      grok:
        supportRules: ""
        matchRules: category_name_parsing_rule %{data:categoryName:array("",";")}
    - type: string-builder-processor
      name: Build `timestamp` string
      enabled: true
      template: "%{logTime}T%{time}Z"
      target: timestamp
      replaceMissing: false
    - type: date-remapper
      name: Define `timestamp` as the official date of the log
      enabled: true
      sources:
        - timestamp
    - type: attribute-remapper
      name: Map `sourceIpAddress` to `network.client.ip`
      enabled: true
      sources:
        - sourceIpAddress
      sourceType: attribute
      target: network.client.ip
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `sourcePort` to `network.client.port`
      enabled: true
      sources:
        - sourcePort
      sourceType: attribute
      target: network.client.port
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `ipAddress` to `network.destination.ip`
      enabled: true
      sources:
        - ipAddress
      sourceType: attribute
      target: network.destination.ip
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `destinationPort` to `network.destination.port`
      enabled: true
      sources:
        - destinationPort
      sourceType: attribute
      target: network.destination.port
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: geo-ip-parser
      name: Extracting geolocation information from the Client IP
      enabled: true
      sources:
        - network.client.ip
      target: network.client.geoip
      ip_processing_behavior: do-nothing
    - type: geo-ip-parser
      name: Extracting geolocation information from the Destination IP
      enabled: true
      sources:
        - network.destination.ip
      target: network.destination.geoip
      ip_processing_behavior: do-nothing
    - type: attribute-remapper
      name: Map `upstreamByteUsage` to `network.bytes_read`
      enabled: true
      sources:
        - upstreamByteUsage
      sourceType: attribute
      target: network.bytes_read
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `downstreamByteUsage` to `network.bytes_written`
      enabled: true
      sources:
        - downstreamByteUsage
      sourceType: attribute
      target: network.bytes_written
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `logType` to `evt.name`
      enabled: true
      sources:
        - logType
      sourceType: attribute
      target: evt.name
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `username` to `usr.name`
      enabled: true
      sources:
        - username
      sourceType: attribute
      target: usr.name
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: pipeline
      name: Parse Web and DLP logs
      enabled: true
      filter:
        query: "@evt.name:(WEB_LOG OR DLP)"
      processors:
        - type: attribute-remapper
          name: Map `url` to `http.url`
          enabled: true
          sources:
            - url
          sourceType: attribute
          target: http.url
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `requestMethod` to `http.method`
          enabled: true
          sources:
            - requestMethod
          sourceType: attribute
          target: http.method
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `scheme` to `http.url_details.scheme`
          enabled: true
          sources:
            - scheme
          sourceType: attribute
          target: http.url_details.scheme
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `uriPath` to `http.url_details.path`
          enabled: true
          sources:
            - uriPath
          sourceType: attribute
          target: http.url_details.path
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `uriQuery` to `http.url_details.queryString`
          enabled: true
          sources:
            - uriQuery
          sourceType: attribute
          target: http.url_details.queryString
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `host` to `http.url_details.host`
          enabled: true
          sources:
            - host
          sourceType: attribute
          target: http.url_details.host
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: attribute-remapper
          name: Map `responseCode` to `http.status_code`
          enabled: true
          sources:
            - responseCode
          sourceType: attribute
          target: http.status_code
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: category-processor
          name: HTTP status category processor
          enabled: true
          categories:
            - filter:
                query: "@http.status_code:0"
              name: No Response
            - filter:
                query: "@http.status_code:[100 TO 199]"
              name: Informational
            - filter:
                query: "@http.status_code:[200 TO 299]"
              name: Successful
            - filter:
                query: "@http.status_code:[300 TO 399]"
              name: Redirection
            - filter:
                query: "@http.status_code:[400 TO 499]"
              name: Client Error
            - filter:
                query: "@http.status_code:[500 TO 599]"
              name: Server Error
          target: http.status_category
        - type: attribute-remapper
          name: Map `userAgent` to `http.useragent`
          enabled: true
          sources:
            - userAgent
          sourceType: attribute
          target: http.useragent
          targetType: attribute
          preserveSource: false
          overrideOnConflict: false
        - type: user-agent-parser
          name: Parsing user agent
          enabled: true
          sources:
            - http.useragent
          target: http.useragent_details
          encoded: false
          combineVersionDetails: false
    - type: attribute-remapper
      name: Map `iboss` to `serverComputerName`
      enabled: true
      sources:
        - iboss
      sourceType: attribute
      target: serverComputerName
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
    - type: attribute-remapper
      name: Map `proxyTotalTime` to `iboss.proxyTotalTime`
      enabled: true
      sources:
        - proxyTotalTime
      sourceType: attribute
      target: iboss.proxyTotalTime
      targetType: attribute
      preserveSource: false
      overrideOnConflict: false
